import{s as Q}from"./main-BD5mqkRQ.js";import{c as P,r as te,i as O}from"./components-KK9vAy1z.js";import{L as ne}from"./utils-C4S-LQYV.js";import{e as z,p as t,i as Z}from"./myInfo-common-D2CUTr8V.js";import{c as N,g as ie}from"./myInfo-engravingManager-CvXKMKsa.js";let w=null,L=null;function ve(){if(w){const n=w.querySelector(".my-info-spirit-popup-close");n?n.click():(w.remove(),w=null)}L&&(L.remove(),L=null)}let e={isPressed:!1,intervalId:null,timeoutId:null,hintElement:null,bridgeElement:null,hintHovered:!1,button:null,spirit:null,category:null,index:null,action:null,mouseDownTime:null,touchStartTime:null,touchMoveHandler:null,ignoreMouseUp:!1};function W(n){return(Array.isArray(Q.allSpirits)?Q.allSpirits:[]).filter(h=>h.type===n)}function fe(n,m,h){const o=z[`bondSlots${n}`];if(!o)return;o.innerHTML="";const i=t.bondSpirits[n]||[];for(let r=0;r<6;r++){const s=P("div","my-info-bond-slot");if(s.dataset.slotIndex=r,s.dataset.category=n,i[r]){const a=i[r];s.classList.add("filled");const v=t.activeSpirits[n];v&&v.name===a.name&&s.classList.add("used-spirit");const S=P("img");S.src=a.image,S.alt=a.name,S.onerror=()=>{if(S.src.endsWith(".webp")){const b=a.image.replace(/\.webp$/i,".jpg");S.src=b;return}t.imageLoadErrors.add(a.image),Z()},s.appendChild(S);const l=P("div");l.className="level-badge",l.style.position="absolute",l.style.bottom="1px",l.style.right="1px",l.style.background="rgba(0,0,0,0.7)",l.style.color="white",l.style.padding="1px 3px",l.style.borderRadius="2px",l.style.fontSize="9px",l.style.fontWeight="600",l.textContent=`Lv.${a.level||25}`,l.style.pointerEvents="none",s.appendChild(l);const g=t.engravingData[n]?.[a.name];if(g){const b=Array.isArray(g.registration)&&g.registration.length>0,E=g.bind&&Object.keys(g.bind).length>0;if(b||E){const y=P("div");y.className="engraving-badge",y.style.position="absolute",y.style.top="1px",y.style.right="1px",y.style.background="var(--color-primary)",y.style.color="white",y.style.padding="2px 4px",y.style.borderRadius="2px",y.style.fontSize="8px",y.style.fontWeight="700",y.textContent="각인",y.style.pointerEvents="none",y.style.zIndex="10",s.appendChild(y)}}}else s.textContent="+",s.style.fontSize="16px",s.style.color="var(--text-light)";s.addEventListener("click",a=>{a.target.classList.contains("remove-btn")||a.target.closest(".remove-btn")||(i[r]?h&&h(n,r,s,a):m&&m(n))}),o.appendChild(s)}}function me(n){}function ge(n){const m=W(t.currentCategory);if(m.length===0){z.spiritGrid.innerHTML="<p class='text-center text-sm text-light mt-lg'>환수 데이터를 불러오는 중...</p>";return}const h=t.currentCategory,o=t.bondSpirits[h]||[],i=new Set(o.map(a=>a.name)),r=t.activeSpirits[h],s=r?r.name:null;te({container:z.spiritGrid,spirits:m,onSpiritClick:n,getSpiritState:a=>{const v=i.has(a.name),S=v&&s===a.name;return{selected:v,registrationCompleted:S,bondCompleted:!1,level25BindAvailable:!1}},groupByInfluence:!1})}function Se(n){t.currentCategory=n,z.spiritTabs.forEach(m=>{m.classList.toggle("active",m.dataset.category===n)})}function ye(n,m,h,o,i,r=null,s=null,a=null){if(!n)return;const v=t.currentCategory,S=t.bondSpirits[v]||[],l=S.findIndex(g=>g.name===n.name);if(l!==-1){const g=S[l];S.splice(l,1),t.bondSpirits[v]=S,t.removedSpiritLevels[v]||(t.removedSpiritLevels[v]={}),t.removedSpiritLevels[v][g.name]=g.level||25,t.isInitialLoad=!1,m&&m(v),h&&h(),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,r&&s&&a?r(a,s):o&&o(),i&&i()}else if(S.length<6){const g=O(n.name);let b=25;if(!g){const q=t.removedSpiritLevels[v]?.[n.name];q!==void 0&&(b=q)}const E={...n,level:b};S.push(E),t.removedSpiritLevels[v]?.[n.name]!==void 0&&delete t.removedSpiritLevels[v][n.name],t.bondSpirits[v]=S,t.isInitialLoad=!1;const y=S.length-1;m&&m(v);const M=z[`bondSlots${v}`];if(M){const q=M.children[y];q&&(q.classList.add("highlight"),setTimeout(()=>{q.classList.remove("highlight")},1e3))}h&&h(),t.lastTotalStatsHash=null,t.lastSoulExpHash=null,o&&o(),i&&i()}else{alert("결속 슬롯은 최대 6개까지 선택할 수 있습니다.");return}}function he(n,m,h,o,i,r,s,a=null,v=null,S=null){const l=t.bondSpirits[n]||[],g=l[m],b=t.activeSpirits[n];b&&b.name===g.name&&(t.activeSpirits[n]=null),l.splice(m,1),t.bondSpirits[n]=l,t.removedSpiritLevels[n]||(t.removedSpiritLevels[n]={}),t.removedSpiritLevels[n][g.name]=g.level||25,h&&h(n),i&&i(),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,a&&v&&S?a(S,v):r&&r(),s&&s()}function $(n,m,h){const o=t.activeSpirits[m],i=o&&o.name===h.name,r=n.querySelector("[data-action='set-active']");r&&(i?(r.textContent="사용중",r.classList.add("active")):(r.textContent="사용하기",r.classList.remove("active")))}function oe(n){if(!e.button||!e.spirit||O(e.spirit.name))return;e.isPressed=!0,e.ignoreMouseUp=!0,setTimeout(()=>{e.ignoreMouseUp=!1},100),ae(n);const m=()=>{if(!e.isPressed||e.category===null||e.index===null)return!1;const o=(t.bondSpirits[e.category]||[])[e.index];if(!o)return!1;const i=o.level!==void 0&&o.level!==null?o.level:25;let r=!1;if(e.action==="level-down"&&i>0?(o.level=Math.max(0,i-1),r=!0):e.action==="level-up"&&i<25&&(o.level=Math.min(25,i+1),r=!0),r){const s=t.activeSpirits[e.category];s&&s.name===o.name&&(t.activeSpirits[e.category]={...s,level:o.level});const a=w?.querySelector(".level-input");return a&&(a.value=o.level),n?.renderBondSlots&&n.renderBondSlots(e.category),n?.updatePopupActiveState&&n.updatePopupActiveState(w,e.category,o),t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,n?.updateTotalStats&&n?.updateStatItemsWithValues&&n?.getSpiritsForCategory?n.updateTotalStats(n.getSpiritsForCategory,n.updateStatItemsWithValues):n?.debouncedUpdateTotalStats&&n.debouncedUpdateTotalStats(),n?.debouncedUpdateSoulExp&&n.debouncedUpdateSoulExp(),!0}return!1};m(),e.intervalId=setInterval(()=>{m()||F()},200)}function F(){e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null),e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null),se(),e.touchMoveHandler&&(document.removeEventListener("touchmove",e.touchMoveHandler),e.touchMoveHandler=null),e.isPressed=!1,e.hintHovered=!1,e.bridgeElement=null,e.button=null,e.spirit=null,e.category=null,e.index=null,e.action=null,e.mouseDownTime=null,e.touchStartTime=null,e.ignoreMouseUp=!1}function ae(n){if(!e.button)return;const h=(e.action==="level-down"?0:25).toString(),o=P("div","level-hint");o.textContent=h;const i=e.button.getBoundingClientRect();o.style.position="fixed",o.style.top=i.top+"px",o.style.zIndex="1001",o.style.color="white",o.style.padding="0px 4px",o.style.margin="0",o.style.border="none",o.style.borderRadius="3px",o.style.fontSize="10px",o.style.fontWeight="bold",o.style.pointerEvents="none",o.style.cursor="pointer",o.style.whiteSpace="nowrap",o.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)",o.style.textAlign="center",o.style.height=i.height+"px",o.style.lineHeight=i.height+"px",o.style.width="32px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.transition="all 0.2s ease",e.action==="level-down"?(o.style.left=i.left-36+"px",o.style.backgroundColor="#f44336"):(o.style.left=i.right+4+"px",o.style.backgroundColor="#4CAF50"),document.body.appendChild(o),e.hintElement=o,e.hintHovered=!1;const r=P("div","hint-bridge");r.style.position="fixed",r.style.top=i.top+"px",r.style.height=i.height+"px",r.style.zIndex="1000",r.style.backgroundColor="transparent",r.style.pointerEvents="none",e.action==="level-down"?(r.style.left=i.left-36+"px",r.style.width=36+i.width+4+"px"):(r.style.left=i.left+"px",r.style.width=i.width+4+32+"px"),document.body.appendChild(r),e.bridgeElement=r;const s=()=>{e.isPressed&&(e.hintHovered=!0,o.style.transform="scale(1.2)",o.style.fontSize="12px",o.style.fontWeight="900",o.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)")},a=()=>{e.isPressed&&(e.hintHovered=!1,o.style.transform="scale(1)",o.style.fontSize="10px",o.style.fontWeight="bold",o.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)")},v=()=>{if(e.isPressed){if(e.hintHovered){const l=e.action==="level-down"?0:25;if(e.spirit){t.isInitialLoad=!1,e.spirit.level=l;const g=t.activeSpirits[e.category];g&&g.name===e.spirit.name&&(t.activeSpirits[e.category]={...g,level:l});const b=w?.querySelector(".level-input");b&&(b.value=l),n?.renderBondSlots&&n.renderBondSlots(e.category),n?.updatePopupActiveState&&n.updatePopupActiveState(w,e.category,e.spirit),t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,n?.updateTotalStats&&n?.updateStatItemsWithValues&&n?.getSpiritsForCategory?n.updateTotalStats(n.getSpiritsForCategory,n.updateStatItemsWithValues):n?.debouncedUpdateTotalStats&&n.debouncedUpdateTotalStats(),n?.debouncedUpdateSoulExp&&n.debouncedUpdateSoulExp()}}F()}};o.addEventListener("mouseenter",s),o.addEventListener("mouseup",v),o.addEventListener("mouseleave",l=>{!r.contains(l.relatedTarget)&&l.relatedTarget!==r&&a()}),o.addEventListener("touchstart",l=>{l.preventDefault(),l.stopPropagation(),s()},{passive:!1}),o.addEventListener("touchend",l=>{l.preventDefault(),l.stopPropagation(),v()},{passive:!1}),r.addEventListener("mouseleave",l=>{!o.contains(l.relatedTarget)&&l.relatedTarget!==o&&a()}),r.addEventListener("touchstart",l=>{l.preventDefault(),l.stopPropagation(),s()},{passive:!1}),r.addEventListener("touchend",l=>{l.preventDefault(),l.stopPropagation()},{passive:!1});const S=l=>{if(!e.isPressed)return;const g=l.touches[0],b=document.elementFromPoint(g.clientX,g.clientY),E=e.hintElement,y=e.bridgeElement;if(!E)return;b===E||E.contains(b)||b===y?e.hintHovered||(E.style.pointerEvents="auto",y.style.pointerEvents="auto",e.hintHovered=!0,E.style.transform="scale(1.2)",E.style.fontSize="12px",E.style.fontWeight="900",E.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)"):e.hintHovered&&(E.style.pointerEvents="none",y.style.pointerEvents="none",e.hintHovered=!1,E.style.transform="scale(1)",E.style.fontSize="10px",E.style.fontWeight="bold",E.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)")};e.touchMoveHandler=S,document.addEventListener("touchmove",S,{passive:!1}),setTimeout(()=>{o&&e.isPressed&&(o.style.pointerEvents="auto"),r&&e.isPressed&&(r.style.pointerEvents="auto")},0)}function se(){e.hintElement&&(e.hintElement.remove(),e.hintElement=null),e.bridgeElement&&(e.bridgeElement.remove(),e.bridgeElement=null)}function xe(n,m,h,o,i){const s=(t.bondSpirits[n]||[])[m];if(!s)return;w&&(w.remove(),w=null),L&&(L.remove(),L=null);const a=P("div","my-info-spirit-popup"),v=P("div","my-info-spirit-popup-overlay");v.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 999;
  `,v.addEventListener("click",u=>{u.target===v&&(a.remove(),v.remove(),w=null,L=null)}),document.body.appendChild(v),L=v;const S=t.activeSpirits[n],l=S&&S.name===s.name,g=O(s.name),b=t.engravingData[n]?.[s.name]||{},E=Array.isArray(b.registration)?b.registration.length:0;a.innerHTML=`
    <button class="my-info-spirit-popup-close">×</button>
    <div class="kakao-ad-popup-container desktop-popup-ad">
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-aOM3JPGvOLhHlyoS"
          data-ad-width="728"
          data-ad-height="90"></ins>
    </div>
    <div class="kakao-ad-popup-container mobile-popup-ad">
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-epbkjAaeHSxv0MYl"
          data-ad-width="320"
          data-ad-height="50"></ins>
    </div>
    <div class="my-info-spirit-popup-content">
      <div class="my-info-spirit-popup-header">
        <div style="display: flex; align-items: center; gap: var(--space-sm);">
          <img src="${s.image}" alt="${s.name}" loading="lazy">
          <div class="my-info-spirit-popup-name">${s.name}</div>
        </div>
        <div style="display: flex; align-items: center; justify-content: center; flex: 1;">
          <div class="spirit-level-control">
            ${g?`<div class="fixed-level-control">
                    <span class="fixed-level-label">레벨 25 (고정)</span>
                  </div>`:`<div style="display: flex; align-items: center; gap: 4px;">
                    <button class="level-btn minus-btn" data-action="level-down">-</button>
                    <input type="number" class="level-input" min="0" max="25" value="${s.level||25}">
                    <button class="level-btn plus-btn" data-action="level-up">+</button>
                  </div>`}
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-xs);">
          <div class="my-info-spirit-popup-actions">
            <button class="my-info-spirit-popup-action-btn ${l?"active":""}" data-action="set-active">
              ${l?"사용중":"사용하기"}
            </button>
            <button class="my-info-spirit-popup-action-btn remove" data-action="remove">결속 제거</button>
          </div>
        </div>
      </div>
      <div class="my-info-engraving-tabs">
        <button class="my-info-engraving-tab active" data-tab="registration">등록효과</button>
        <button class="my-info-engraving-tab" data-tab="bind">장착효과</button>
      </div>
      <div class="my-info-engraving-tab-content active" id="registrationTab">
        <div id="registrationItemsContainer"></div>
        <div style="display: flex; gap: var(--space-sm); margin-top: var(--space-sm);">
          <button class="my-info-engraving-add-btn" id="addEngravingBtn" ${E>=4?"disabled":""}>
            + 등록효과 추가 (${E}/4)
          </button>
          <button class="my-info-engraving-save-btn" id="saveEngravingBtn">각인 저장</button>
        </div>
      </div>
      <div class="my-info-engraving-tab-content" id="bindTab">
        <div id="bindItemsContainer"></div>
        <div style="display: flex; gap: var(--space-sm); margin-top: var(--space-sm); justify-content: flex-end;">
          <button class="my-info-engraving-save-btn" id="saveEngravingBtnBind" style="flex: 0 1 50%; max-width: 50%;">각인 저장</button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(a),w=a;const y=a.querySelector("img");y&&(y.onerror=()=>{t.imageLoadErrors.add(y.src),Z()}),setTimeout(()=>{try{const u=a.querySelector(".desktop-popup-ad .kakao_ad_area"),d=a.querySelector(".mobile-popup-ad .kakao_ad_area");window.adfit&&typeof window.adfit.render=="function"&&(u&&window.adfit.render(u),d&&window.adfit.render(d))}catch(u){ne.error("Kakao AdFit: Error rendering ads in popup:",u)}},100);const M=a.querySelector(".my-info-spirit-popup-close"),q={renderBondSlots:i?.renderBondSlots,updatePopupActiveState:$,debouncedUpdateTotalStats:i?.debouncedUpdateTotalStats,debouncedUpdateSoulExp:i?.debouncedUpdateSoulExp};if(!g){const u=a.querySelector(".level-input"),d=a.querySelector(".minus-btn"),f=a.querySelector(".plus-btn");u.focus(),u.select();const x=(c,p)=>{const I=T=>{T.preventDefault(),T.stopPropagation(),e.timeoutId&&clearTimeout(e.timeoutId),e.intervalId&&clearInterval(e.intervalId),e.isPressed=!1,e.button=c,e.spirit=s,e.category=n,e.index=m,e.action=p,e.hintHovered=!1,e.mouseDownTime=Date.now(),e.timeoutId=setTimeout(()=>{e.button===c&&oe(q)},300)},C=T=>{T.preventDefault(),T.stopPropagation(),e.touchStartTime=Date.now(),I(T)};c.addEventListener("mousedown",I),c.addEventListener("touchstart",C,{passive:!1})};x(d,"level-down"),x(f,"level-up"),u.addEventListener("change",()=>{let c=parseInt(u.value,10)||25;c<0&&(c=0),c>25&&(c=25),u.value=c,s.level=c;const p=t.activeSpirits[n];p&&p.name===s.name&&(t.activeSpirits[n]={...p,level:c}),i?.renderBondSlots&&i.renderBondSlots(n),$(a,n,s),t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,i?.updateTotalStats&&i?.updateStatItemsWithValues&&i?.getSpiritsForCategory?i.updateTotalStats(i.getSpiritsForCategory,i.updateStatItemsWithValues):i?.debouncedUpdateTotalStats&&i.debouncedUpdateTotalStats(),i?.debouncedUpdateSoulExp&&i.debouncedUpdateSoulExp()})}const V=u=>{if(!e.ignoreMouseUp){if(e.timeoutId&&!e.isPressed){clearTimeout(e.timeoutId),e.timeoutId=null;const d=e.mouseDownTime?Date.now()-e.mouseDownTime:0;if(d>0&&d<300&&e.category!==null&&e.index!==null){const c=(t.bondSpirits[e.category]||[])[e.index];if(c){let p=c.level!==void 0&&c.level!==null?c.level:25,I=!1;if(e.action==="level-down"&&p>0?(p=Math.max(0,p-1),I=!0):e.action==="level-up"&&p<25&&(p=Math.min(25,p+1),I=!0),I){c.level,c.level=p;const C=t.activeSpirits[e.category];C&&C.name===c.name&&(t.activeSpirits[e.category]={...C,level:p});const T=a.querySelector(".level-input");T&&(T.value=p),t.isInitialLoad=!1,i?.renderBondSlots&&i.renderBondSlots(e.category),$(a,e.category,c),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,i?.debouncedUpdateTotalStats&&i.debouncedUpdateTotalStats(),i?.debouncedUpdateSoulExp&&i.debouncedUpdateSoulExp()}}}e.button=null,e.spirit=null,e.category=null,e.index=null,e.action=null,e.mouseDownTime=null;return}if(e.isPressed){if(u.type==="touchend"&&e.hintElement){const d=u.changedTouches?.[0]||u,f=e.hintElement.getBoundingClientRect();d.clientX>=f.left&&d.clientX<=f.right&&d.clientY>=f.top&&d.clientY<=f.bottom&&(e.hintHovered=!0)}if(e.hintHovered&&e.category!==null&&e.index!==null){const d=e.action==="level-down"?0:25,x=(t.bondSpirits[e.category]||[])[e.index];if(x){x.level=d;const c=t.activeSpirits[e.category];c&&c.name===x.name&&(t.activeSpirits[e.category]={...c,level:d});const p=a.querySelector(".level-input");p&&(p.value=d),i?.renderBondSlots&&i.renderBondSlots(e.category),$(a,e.category,x),t.lastTotalStatsHash=null,t.lastSoulExpHash=null,i?.debouncedUpdateTotalStats&&i.debouncedUpdateTotalStats(),i?.debouncedUpdateSoulExp&&i.debouncedUpdateSoulExp()}}F(),u.preventDefault(),u.stopPropagation();return}(e.button||e.timeoutId)&&(e.button=null,e.spirit=null,e.category=null,e.index=null,e.action=null,e.mouseDownTime=null,e.touchStartTime=null,e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null))}},_=u=>{const d=u.changedTouches[0],f={...u,type:"touchend",clientX:d.clientX,clientY:d.clientY,changedTouches:[d]};V(f)};document.addEventListener("mouseup",V),document.addEventListener("touchend",_,{passive:!1});const j=()=>{F(),document.removeEventListener("mouseup",V),document.removeEventListener("touchend",_),a.remove(),L&&(L.remove(),L=null),w=null};M.addEventListener("click",j);const A=a.querySelector("[data-action='set-active']");A.addEventListener("click",()=>{t.activeSpirits[n];const u=t.activeSpirits[n];if(u&&u.name===s.name)t.activeSpirits[n]=null,A.textContent="사용하기",A.classList.remove("active");else{const d=g?25:parseInt(a.querySelector(".level-input")?.value,10)||s.level||25,f={name:s.name,level:d,...s};f.level=d,t.activeSpirits[n]=f,s.level=d,A.textContent="사용중",A.classList.add("active"),A.textContent="사용중",A.classList.add("active")}t.isInitialLoad=!1,i?.renderBondSlots&&i.renderBondSlots(n),$(a,n,s),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,i?.updateTotalStats&&i.updateTotalStats(W,i.updateStatItemsWithValues),i?.updateSoulExp&&i.updateSoulExp(W)}),a.querySelector("[data-action='remove']").addEventListener("click",()=>{F(),i?.removeBondSpirit&&i.removeBondSpirit(n,m),j()});const B=a.querySelector("#registrationItemsContainer"),U=a.querySelector("#bindItemsContainer"),H=a.querySelector("#addEngravingBtn"),G=a.querySelector("#saveEngravingBtn"),Y=a.querySelector("#saveEngravingBtnBind"),K=a.querySelectorAll(".my-info-engraving-tab"),X=a.querySelectorAll(".my-info-engraving-tab-content");function J(){return ie(n,s.name)}function k(){if(!B)return;B.innerHTML="";const{registrationItems:u}=J();if(u.forEach((d,f)=>{const x=d.statKey||"",c=d.value||"",p=N(x,c,"","registration",f,()=>D(),I=>{if(I.remove(),H){const C=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length;H.disabled=C>=4,H.textContent=`+ 등록효과 추가 (${C}/4)`}D()});B.appendChild(p)}),H){const d=u.length;H.disabled=d>=4,H.textContent=`+ 등록효과 추가 (${d}/4)`}}function D(){if(!U)return;U.innerHTML="";const u=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]'),d=new Set;u.forEach(x=>{const p=x.querySelector(".my-info-engraving-stat-select")?.value||"";p&&d.add(p)});const{bindStats:f}=J();d.forEach(x=>{const c=f[x]||"",p=N(x,"",c,"bind");U.appendChild(p)})}function ee(){k(),D()}K&&X&&K.forEach(u=>{u.addEventListener("click",()=>{const d=u.dataset.tab;K.forEach(f=>f.classList.remove("active")),u.classList.add("active"),X.forEach(f=>{f.classList.remove("active"),f.id===`${d}Tab`&&f.classList.add("active")})})}),ee(),H&&H.addEventListener("click",()=>{if(B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length>=4)return;const d=N("","","","registration",null,()=>D(),f=>{if(f.remove(),H){const x=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length;H.disabled=x>=4,H.textContent=`+ 등록효과 추가 (${x}/4)`}D()});if(B.appendChild(d),D(),H){const f=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length;H.disabled=f>=4,H.textContent=`+ 등록효과 추가 (${f}/4)`}}),G&&G.addEventListener("click",()=>{const u=[],d={};B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').forEach(p=>{const I=p.querySelector(".my-info-engraving-stat-select"),C=p.querySelector(".my-info-engraving-value-input"),T=I.value,R=parseFloat(C.value)||0;T&&u.push({statKey:T,value:R})}),U.querySelectorAll('.my-info-engraving-item[data-type="bind"]').forEach(p=>{const I=p.dataset.statKey;if(!I)return;const C=p.querySelector(".my-info-engraving-value-input"),T=parseFloat(C.value)||0;d[I]=T});const c={registration:u,bind:d};t.engravingData[n]||(t.engravingData[n]={}),t.engravingData[n][s.name],t.engravingData[n][s.name]=c,t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,i?.updateTotalStats&&i.updateTotalStats(W,i.updateStatItemsWithValues),i?.renderBondSlots&&i.renderBondSlots(n),a&&a.parentNode&&(a.remove(),L&&(L.remove(),L=null),w=null)}),Y&&Y.addEventListener("click",()=>{const u=[],d={};B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').forEach(p=>{const I=p.querySelector(".my-info-engraving-stat-select"),C=p.querySelector(".my-info-engraving-value-input"),T=I.value,R=parseFloat(C.value)||0;T&&u.push({statKey:T,value:R})}),U.querySelectorAll('.my-info-engraving-item[data-type="bind"]').forEach(p=>{const I=p.dataset.statKey;if(!I)return;const C=p.querySelector(".my-info-engraving-value-input"),T=parseFloat(C.value)||0;d[I]=T});const c={registration:u,bind:d};t.engravingData[n]||(t.engravingData[n]={}),t.engravingData[n][s.name],t.engravingData[n][s.name]=c,t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,i?.updateTotalStats&&i.updateTotalStats(W,i.updateStatItemsWithValues),i?.renderBondSlots&&i.renderBondSlots(n),a&&a.parentNode&&(a.remove(),L&&(L.remove(),L=null),w=null)})}export{ge as a,Se as b,me as c,F as d,he as e,ve as f,W as g,ye as h,fe as r,xe as s};
