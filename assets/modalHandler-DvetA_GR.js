import{b as i}from"./utils-CHsLvtYz.js";import{F as k,S as h,E as T,P as x}from"./constants-lx1P6xCQ.js";let b=null;function L(e){if(e==null)return 0;const n=parseFloat(String(e).replace(/,/g,""));return isNaN(n)?0:n}function w(){C();const e=i("div","spirit-modal-overlay",{id:"spirit-info-modal"}),n=i("div","spirit-modal-content");e.appendChild(n),document.body.appendChild(e),e.addEventListener("click",o=>{o.target===e&&C()});const t=o=>{o.key==="Escape"&&C()};return document.addEventListener("keydown",t),e._escListener=t,b=e,{modal:e,content:n}}function $(e,n=null,t=!1){if(!e){console.error("모달을 표시할 환수 데이터가 없습니다.");return}const{modal:o,content:a}=w();document.body.style.overflow="hidden",I(a,e,t?25:0,n,t),o.style.display="flex"}function I(e,n,t,o,a){e.innerHTML="";const d=i("button","modal-close-btn",{text:"✕"});d.addEventListener("click",C),e.appendChild(d);const s=i("div","kakao-ad-modal-container desktop-modal-ad");s.innerHTML=`
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-aOM3JPGvOLhHlyoS"
          data-ad-width="728"
          data-ad-height="90"></ins>
  `,e.appendChild(s);const l=i("div","kakao-ad-modal-container mobile-modal-ad");l.innerHTML=`
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-epbkjAaeHSxv0MYl"
          data-ad-width="320"
          data-ad-height="50"></ins>
  `,e.appendChild(l);const c=i("div","spirit-modal-header"),u=i("img","spirit-modal-image",{src:`${n.image}`,alt:n.name});c.appendChild(u);const m=i("div","spirit-modal-title-section"),p=i("h3","",{text:n.name});if(m.appendChild(p),n.influence&&k[n.influence]){const f=i("img","influence-icon",{src:k[n.influence],alt:n.influence,title:n.influence});p.appendChild(f)}const v=a?_():B(e,n,t,o);m.appendChild(v),c.appendChild(m),e.appendChild(c);const r=i("div","stats-container"),A=S("등록 효과","registrationList","registration-sum"),M=S("장착 효과","bindList","bind-sum");r.appendChild(A),r.appendChild(M),e.appendChild(r),N(n,t,o),setTimeout(()=>{try{if(window.adfit&&typeof window.adfit.render=="function"){const f=s.querySelector(".kakao_ad_area"),g=l.querySelector(".kakao_ad_area");f&&window.adfit.render(f),g&&window.adfit.render(g),console.log("Kakao AdFit: Ads re-rendered (both mobile/desktop) in Spirit Info modal.")}else console.warn("Kakao AdFit script not yet loaded or available for re-rendering.")}catch(f){console.error("Kakao AdFit: Error re-rendering ad after level change:",f)}},100)}function _(){const e=i("div","level-control"),n=i("div","fixed-level-display");return n.innerHTML="<strong>레벨: 25</strong> (랭킹 기준)",e.appendChild(n),e}function B(e,n,t,o){const a=i("div","level-control"),d=i("div","level-input-container"),s=i("button",["level-btn","min-btn"],{text:"min"}),l=i("button",["level-btn","minus-btn"],{text:"-"}),c=i("input","level-input",{type:"number",min:"0",max:"25",value:String(t)}),u=i("button",["level-btn","plus-btn"],{text:"+"}),m=i("button",["level-btn","max-btn"],{text:"max"});d.append(s,l,c,u,m),a.appendChild(d);const p=v=>{let r=parseInt(v,10);(isNaN(r)||r<0)&&(r=0),r>25&&(r=25),r!==t&&I(e,n,r,o,!1)};return s.addEventListener("click",()=>p(0)),l.addEventListener("click",()=>p(t-1)),u.addEventListener("click",()=>p(t+1)),m.addEventListener("click",()=>p(25)),c.addEventListener("change",v=>p(v.target.value)),a}function S(e,n,t){const o=i("div","stats-column");return o.innerHTML=`
        <div class="stats-header">
            ${e}
            <span id="${t}" class="stats-sum">합산: 0</span>
        </div>
        <ul id="${n}" class="stats-list"></ul>
    `,o}function N(e,n,t){const o=document.getElementById("registrationList"),a=document.getElementById("bindList");if(!o||!a){console.error("Stat lists not found in DOM.");return}const d=e.stats.find(c=>c.level===n),s=d?.registrationStat||{},l=d?.bindStat||{};y(o,s,t),y(a,l,t),document.getElementById("registration-sum").textContent=`합산: ${E(s)}`,document.getElementById("bind-sum").textContent=`합산: ${E(l)}`}function y(e,n,t){e.innerHTML="";const o=Object.entries(n);if(o.length===0){e.innerHTML="<li>효과 없음</li>";return}o.sort((a,d)=>{const s=h[a[0]]||a[0],l=h[d[0]]||d[0];return s.localeCompare(l)}).forEach(([a,d])=>{const s=h[a]||a,c=x.includes(a)?`${L(d)}%`:L(d),u=i("li");t&&a===t&&u.classList.add("stat-highlight"),T.includes(a)&&u.classList.add("stat-effective"),u.innerHTML=`
        <span class="stat-key">${s}</span>
        <span class="stat-value">${c}</span>
      `,e.appendChild(u)})}function E(e){if(!e)return 0;const n=L(e.damageResistance),t=L(e.damageResistancePenetration);return Math.round(n+t)}function C(){b&&(document.removeEventListener("keydown",b._escListener),b.remove(),b=null),document.body.style.overflow="auto"}export{$ as s};
