import{c as j,i as z}from"./components-DdtSZoSt.js";import{f as pe,s as K}from"./main-CCVrUopr.js";import{L as E}from"./utils-CrhYKkLj.js";import{c as Y}from"./myInfo-statCalculator-BzggkQhQ.js";import{g as Z}from"./myInfo-spiritManager-EfOtZO4k.js";const e={currentCategory:"ìˆ˜í˜¸",currentProfileId:null,bondSpirits:{ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},activeSpirits:{ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null},userStats:{},baselineStats:{},baselineKeyStats:{tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},expTable:null,lastSoulExpCalculation:null,lastSoulExpHash:null,bondCalculationCache:new Map,lastTotalStatsCalculation:null,lastTotalStatsHash:null,savedSoulExp:0,baselineSoulExpHash:null,recentlyEditedStats:new Set,isSavingBaseline:!1,isInitialLoad:!0,isUpdatingTotalStats:!1,baselineStatsHash:null,removedSpiritLevels:{},engravingData:{ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},imageLoadErrors:new Set,imageLoadErrorShown:!1,imageObserver:null},_={},H=[{key:"damageResistancePenetration",name:"í”¼í•´ì €í•­ê´€í†µ"},{key:"damageResistance",name:"í”¼í•´ì €í•­"},{key:"pvpDamagePercent",name:"ëŒ€ì¸í”¼í•´%"},{key:"pvpDefensePercent",name:"ëŒ€ì¸ë°©ì–´%"},{key:"pvpDamage",name:"ëŒ€ì¸í”¼í•´"},{key:"pvpDefense",name:"ëŒ€ì¸ë°©ì–´"},{key:"statusEffectAccuracy",name:"ìƒíƒœì´ìƒì ì¤‘"},{key:"statusEffectResistance",name:"ìƒíƒœì´ìƒì €í•­"},{key:"normalMonsterPenetration",name:"ì¼ë°˜ëª¬ìŠ¤í„° ê´€í†µ"},{key:"normalMonsterAdditionalDamage",name:"ì¼ë°˜ëª¬ìŠ¤í„° ì¶”ê°€í”¼í•´"},{key:"bossMonsterPenetration",name:"ë³´ìŠ¤ëª¬ìŠ¤í„° ê´€í†µ"},{key:"bossMonsterAdditionalDamage",name:"ë³´ìŠ¤ëª¬ìŠ¤í„° ì¶”ê°€í”¼í•´"},{key:"criticalPowerPercent",name:"ì¹˜ëª…ìœ„ë ¥%"},{key:"criticalChance",name:"ì¹˜ëª…í™•ë¥ %"},{key:"power",name:"ìœ„ë ¥"},{key:"movementSpeed",name:"ì´ë™ì†ë„"},{key:"damageAbsorption",name:"í”¼í•´í¡ìˆ˜"},{key:"criticalResistance",name:"ì¹˜ëª…ì €í•­"},{key:"criticalDamageResistance",name:"ì¹˜ëª…í”¼í•´ì €í•­"},{key:"experienceGainIncrease",name:"ê²½í—˜ì¹˜ íšë“ì¦ê°€"},{key:"normalMonsterResistance",name:"ì¼ë°˜ëª¬ìŠ¤í„° ì €í•­"},{key:"bossMonsterResistance",name:"ë³´ìŠ¤ëª¬ìŠ¤í„° ì €í•­"}],Oe=[{key:"healthIncrease",name:"ì²´ë ¥ì¦ê°€"},{key:"magicIncrease",name:"ë§ˆë ¥ì¦ê°€"},{key:"criticalChance",name:"ì¹˜ëª…í™•ë¥ "},{key:"criticalResistance",name:"ì¹˜ëª…ì €í•­"},{key:"healthPotionEnhancement",name:"ì²´ë ¥ì‹œì•½í–¥ìƒ"},{key:"magicPotionEnhancement",name:"ë§ˆë ¥ì‹œì•½í–¥ìƒ"},{key:"pvpDefense",name:"ëŒ€ì¸ë°©ì–´"},{key:"damageAbsorption",name:"í”¼í•´í¡ìˆ˜"},{key:"power",name:"ìœ„ë ¥"},{key:"criticalDamageResistance",name:"ì¹˜ëª…í”¼í•´ì €í•­"},{key:"castingEnhancement",name:"ì‹œì „í–¥ìƒ"},{key:"bossMonsterAdditionalDamage",name:"ë³´ìŠ¤ëª¬ìŠ¤í„° ì¶”ê°€í”¼í•´"},{key:"normalMonsterAdditionalDamage",name:"ì¼ë°˜ëª¬ìŠ¤í„° ì¶”ê°€í”¼í•´"},{key:"damageResistancePenetration",name:"í”¼í•´ì €í•­ê´€í†µ"},{key:"statusEffectResistance",name:"ìƒíƒœì´ìƒì €í•­"},{key:"statusEffectAccuracy",name:"ìƒíƒœì´ìƒì ì¤‘"}],_e=H.slice(0,8),Me=H.slice(8,16),He=H.slice(16),Pe={í”¼í•´ì €í•­ê´€í†µ:"í”¼ì €ê´€",í”¼í•´ì €í•­:"í”¼ì €","ëŒ€ì¸í”¼í•´%":"ëŒ€í”¼%","ëŒ€ì¸ë°©ì–´%":"ëŒ€ë°©%",ëŒ€ì¸í”¼í•´:"ëŒ€í”¼",ëŒ€ì¸ë°©ì–´:"ëŒ€ë°©",ìƒíƒœì´ìƒì ì¤‘:"ìƒì´ì ",ìƒíƒœì´ìƒì €í•­:"ìƒì´ì €","ì¼ë°˜ëª¬ìŠ¤í„° ê´€í†µ":"ì¼ëª¬ê´€","ì¼ë°˜ëª¬ìŠ¤í„° ì¶”ê°€í”¼í•´":"ì¼ëª¬ì¶”","ë³´ìŠ¤ëª¬ìŠ¤í„° ê´€í†µ":"ë³´ëª¬ê´€","ë³´ìŠ¤ëª¬ìŠ¤í„° ì¶”ê°€í”¼í•´":"ë³´ëª¬ì¶”","ì¹˜ëª…ìœ„ë ¥%":"ì¹˜ìœ„%","ì¹˜ëª…í™•ë¥ %":"ì¹˜í™•%",ìœ„ë ¥:"ìœ„ë ¥",ì´ë™ì†ë„:"ì´ì†",í”¼í•´í¡ìˆ˜:"í”¼í¡",ì¹˜ëª…ì €í•­:"ì¹˜ì €",ì¹˜ëª…í”¼í•´ì €í•­:"ì¹˜í”¼ì €","ê²½í—˜ì¹˜ íšë“ì¦ê°€":"ê²½íš","ì¼ë°˜ëª¬ìŠ¤í„° ì €í•­":"ì¼ëª¬ì €","ë³´ìŠ¤ëª¬ìŠ¤í„° ì €í•­":"ë³´ëª¬ì €"},Ve={damageResistance:"stat-damage-resistance",damageResistancePenetration:"stat-damage-resistance-penetration",pvpDefensePercent:"stat-pvp-defense-percent",pvpDamagePercent:"stat-pvp-damage-percent"},Be={pvpDamage:"stat-pvp-damage",pvpDefense:"stat-pvp-defense",statusEffectAccuracy:"stat-status-effect-accuracy",statusEffectResistance:"stat-status-effect-resistance",damageAbsorption:"stat-damage-absorption"};function Re(){return window.innerWidth<=768}function De(){if(e.imageLoadErrorShown)return;e.imageLoadErrorShown=!0;const t=j("div");if(t.style.cssText=`
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff6b35;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 10000;
    font-size: 14px;
    font-weight: 600;
    max-width: 90%;
    text-align: center;
    animation: slideDown 0.3s ease-out;
  `,t.textContent="ì¼ë¶€ ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Ctrl+Shift+Rì„ ëˆŒëŸ¬ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.",!document.getElementById("image-error-animation-style")){const n=j("style");n.id="image-error-animation-style",n.textContent=`
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }
    `,document.head.appendChild(n)}document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.animation="slideDown 0.3s ease-out reverse",setTimeout(()=>{t.parentNode&&t.remove()},300))},5e3),t.addEventListener("click",()=>{t.parentNode&&(t.style.animation="slideDown 0.3s ease-out reverse",setTimeout(()=>{t.parentNode&&t.remove()},300))})}function je(){return`
    <div class="my-info-container">
    <div class="my-info-top-section">
      <!-- ì™¼ìª½: í™˜ìˆ˜ ì„¹ì…˜ (50%) -->
      <div class="my-info-spirit-section-wrapper">
        <!-- ì™¼ìª½: ìˆ˜í˜¸/íƒ‘ìŠ¹/ë³€ì‹  ì¹´ë“œ (40%) -->
        <div class="my-info-left-panel">
          <!-- ìˆ˜í˜¸ ì¹´ë“œ -->
          <div class="my-info-category-card" data-category="ìˆ˜í˜¸">
            <h2 class="my-info-category-title">ìˆ˜í˜¸</h2>
            <div class="my-info-bond-slots" id="bondSlotsìˆ˜í˜¸"></div>
          </div>

          <!-- íƒ‘ìŠ¹ ì¹´ë“œ -->
          <div class="my-info-category-card" data-category="íƒ‘ìŠ¹">
            <h2 class="my-info-category-title">íƒ‘ìŠ¹</h2>
            <div class="my-info-bond-slots" id="bondSlotsíƒ‘ìŠ¹"></div>
          </div>

          <!-- ë³€ì‹  ì¹´ë“œ -->
          <div class="my-info-category-card" data-category="ë³€ì‹ ">
            <h2 class="my-info-category-title">ë³€ì‹ </h2>
            <div class="my-info-bond-slots" id="bondSlotsë³€ì‹ "></div>
          </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì „ì²´ í™˜ìˆ˜ ì„ íƒ ê·¸ë¦¬ë“œ (60%) -->
        <div class="my-info-right-panel">
          <div class="my-info-spirit-section">
            <div class="my-info-spirit-tabs">
              <button class="my-info-spirit-tab active" data-category="ìˆ˜í˜¸">ìˆ˜í˜¸</button>
              <button class="my-info-spirit-tab" data-category="íƒ‘ìŠ¹">íƒ‘ìŠ¹</button>
              <button class="my-info-spirit-tab" data-category="ë³€ì‹ ">ë³€ì‹ </button>
            </div>
            <div id="myInfoSpiritGrid"></div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ê¸°ë³¸ ìŠ¤íƒ¯ ì„¹ì…˜ (50%) -->
      <div class="my-info-stats-section-wrapper">
        <div class="my-info-stats-section">
          <!-- í”„ë¡œíŒŒì¼ ì„ íƒ ì„¹ì…˜ (í†µí•©) -->
          <div class="my-info-profile-section">
            <div class="my-info-profile-section-left">
              <label class="my-info-profile-label">ì„¤ì •:</label>
              <select class="my-info-profile-select" id="profileSelect">
                <option value="">ì„¤ì • ì—†ìŒ</option>
              </select>
              <div class="my-info-profile-actions">
                <button class="my-info-profile-btn primary" id="createProfileBtn" title="ìƒˆ í”„ë¡œíŒŒì¼">+</button>
                <button class="my-info-profile-btn" id="editProfileBtn" disabled title="ì´ë¦„ ìˆ˜ì •">âœï¸</button>
                <button class="my-info-profile-btn danger" id="deleteProfileBtn" disabled>ì‚­ì œ</button>
              </div>
            </div>
            <div class="my-info-profile-section-right">
              <div class="my-info-data-menu">
                <button id="dataMenuBtn" class="my-info-menu-btn" title="ë°ì´í„° ê´€ë¦¬">
                  <span class="my-info-btn-icon">âš™ï¸</span>
                  <span class="my-info-btn-text">ë°ì´í„°</span>
                  <span class="my-info-menu-arrow">â–¼</span>
                </button>
                <div id="dataMenuDropdown" class="my-info-menu-dropdown">
                  <button id="copyClipboardBtn" class="my-info-menu-item">
                    <span class="my-info-menu-icon">ğŸ“‹</span>
                    <span>í´ë¦½ë³´ë“œ ë³µì‚¬</span>
                  </button>
                  <button id="pasteClipboardBtn" class="my-info-menu-item">
                    <span class="my-info-menu-icon">ğŸ“„</span>
                    <span>í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸°</span>
                  </button>
                  <div class="my-info-menu-divider"></div>
                  <button id="exportJSONBtn" class="my-info-menu-item">
                    <span class="my-info-menu-icon">ğŸ“¥</span>
                    <span>JSON ë‚´ë³´ë‚´ê¸°</span>
                  </button>
                  <button id="exportCSVBtn" class="my-info-menu-item">
                    <span class="my-info-menu-icon">ğŸ“¥</span>
                    <span>CSV ë‚´ë³´ë‚´ê¸°</span>
                  </button>
                  <div class="my-info-menu-divider"></div>
                  <button id="importBtn" class="my-info-menu-item">
                    <span class="my-info-menu-icon">ğŸ“¤</span>
                    <span>íŒŒì¼ ê°€ì ¸ì˜¤ê¸°</span>
                  </button>
                </div>
              </div>
              <button id="saveBaselineBtn" class="my-info-save-btn">
                <span>ì €ì¥</span>
              </button>
            </div>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm); margin-top: var(--space-xs); position: relative;">
            <h2 class="my-info-section-title" style="margin: 0; flex: 0 0 auto;">ë‚˜ì˜ ìŠ¤íƒ¯</h2>
            <!-- í™˜ì‚°íƒ€ì±„ í•© -->
            <div class="my-info-key-stat-item" style="max-width: 300px; min-width: 250px; margin: 0; flex: 0 0 auto; left: 50%; transform: translateX(-50%);">
              <div class="my-info-key-stat-label">í™˜ì‚°íƒ€ì±„ í•©</div>
              <div class="my-info-key-stat-value-wrapper">
                <div class="my-info-key-stat-value" id="keyStatTachae">-</div>
                <div class="my-info-key-stat-change" id="keyStatTachaeChange">-</div>
              </div>
            </div>
          </div>
          <div class="my-info-stats-list">
            <!-- 1ì»¬ëŸ¼ -->
            <div class="my-info-stats-column" id="statsColumn1"></div>
            <!-- 2ì»¬ëŸ¼ -->
            <div class="my-info-stats-column" id="statsColumn2"></div>
            <!-- 3ì»¬ëŸ¼ -->
            <div class="my-info-stats-column" id="statsColumn3"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ ì˜ì—­ -->
    <div class="my-info-bottom-section">
      <!-- ì™¼ìª½: í™˜ìˆ˜ í˜¼ ê²½í—˜ì¹˜ -->
      <div class="my-info-bottom-left">
        <div class="my-info-stats-section">
          <h2 class="my-info-section-title">í™˜ìˆ˜ ì´ˆê¸°í™” ì‹œ í™˜ìˆ˜ í˜¼ ê²½í—˜ì¹˜</h2>
          <div id="soulExpInfo"></div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ê°ì¸ ë“±ë¡íš¨ê³¼, ê°ì¸ ì¥ì°©íš¨ê³¼ -->
      <div class="my-info-bottom-right">
        <div class="my-info-key-stats-section">
          <div style="display: flex; flex-direction: column; gap: 2px;">
            <h2 class="my-info-section-title">ê°ì¸ íš¨ê³¼</h2>
            <div class="my-info-engraving-notice" style="font-size: 9px; color: var(--text-secondary); padding: 0 2px;">
              âš ï¸ ê°ì¸ ì •ë³´ëŠ” ë ˆë²¨ì— ë”°ë¥¸ ìŠ¤íƒ¯ ìë™ìœ¼ë¡œ ê³„ì‚° ì•ˆë©ë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì•¼í•©ë‹ˆë‹¤.
            </div>
          </div>
          <div class="my-info-key-stats-grid" id="keyStatsGrid">
            <div class="my-info-key-stat-item">
              <div class="my-info-key-stat-label">ê°ì¸ ë“±ë¡íš¨ê³¼</div>
              <div class="my-info-key-stat-registration-list" id="keyStatRegistrationList"></div>
            </div>
            <div class="my-info-key-stat-item">
              <div class="my-info-key-stat-label">ê°ì¸ ì¥ì°©íš¨ê³¼</div>
              <div class="my-info-key-stat-bind-list" id="keyStatBindList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  `}function O(){const t=localStorage.getItem("myInfo_profiles");if(t)try{return JSON.parse(t)}catch{return[]}return[]}function Q(t){localStorage.setItem("myInfo_profiles",JSON.stringify(t))}function U(){return localStorage.getItem("myInfo_currentProfileId")||null}function q(t){t?localStorage.setItem("myInfo_currentProfileId",t):localStorage.removeItem("myInfo_currentProfileId"),e.currentProfileId=t}function Se(t){const n=O(),i={id:`profile_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:t||`í”„ë¡œíŒŒì¼ ${n.length+1}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return n.push(i),Q(n),i}function ie(t,n){const a=O(),i=a.find(s=>s.id===t);return i?(Object.assign(i,n),i.updatedAt=new Date().toISOString(),Q(a),i):null}function Ke(t,n={}){const i=O().filter(s=>s.id!==t);Q(i),localStorage.removeItem(`myInfo_profile_${t}`),e.currentProfileId===t&&(i.length>0?(q(i[0].id),re(i[0].id,n)):(q(null),e.userStats={},e.bondSpirits={ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},e.activeSpirits={ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null},e.baselineStats={},e.baselineKeyStats={tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},e.savedSoulExp=0,e.engravingData={ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},e.baselineStatsHash=null,e.baselineSoulExpHash=null))}function se(t){const n={userStats:e.userStats,bondSpirits:e.bondSpirits,activeSpirits:e.activeSpirits,baselineStats:e.baselineStats,baselineKeyStats:e.baselineKeyStats,savedSoulExp:e.savedSoulExp,engravingData:e.engravingData,baselineStatsHash:e.baselineStatsHash,baselineSoulExpHash:e.baselineSoulExpHash};localStorage.setItem(`myInfo_profile_${t}`,JSON.stringify(n)),ie(t,{updatedAt:new Date().toISOString()})}function re(t,n={}){const a=localStorage.getItem(`myInfo_profile_${t}`);if(a)try{const i=JSON.parse(a);e.userStats=i.userStats||{};const s=i.bondSpirits||{ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},c=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];for(const o of c)s[o]&&(s[o]=s[o].map(l=>z(l.name)?{...l,level:25}:l));e.bondSpirits=s;const r=i.activeSpirits||{ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null};for(const o of c)r[o]&&z(r[o].name)&&(r[o]={...r[o],level:25});if(e.activeSpirits=r,e.baselineStats=i.baselineStats||{},e.baselineKeyStats=i.baselineKeyStats||{tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},e.savedSoulExp=i.savedSoulExp||0,e.engravingData=i.engravingData||{ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},e.baselineStatsHash=i.baselineStatsHash||null,e.baselineSoulExpHash=i.baselineSoulExpHash||null,e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,e.isInitialLoad=!0,n.renderBondSlots&&(n.renderBondSlots("ìˆ˜í˜¸"),n.renderBondSlots("íƒ‘ìŠ¹"),n.renderBondSlots("ë³€ì‹ ")),n.renderActiveSpiritSelect&&(n.renderActiveSpiritSelect("ìˆ˜í˜¸"),n.renderActiveSpiritSelect("íƒ‘ìŠ¹"),n.renderActiveSpiritSelect("ë³€ì‹ ")),n.renderStats&&n.renderStats(),n.updateTotalStats){const o=n.updateTotalStats();o&&typeof o.then=="function"?o.then(()=>{e.isInitialLoad=!1}).catch(()=>{e.isInitialLoad=!1}):e.isInitialLoad=!1}else e.isInitialLoad=!1;n.updateSoulExp&&(e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,n.updateSoulExp())}catch{}}function te(){const t=_.profileSelect;if(!t)return;const n=O(),a=e.currentProfileId;t.innerHTML='<option value="">í”„ë¡œíŒŒì¼ ì—†ìŒ</option>',n.forEach(s=>{const c=j("option");c.value=s.id,c.textContent=s.name,s.id===a&&(c.selected=!0),t.appendChild(c)});const i=a!==null;_.editProfileBtn&&(_.editProfileBtn.disabled=!i),_.deleteProfileBtn&&(_.deleteProfileBtn.disabled=!i)}function Je(t,n=null,a={}){const i=j("div","my-info-profile-modal"),s=n?O().find(r=>r.id===n):null;i.innerHTML=`
    <div class="my-info-profile-modal-content">
      <div class="my-info-profile-modal-header">
        <div class="my-info-profile-modal-title">
          ${t==="create"?"ìƒˆ í”„ë¡œíŒŒì¼ ìƒì„±":t==="edit"?"í”„ë¡œíŒŒì¼ ì´ë¦„ ìˆ˜ì •":""}
        </div>
        <button class="my-info-profile-modal-close">Ã—</button>
      </div>
      <div class="my-info-profile-form-group">
        <label class="my-info-profile-form-label">í”„ë¡œíŒŒì¼ ì´ë¦„</label>
        <input type="text" class="my-info-profile-form-input" id="profileNameInput" 
               value="${s?s.name:""}" 
               placeholder="í”„ë¡œíŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="50">
      </div>
      <div class="my-info-profile-modal-actions">
        <button class="my-info-profile-btn" id="profileModalCancelBtn">ì·¨ì†Œ</button>
        <button class="my-info-profile-btn primary" id="profileModalSaveBtn">
          ${t==="create"?"ìƒì„±":"ì €ì¥"}
        </button>
      </div>
    </div>
  `,document.body.appendChild(i);const c=()=>i.remove();i.querySelector(".my-info-profile-modal-close").addEventListener("click",c),i.querySelector("#profileModalCancelBtn").addEventListener("click",c),i.addEventListener("click",r=>{r.target===i&&c()}),i.querySelector("#profileModalSaveBtn").addEventListener("click",()=>{const o=i.querySelector("#profileNameInput").value.trim();if(!o){alert("í”„ë¡œíŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(t==="create"){const l=Se(o),f=JSON.parse(JSON.stringify(e.bondSpirits)),d=JSON.parse(JSON.stringify(e.activeSpirits)),u=JSON.parse(JSON.stringify(e.engravingData));e.userStats={},e.baselineStats={},e.baselineKeyStats={tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},e.savedSoulExp=0,e.baselineStatsHash=null,e.baselineSoulExpHash=null,e.bondSpirits=f,e.activeSpirits=d,e.engravingData=u,e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,e.isInitialLoad=!0,q(l.id),se(l.id),te(),a.renderBondSlots&&(a.renderBondSlots("ìˆ˜í˜¸"),a.renderBondSlots("íƒ‘ìŠ¹"),a.renderBondSlots("ë³€ì‹ ")),a.renderActiveSpiritSelect&&(a.renderActiveSpiritSelect("ìˆ˜í˜¸"),a.renderActiveSpiritSelect("íƒ‘ìŠ¹"),a.renderActiveSpiritSelect("ë³€ì‹ ")),a.renderStats&&a.renderStats(),a.updateTotalStats&&a.updateTotalStats(),a.updateSoulExp&&a.updateSoulExp(),alert("í”„ë¡œíŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚˜ì˜ ìŠ¤íƒ¯ì„ ìƒˆë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.")}else t==="edit"&&n&&(ie(n,{name:o}),te(),alert("í”„ë¡œíŒŒì¼ ì´ë¦„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤."));c()}),i.querySelector("#profileNameInput").addEventListener("keydown",r=>{r.key==="Enter"&&i.querySelector("#profileModalSaveBtn").click()}),setTimeout(()=>{i.querySelector("#profileNameInput").focus(),i.querySelector("#profileNameInput").select()},100)}function ke(){if(e.currentProfileId)return;const t=localStorage.getItem("myInfo_userStats");if(t)try{e.userStats=JSON.parse(t)}catch{e.userStats={}}}function Fe(){e.currentProfileId||localStorage.setItem("myInfo_userStats",JSON.stringify(e.userStats))}function Ue(t={}){const n=U();if(e.currentProfileId=n,n)re(n,t);else{const a=localStorage.getItem("myInfo_bondSpirits");if(a)try{e.bondSpirits=JSON.parse(a)}catch{}const i=localStorage.getItem("myInfo_activeSpirits");if(i)try{e.activeSpirits=JSON.parse(i)}catch{}const s=localStorage.getItem("myInfo_baselineStats");if(s)try{e.baselineStats=JSON.parse(s)}catch{}const c=localStorage.getItem("myInfo_savedSoulExp");if(c)try{e.savedSoulExp=parseInt(c,10)||0}catch{}const r=localStorage.getItem("myInfo_engravingData");if(r)try{e.engravingData=JSON.parse(r)}catch{e.engravingData={ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}}}const o=localStorage.getItem("myInfo_baselineKeyStats");if(o)try{e.baselineKeyStats=JSON.parse(o)}catch{}const l=localStorage.getItem("myInfo_baselineStatsHash");l&&(e.baselineStatsHash=l);const f=localStorage.getItem("myInfo_baselineSoulExpHash");f&&(e.baselineSoulExpHash=f)}}function Xe(){e.currentProfileId?se(e.currentProfileId):(localStorage.setItem("myInfo_bondSpirits",JSON.stringify(e.bondSpirits)),localStorage.setItem("myInfo_activeSpirits",JSON.stringify(e.activeSpirits)),localStorage.setItem("myInfo_baselineStats",JSON.stringify(e.baselineStats)),localStorage.setItem("myInfo_baselineKeyStats",JSON.stringify(e.baselineKeyStats)),localStorage.setItem("myInfo_savedSoulExp",e.savedSoulExp.toString()),localStorage.setItem("myInfo_engravingData",JSON.stringify(e.engravingData)),e.baselineStatsHash&&localStorage.setItem("myInfo_baselineStatsHash",e.baselineStatsHash),e.baselineSoulExpHash&&localStorage.setItem("myInfo_baselineSoulExpHash",e.baselineSoulExpHash))}async function me(){if(e.expTable)return e.expTable;try{return e.expTable=await pe(),e.expTable}catch{return null}}function ve(t,n,a,i){if(!t||!t[n])return 0;const s=t[n];let c=0;if(i>a&&i<s.length)for(let r=a+1;r<=i;r++)c+=s[r]||0;return c}function ye(){return["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "].map(a=>[...e.bondSpirits[a]||[]].sort((c,r)=>{const o=(c.name||"").localeCompare(r.name||"");return o!==0?o:(c.level||25)-(r.level||25)}).map(c=>`${c.name}:${c.level||25}`).join(",")).join("|")}async function Ge(t,n=!1){const a=_.soulExpInfo;if(!a)return;const i=ye(),s=e.baselineSoulExpHash&&i===e.baselineSoulExpHash;if(!n&&e.lastSoulExpHash===i&&e.lastSoulExpCalculation&&!s){a.innerHTML=e.lastSoulExpCalculation;return}e.lastSoulExpHash!==i&&(e.lastSoulExpHash=null,e.lastSoulExpCalculation=null),a.innerHTML="<p class='text-center text-sm text-light'>ê³„ì‚° ì¤‘...</p>";try{const c=await me();if(!c){a.innerHTML="<p class='text-center text-sm text-light'>ê²½í—˜ì¹˜ í…Œì´ë¸”ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";return}let r=0;const o={},l=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];for(const b of l){const h=e.bondSpirits[b]||[];let y=0;for(const v of h){if(z(v.name)){v.level=25;continue}if(!v.level||v.level===0)continue;const S=t(b).find(x=>x.name===v.name);if(!S)continue;const A=S.grade==="ë¶ˆë©¸"?"immortal":"legend",m=ve(c,A,0,v.level);y+=m}o[b]=y,r+=y}if(r===0){const b="<p class='text-center text-sm text-light'>ì´ˆê¸°í™”í•  í™˜ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";a.innerHTML=b,e.lastSoulExpCalculation=b,e.lastSoulExpHash=i;return}const d=Math.ceil(r/1e3);let u='<div class="my-info-soul-exp-grid">';l.forEach(b=>{const h=o[b]||0;u+=`
        <div class="my-info-soul-exp-category-item">
          <div class="my-info-soul-exp-category-label">${b}</div>
          <div class="my-info-soul-exp-category-value">${h.toLocaleString()} exp</div>
        </div>
      `}),u+=`
      <div class="my-info-soul-exp-total-item">
        <div class="my-info-soul-exp-total-label">ì´í•©</div>
        <div class="my-info-soul-exp-total-value">${r.toLocaleString()} exp</div>
      </div>
    `;let g=!1;if(e.baselineSoulExpHash&&i===e.baselineSoulExpHash&&(g=!0),e.savedSoulExp>0){let b=r-e.savedSoulExp;g&&(b=0);let h="",y="";b>0?(h=`+${b.toLocaleString()} exp (ë¶€ì¡±)`,y="#e74c3c"):b<0?(h=`${b.toLocaleString()} exp (ì—¬ìœ )`,y="#4CAF50"):(h="0 exp (ë™ì¼)",y="var(--text-secondary)"),u+=`
        <div class="my-info-soul-exp-baseline-item">
          <div class="my-info-soul-exp-baseline-label">ê¸°ì¤€ ëŒ€ë¹„</div>
          <div class="my-info-soul-exp-baseline-value" style="color: ${y};">
            ${h}
          </div>
          <div class="my-info-soul-exp-baseline-text">
            ê¸°ì¤€: ${e.savedSoulExp.toLocaleString()} exp
          </div>
        </div>
      `}else u+=`
        <div class="my-info-soul-exp-baseline-item" style="opacity: 0.7;">
          <div class="my-info-soul-exp-baseline-label">ê¸°ì¤€ ëŒ€ë¹„</div>
          <div class="my-info-soul-exp-baseline-value" style="color: var(--text-secondary);">
            ê¸°ì¤€ ë¯¸ì„¤ì •
          </div>
          <div class="my-info-soul-exp-baseline-text">
            í˜„ì¬: ${r.toLocaleString()} exp (ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ê¸°ì¤€ ì„¤ì •)
          </div>
        </div>
      `;u+=`
      <div class="my-info-soul-exp-need-item">
        <div class="my-info-soul-exp-need-label">í•„ìš”ê²½í—˜ì¹˜</div>
        <div class="my-info-soul-exp-need-value">
          <img src="assets/img/high-soul.jpg" alt="ìµœìƒê¸‰ í™˜ìˆ˜í˜¼" loading="lazy">
          <span>ì•½ <strong>${d.toLocaleString()}</strong>ê°œ</span>
        </div>
      </div>
    `,u+="</div>",a.innerHTML=u,e.lastSoulExpCalculation=u,e.lastSoulExpHash=i}catch{a.innerHTML="<p class='text-center text-sm text-light'>ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>"}}const J=10*1024*1024,N=6,ge=100,he=0,be=25,Ee=1e9,xe=-1e9,M=4,ne=1e4,ae=10;function $(t){if(!t||typeof t!="string"||t.length===0||t.length>ge)return!1;const n=["<",">","&",'"',"'","/","\\","{","}","[","]","(",")","`","$","%"];for(const a of n)if(t.includes(a))return!1;for(const a of t){const i=a.charCodeAt(0),s=i>=44032&&i<=55203||i>=12593&&i<=12686||i>=4352&&i<=4607,c=i>=65&&i<=90||i>=97&&i<=122,r=i>=48&&i<=57,o=/\s/.test(a),l=["-","_",".",":"].includes(a);if(!s&&!c&&!r&&!o&&!l)return!1}return!0}function oe(t){const n=Number(t);return!isNaN(n)&&Number.isInteger(n)&&n>=he&&n<=be}function C(t){const n=Number(t);return!isNaN(n)&&n>=xe&&n<=Ee&&isFinite(n)}function Ie(t){if(!t||typeof t!="object")return!1;if(t.registration!==void 0&&t.registration!==null)if(Array.isArray(t.registration)){if(t.registration.length>M)return!1;for(const n of t.registration){if(!n||typeof n!="object")return!1;const a=n.statKey||n.key,i=n.value;if(!a||!$(a)||!C(i))return!1}}else if(typeof t.registration=="object"){if(Object.keys(t.registration).length>M)return!1;for(const[a,i]of Object.entries(t.registration))if(!$(a)||!C(i))return!1}else return!1;if(t.bind!==void 0&&t.bind!==null){if(typeof t.bind!="object"||Array.isArray(t.bind))return!1;for(const[n,a]of Object.entries(t.bind))if(!$(n)||!C(a))return!1}return!0}function le(t){if(!t||t===null)return{valid:!0};if(typeof t!="object")return{valid:!1,error:"ê°ì¸ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};if(Object.keys(t).length===0)return{valid:!0};if(t.registration!==void 0&&t.registration!==null)if(Array.isArray(t.registration)){if(t.registration.length>M)return{valid:!1,error:`ë“±ë¡íš¨ê³¼ê°€ ${M}ê°œë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`};for(const n of t.registration){if(!n||typeof n!="object")return{valid:!1,error:"ë“±ë¡íš¨ê³¼ í•­ëª©ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};const a=n.statKey||n.key,i=n.value;if(!a)return{valid:!1,error:"ë“±ë¡íš¨ê³¼ ìŠ¤íƒ¯ëª…ì´ ì—†ìŠµë‹ˆë‹¤."};if(!$(a))return{valid:!1,error:`ë“±ë¡íš¨ê³¼ ìŠ¤íƒ¯ëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ${a}`};if(!C(i))return{valid:!1,error:`ë“±ë¡íš¨ê³¼ ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ${i}`}}}else if(typeof t.registration=="object"){if(Object.keys(t.registration).length>M)return{valid:!1,error:`ë“±ë¡íš¨ê³¼ê°€ ${M}ê°œë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`};for(const[a,i]of Object.entries(t.registration)){if(!$(a))return{valid:!1,error:`ë“±ë¡íš¨ê³¼ ìŠ¤íƒ¯ëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ${a}`};if(!C(i))return{valid:!1,error:`ë“±ë¡íš¨ê³¼ ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ${i}`}}}else return{valid:!1,error:"ë“±ë¡íš¨ê³¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};if(t.bind!==void 0&&t.bind!==null){if(typeof t.bind!="object"||Array.isArray(t.bind))return{valid:!1,error:"ì¥ì°©íš¨ê³¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};for(const[n,a]of Object.entries(t.bind)){if(!$(n))return{valid:!1,error:`ì¥ì°©íš¨ê³¼ ìŠ¤íƒ¯ëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ${n}`};if(!C(a))return{valid:!1,error:`ì¥ì°©íš¨ê³¼ ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: ${a}`}}}return{valid:!0}}function k(t,n){return!t||typeof t!="object"?{valid:!1,error:"í™˜ìˆ˜ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."}:!t.name||typeof t.name!="string"?{valid:!1,error:"í™˜ìˆ˜ëª…ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."}:$(t.name)?oe(t.level)?t.engraving&&!Ie(t.engraving)?{valid:!1,error:"ê°ì¸ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."}:["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "].includes(n)?{valid:!0}:{valid:!1,error:`ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤: ${n}`}:{valid:!1,error:`ë ˆë²¨ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ${t.level}`}:{valid:!1,error:`í™˜ìˆ˜ëª…ì— í—ˆìš©ë˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤: ${t.name}`}}function ee(t){if(!t||typeof t!="object")return{valid:!1,error:"ìŠ¤íƒ¯ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};if(Object.keys(t).length>100)return{valid:!1,error:"ìŠ¤íƒ¯ ê°œìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤."};for(const[a,i]of Object.entries(t)){if(!$(a))return{valid:!1,error:`ìŠ¤íƒ¯ í‚¤ì— í—ˆìš©ë˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤: ${a}`};if(!C(i))return{valid:!1,error:`ìŠ¤íƒ¯ ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ${a}=${i}`}}return{valid:!0}}function ce(t){if(!t||typeof t!="object")return{valid:!1,error:"ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};const n=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];if(t.spirits){if(typeof t.spirits!="object")return{valid:!1,error:"í™˜ìˆ˜ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};for(const a of n){const i=t.spirits[a];if(i){if(!Array.isArray(i))return{valid:!1,error:`${a} í™˜ìˆ˜ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.`};if(i.length>N)return{valid:!1,error:`${a} í™˜ìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. (ìµœëŒ€ ${N}ê°œ)`};for(let s=0;s<i.length;s++){const c=k(i[s],a);if(!c.valid)return{valid:!1,error:`${a} í™˜ìˆ˜ ${s+1}: ${c.error}`}}}}}if(t.activeSpirits){if(typeof t.activeSpirits!="object")return{valid:!1,error:"ì‚¬ìš©ì¤‘ í™˜ìˆ˜ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};for(const a of n){const i=t.activeSpirits[a];if(i!=null){if(typeof i!="object")return{valid:!1,error:`${a} ì‚¬ìš©ì¤‘ í™˜ìˆ˜ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.`};if(i.name){const s=k(i,a);if(!s.valid)return{valid:!1,error:`${a} ì‚¬ìš©ì¤‘ í™˜ìˆ˜: ${s.error}`}}}}}if(t.userStats){const a=ee(t.userStats);if(!a.valid)return a}return{valid:!0}}function fe(t){return t?t.size>J?{valid:!1,error:`íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ ${J/1024/1024}MB)`}:t.size===0?{valid:!1,error:"íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."}:{valid:!0}:{valid:!1,error:"íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."}}function de(t){if(!t)return{valid:!1,error:"íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."};const n=t.name.toLowerCase(),a=n.endsWith(".json"),i=n.endsWith(".csv");if(!a&&!i)return{valid:!1,error:"JSON ë˜ëŠ” CSV íŒŒì¼ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤."};const s=["application/json","text/json","text/csv","text/plain"];return t.type&&!s.includes(t.type)&&E.warn(`ì˜ì‹¬ìŠ¤ëŸ¬ìš´ MIME íƒ€ì…: ${t.type}`),{valid:!0}}function F(t,n=0,a=new WeakSet){if(n>ae)return{valid:!1,error:`JSON ê¹Šì´ê°€ ë„ˆë¬´ ê¹ŠìŠµë‹ˆë‹¤. (ìµœëŒ€ ${ae}ë‹¨ê³„)`};if(t===null||typeof t!="object")return{valid:!0};if(a.has(t))return{valid:!1,error:"ìˆœí™˜ ì°¸ì¡°ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."};a.add(t);try{if(Array.isArray(t))for(const i of t){const s=F(i,n+1,a);if(!s.valid)return s}else for(const i of Object.values(t)){const s=F(i,n+1,a);if(!s.valid)return s}}finally{a.delete(t)}return{valid:!0}}function ue(t){if(!t||typeof t!="string")return"myInfo_export";let n=t.replace(/[\/\\\?\*\|"<>:]/g,"_").replace(/\.\./g,"_").trim();return n.length>200&&(n=n.substring(0,200)),n.length===0&&(n="myInfo_export"),n}function Ae(t){return t>ne?{valid:!1,error:`CSV íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ ${ne}ì¤„)`}:{valid:!0}}function W(){const t=U(),n=O(),a=t?n.find(r=>r.id===t):null,i={ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]};["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "].forEach(r=>{(e.bondSpirits[r]||[]).forEach(l=>{const f=e.engravingData[r]?.[l.name];let d=[];f&&f.registration&&(Array.isArray(f.registration)?d=f.registration.map(g=>({statKey:g.statKey||"",value:g.value||0})):typeof f.registration=="object"&&(d=Object.entries(f.registration).map(([g,b])=>({statKey:g,value:b||0}))));const u=f&&f.bind?f.bind:{};i[r].push({name:l.name,level:l.level||0,engraving:{registration:d,bind:u}})})});const c={version:"1.0",exportDate:new Date().toISOString(),profile:a?{id:a.id,name:a.name}:null,data:{spirits:i,activeSpirits:{ìˆ˜í˜¸:e.activeSpirits.ìˆ˜í˜¸?{name:e.activeSpirits.ìˆ˜í˜¸.name,level:e.activeSpirits.ìˆ˜í˜¸.level||0}:null,íƒ‘ìŠ¹:e.activeSpirits.íƒ‘ìŠ¹?{name:e.activeSpirits.íƒ‘ìŠ¹.name,level:e.activeSpirits.íƒ‘ìŠ¹.level||0}:null,ë³€ì‹ :e.activeSpirits.ë³€ì‹ ?{name:e.activeSpirits.ë³€ì‹ .name,level:e.activeSpirits.ë³€ì‹ .level||0}:null},userStats:e.userStats}};return JSON.stringify(c,null,2)}async function ze(){try{const t=W();return await navigator.clipboard.writeText(t),E.log("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."),!0}catch{try{const n=document.createElement("textarea");n.value=W(),n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();const a=document.execCommand("copy");if(document.body.removeChild(n),a)return E.log("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."),!0;throw new Error("ë³µì‚¬ ì‹¤íŒ¨")}catch{return alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”."),!1}}}async function qe(t={}){try{const n=await navigator.clipboard.readText();if(!n||!n.trim())return alert("í´ë¦½ë³´ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."),!1;let a;try{a=JSON.parse(n)}catch(o){return alert(`í´ë¦½ë³´ë“œ ë‚´ìš©ì´ ì˜¬ë°”ë¥¸ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤: ${o.message}`),!1}if(n.length>J)return alert("í´ë¦½ë³´ë“œ ë‚´ìš©ì´ ë„ˆë¬´ í½ë‹ˆë‹¤."),!1;const i=F(a);if(!i.valid)return alert(i.error),!1;if(a.version&&a.version!=="1.0"&&!confirm(`ì´ ë°ì´í„°ëŠ” ë²„ì „ ${a.version} í˜•ì‹ì…ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return!1;if(!a.data)return alert("ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤."),!1;const s=a.data,c=ce(s);if(!c.valid)return alert(c.error),!1;const r=Array.isArray(K.allSpirits)?K.allSpirits:[];if(s.spirits){const o=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];e.bondSpirits={ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},e.engravingData={ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},o.forEach(l=>{const f=s.spirits[l]||[];f.length>N&&(E.warn(`${l} í™˜ìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ìµœëŒ€ ${N}ê°œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.`),f.splice(N)),f.forEach(d=>{const u=k(d,l);if(!u.valid){E.warn(`í™˜ìˆ˜ ê²€ì¦ ì‹¤íŒ¨: ${u.error}`);return}const g=r.find(b=>b.name===d.name&&b.type===l);if(g)if(e.bondSpirits[l].push({...g,level:d.level||0}),d.engraving)if(le(d.engraving).valid){let h=[];d.engraving.registration&&(Array.isArray(d.engraving.registration)?h=d.engraving.registration:typeof d.engraving.registration=="object"&&(h=Object.entries(d.engraving.registration).map(([y,v])=>({statKey:y,value:v||0})))),e.engravingData[l][d.name]={registration:h,bind:d.engraving.bind||{}}}else E.warn(`ê°ì¸ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨: ${d.name}`),e.engravingData[l][d.name]||(e.engravingData[l][d.name]={registration:[],bind:{}});else e.engravingData[l][d.name]||(e.engravingData[l][d.name]={registration:[],bind:{}});else E.warn(`í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${d.name} (${l})`),e.bondSpirits[l].push({name:d.name,level:d.level||0})})})}if(s.activeSpirits){const o=s.activeSpirits,l=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];e.activeSpirits={ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null},l.forEach(f=>{const d=o[f];if(d&&d.name){const u=r.find(g=>g.name===d.name&&g.type===f);u?e.activeSpirits[f]={...u,level:d.level||0}:(E.warn(`ì‚¬ìš©ì¤‘ í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${d.name} (${f})`),e.activeSpirits[f]={name:d.name,level:d.level||0})}})}else e.activeSpirits={ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null};if(s.userStats){const o=ee(s.userStats);o.valid?e.userStats=s.userStats:(E.warn(`ìŠ¤íƒ¯ ê²€ì¦ ì‹¤íŒ¨: ${o.error}`),e.userStats={})}else e.userStats={};if(e.baselineStats={},e.baselineKeyStats={tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},e.savedSoulExp=0,e.baselineStatsHash=null,e.baselineSoulExpHash=null,e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,e.isInitialLoad=!0,t.renderBondSlots&&(t.renderBondSlots("ìˆ˜í˜¸"),t.renderBondSlots("íƒ‘ìŠ¹"),t.renderBondSlots("ë³€ì‹ ")),t.renderActiveSpiritSelect&&(t.renderActiveSpiritSelect("ìˆ˜í˜¸"),t.renderActiveSpiritSelect("íƒ‘ìŠ¹"),t.renderActiveSpiritSelect("ë³€ì‹ ")),t.renderStats&&t.renderStats(),t.updateTotalStats){const o=t.updateTotalStats();o&&typeof o.then=="function"?o.then(()=>{const{allTotalStats:l}=Y(Z),f=g=>{const b=e.userStats[g]||0,h=l[g]||0;return Math.round(b+h)},d=Math.round(f("damageResistancePenetration")+f("damageResistance")+Math.round(Math.round(f("pvpDamagePercent"))*10)+Math.round(Math.round(f("pvpDefensePercent"))*10));e.baselineKeyStats.tachaeTotal=d,e.baselineKeyStats.statusEffectResistance=f("statusEffectResistance"),e.baselineKeyStats.statusEffectAccuracy=f("statusEffectAccuracy"),[...H].forEach(g=>{const b=e.userStats[g.key]||0,h=l[g.key]||0;e.baselineStats[g.key]=Math.round(b+h)}),e.isInitialLoad=!1}).catch(l=>{E.error("Error updating stats after paste:",l),e.isInitialLoad=!1}):e.isInitialLoad=!1}else e.isInitialLoad=!1;return t.updateSoulExp&&(e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,t.updateSoulExp()),E.log("í´ë¦½ë³´ë“œì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤."),!0}catch(n){return n.name==="NotAllowedError"?alert("í´ë¦½ë³´ë“œ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”."):alert(`í´ë¦½ë³´ë“œì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${n.message}`),!1}}function We(){try{const t=W(),n=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(n),i=document.createElement("a"),s=U(),c=O(),r=s?c.find(f=>f.id===s):null,o=r?`myInfo_${r.name}_${new Date().toISOString().split("T")[0]}.json`:`myInfo_${new Date().toISOString().split("T")[0]}.json`,l=ue(o);i.href=a,i.download=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),E.log("JSON export completed")}catch{alert("JSON ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}function Te(){const t=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "],n=[];return n.push("ì¹´í…Œê³ ë¦¬,í™˜ìˆ˜ëª…,ë ˆë²¨,í™œì„±í™”,ë“±ë¡íš¨ê³¼1,ë“±ë¡íš¨ê³¼2,ë“±ë¡íš¨ê³¼3,ë“±ë¡íš¨ê³¼4,ì¥ì°©íš¨ê³¼"),t.forEach(a=>{(e.bondSpirits[a]||[]).forEach(s=>{const c=e.activeSpirits[a]?.name===s.name,r=e.engravingData[a]?.[s.name]||{};let o=[];r.registration&&(Array.isArray(r.registration)?o=r.registration:typeof r.registration=="object"&&(o=Object.entries(r.registration).map(([u,g])=>({statKey:u,value:g||0}))));const l=[];for(let u=0;u<4;u++)if(u<o.length&&o[u]){const g=o[u];l.push(`${g.statKey||""}:${g.value||0}`)}else l.push("");const f=r.bind||{},d=Object.entries(f).map(([u,g])=>`${u}:${g}`).join(";");n.push([a,s.name,s.level||0,c?"Y":"N",l[0]||"",l[1]||"",l[2]||"",l[3]||"",d||""].map(u=>`"${String(u).replace(/"/g,'""')}"`).join(","))})}),n.push(""),n.push("=== ì‚¬ìš©ì¤‘ í™˜ìˆ˜ ==="),n.push("ì¹´í…Œê³ ë¦¬,í™˜ìˆ˜ëª…,ë ˆë²¨"),t.forEach(a=>{const i=e.activeSpirits[a];i&&n.push([a,i.name,i.level||0].map(s=>`"${String(s).replace(/"/g,'""')}"`).join(","))}),n.push(""),n.push("=== ì „ì²´ ìŠ¤íƒ¯ ==="),n.push("ìŠ¤íƒ¯ëª…,ê°’"),Object.entries(e.userStats).forEach(([a,i])=>{n.push([`"${a}"`,`"${i}"`].join(","))}),n.join(`
`)}function Ye(){try{const t=Te(),n=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(n),i=document.createElement("a"),s=U(),c=O(),r=s?c.find(f=>f.id===s):null,o=r?`myInfo_${r.name}_${new Date().toISOString().split("T")[0]}.csv`:`myInfo_${new Date().toISOString().split("T")[0]}.csv`,l=ue(o);i.href=a,i.download=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),E.log("CSV export completed")}catch{alert("CSV ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}async function Ze(t,n={}){return new Promise((a,i)=>{const s=fe(t);if(!s.valid){alert(s.error),i(new Error(s.error));return}const c=de(t);if(!c.valid){alert(c.error),i(new Error(c.error));return}const r=new FileReader;r.onload=o=>{try{const l=o.target.result;if(l.length>J)throw new Error("íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤.");let f;try{f=JSON.parse(l)}catch(h){throw new Error(`JSON íŒŒì‹± ì˜¤ë¥˜: ${h.message}`)}const d=F(f);if(!d.valid)throw new Error(d.error);if(f.version&&f.version!=="1.0"&&!confirm(`ì´ íŒŒì¼ì€ ë²„ì „ ${f.version} í˜•ì‹ì…ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){a(!1);return}if(!f.data)throw new Error("ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.");const u=f.data,g=ce(u);if(!g.valid)throw new Error(g.error);const b=Array.isArray(K.allSpirits)?K.allSpirits:[];if(u.spirits){const h=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];e.bondSpirits={ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},e.engravingData={ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},h.forEach(y=>{const v=u.spirits[y]||[];v.length>N&&(E.warn(`${y} í™˜ìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ìµœëŒ€ ${N}ê°œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.`),v.splice(N)),v.forEach(p=>{const S=k(p,y);if(!S.valid){E.warn(`í™˜ìˆ˜ ê²€ì¦ ì‹¤íŒ¨: ${S.error}`);return}const I=b.find(A=>A.name===p.name&&A.type===y);if(I)if(e.bondSpirits[y].push({...I,level:p.level||0}),p.engraving){const A=le(p.engraving);if(A.valid){let m=[];p.engraving.registration&&(Array.isArray(p.engraving.registration)?m=p.engraving.registration:typeof p.engraving.registration=="object"&&(m=Object.entries(p.engraving.registration).map(([x,T])=>({statKey:x,value:T||0})))),e.engravingData[y][p.name]={registration:m,bind:p.engraving.bind||{}},E.log(`ê°ì¸ ë°ì´í„° ì €ì¥: ${y} - ${p.name}`,{registration:m,bind:p.engraving.bind||{}})}else E.warn(`ê°ì¸ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨: ${p.name} - ${A.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`),e.engravingData[y][p.name]||(e.engravingData[y][p.name]={registration:[],bind:{}})}else e.engravingData[y][p.name]||(e.engravingData[y][p.name]={registration:[],bind:{}});else E.warn(`í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${p.name} (${y})`),e.bondSpirits[y].push({name:p.name,level:p.level||0})})})}else{const h=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "],y=u.bondSpirits||{ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]};e.bondSpirits={ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},e.engravingData=u.engravingData||{ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},h.forEach(v=>{(y[v]||[]).forEach(S=>{const I=b.find(A=>A.name===S.name&&A.type===v);I?e.bondSpirits[v].push({...I,level:S.level||I.level||0}):(E.warn(`í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${S.name} (${v})`),e.bondSpirits[v].push({name:S.name,level:S.level||0}))})})}if(u.activeSpirits){const h=u.activeSpirits,y=["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "];e.activeSpirits={ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null},y.forEach(v=>{const p=h[v];if(p&&p.name){const S=b.find(I=>I.name===p.name&&I.type===v);S?e.activeSpirits[v]={...S,level:p.level||0}:(E.warn(`ì‚¬ìš©ì¤‘ í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${p.name} (${v})`),e.activeSpirits[v]={name:p.name,level:p.level||0})}})}else e.activeSpirits={ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null};if(u.userStats){const h=ee(u.userStats);h.valid?e.userStats=u.userStats:(E.warn(`ìŠ¤íƒ¯ ê²€ì¦ ì‹¤íŒ¨: ${h.error}`),e.userStats={})}else e.userStats={};if(e.baselineStats={},e.baselineKeyStats={tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},e.savedSoulExp=0,e.baselineStatsHash=null,e.baselineSoulExpHash=null,e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,e.isInitialLoad=!0,n.renderBondSlots&&(n.renderBondSlots("ìˆ˜í˜¸"),n.renderBondSlots("íƒ‘ìŠ¹"),n.renderBondSlots("ë³€ì‹ ")),n.renderActiveSpiritSelect&&(n.renderActiveSpiritSelect("ìˆ˜í˜¸"),n.renderActiveSpiritSelect("íƒ‘ìŠ¹"),n.renderActiveSpiritSelect("ë³€ì‹ ")),n.renderStats&&n.renderStats(),n.updateTotalStats){const h=n.updateTotalStats();h&&typeof h.then=="function"?h.then(()=>{const{allTotalStats:y}=Y(Z),v=I=>{const A=e.userStats[I]||0,m=y[I]||0;return Math.round(A+m)},p=Math.round(v("damageResistancePenetration")+v("damageResistance")+Math.round(Math.round(v("pvpDamagePercent"))*10)+Math.round(Math.round(v("pvpDefensePercent"))*10));e.baselineKeyStats.tachaeTotal=p,e.baselineKeyStats.statusEffectResistance=v("statusEffectResistance"),e.baselineKeyStats.statusEffectAccuracy=v("statusEffectAccuracy"),[...H].forEach(I=>{const A=e.userStats[I.key]||0,m=y[I.key]||0;e.baselineStats[I.key]=Math.round(A+m)}),e.isInitialLoad=!1,a(!0)}).catch(y=>{E.error("Error updating stats after import:",y),e.isInitialLoad=!1,a(!0)}):(e.isInitialLoad=!1,a(!0))}else e.isInitialLoad=!1,a(!0);n.updateSoulExp&&(e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,n.updateSoulExp()),E.log("JSON import completed")}catch(l){alert(`JSON ê°€ì ¸ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${l.message}`),i(l)}},r.onerror=()=>{const o=new Error("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨");alert("íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),i(o)},r.readAsText(t)})}async function Qe(t,n={}){return new Promise((a,i)=>{const s=fe(t);if(!s.valid){alert(s.error),i(new Error(s.error));return}const c=de(t);if(!c.valid){alert(c.error),i(new Error(c.error));return}const r=new FileReader;r.onload=o=>{try{const f=o.target.result.split(`
`).filter(v=>v.trim()),d=Ae(f.length);if(!d.valid)throw new Error(d.error);if(f.length===0||!f[0].includes("ì¹´í…Œê³ ë¦¬"))throw new Error("ì˜ëª»ëœ CSV í˜•ì‹ì…ë‹ˆë‹¤.");const u={ìˆ˜í˜¸:[],íƒ‘ìŠ¹:[],ë³€ì‹ :[]},g={ìˆ˜í˜¸:null,íƒ‘ìŠ¹:null,ë³€ì‹ :null},b={ìˆ˜í˜¸:{},íƒ‘ìŠ¹:{},ë³€ì‹ :{}},h={};let y="spirits";for(let v=1;v<f.length;v++){const p=f[v].trim();if(!p)continue;if(p.startsWith("=== ì‚¬ìš©ì¤‘ í™˜ìˆ˜ ===")){y="activeSpirits",v++;continue}else if(p.startsWith("=== ì „ì²´ ìŠ¤íƒ¯ ===")){y="userStats",v++;continue}else if(p.startsWith("==="))continue;const S=[];let I="",A=!1;for(let m=0;m<p.length;m++){const x=p[m];x==='"'?A&&p[m+1]==='"'?(I+='"',m++):A=!A:x===","&&!A?(S.push(I),I=""):I+=x}if(S.push(I),y==="spirits"){if(S.length<3)continue;const m=S[0].replace(/"/g,"").trim(),x=S[1].replace(/"/g,"").trim(),T=parseInt(S[2].replace(/"/g,""))||0,P=S[3]?.replace(/"/g,"").trim()==="Y";if(!["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "].includes(m))continue;if(!$(x)){E.warn(`í™˜ìˆ˜ëª… ê²€ì¦ ì‹¤íŒ¨: ${x}`);continue}if(!oe(T)){E.warn(`ë ˆë²¨ ê²€ì¦ ì‹¤íŒ¨: ${T}`);continue}if(u[m].length>=N){E.warn(`${m} í™˜ìˆ˜ê°€ ìµœëŒ€ ê°œìˆ˜ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.`);continue}const V=allSpirits.find(w=>w.name===x&&w.type===m);if(V){const w={...V,level:T};u[m].push(w),P&&(g[m]=w)}else{E.warn(`í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${x} (${m})`);const w={name:x,level:T};u[m].push(w),P&&(g[m]=w)}if(S.length>4){const w={registration:[],bind:{}};for(let L=4;L<8&&L<S.length;L++)if(S[L]&&S[L].replace(/"/g,"").trim()){const B=S[L].replace(/"/g,"").trim();if(B.includes(":")){const[X,G]=B.split(":"),R=X.trim(),D=parseFloat(G.trim())||0;$(R)&&C(D)&&w.registration.push({statKey:R,value:D})}}if(S[8]&&S[8].replace(/"/g,"")){const L=S[8].replace(/"/g,"").trim();L&&L.split(";").forEach(B=>{if(B.includes(":")){const[X,G]=B.split(":"),R=X.trim(),D=parseFloat(G.trim())||0;$(R)&&C(D)&&(w.bind[R]=D)}})}b[m][x]=w,E.log(`CSV ê°ì¸ ë°ì´í„° ì €ì¥: ${m} - ${x}`,w)}}else if(y==="activeSpirits"){if(S.length<3)continue;const m=S[0].replace(/"/g,""),x=S[1].replace(/"/g,""),T=parseInt(S[2].replace(/"/g,""))||0;if(["ìˆ˜í˜¸","íƒ‘ìŠ¹","ë³€ì‹ "].includes(m)){const P=allSpirits.find(V=>V.name===x&&V.type===m);P?g[m]={...P,level:T}:(E.warn(`ì‚¬ìš©ì¤‘ í™˜ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${x} (${m})`),g[m]={name:x,level:T})}}else if(y==="userStats"){if(S.length<2)continue;const m=S[0].replace(/"/g,"").trim(),x=parseFloat(S[1].replace(/"/g,"").trim())||0;$(m)&&C(x)?h[m]=x:E.warn(`ìŠ¤íƒ¯ ê²€ì¦ ì‹¤íŒ¨: ${m}=${x}`)}}if(e.bondSpirits=u,e.activeSpirits=g,e.engravingData=b,e.userStats=h,e.baselineStats={},e.baselineKeyStats={tachaeTotal:0,statusEffectResistance:0,statusEffectAccuracy:0},e.savedSoulExp=0,e.baselineStatsHash=null,e.baselineSoulExpHash=null,e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,e.isInitialLoad=!0,n.renderBondSlots&&(n.renderBondSlots("ìˆ˜í˜¸"),n.renderBondSlots("íƒ‘ìŠ¹"),n.renderBondSlots("ë³€ì‹ ")),n.renderActiveSpiritSelect&&(n.renderActiveSpiritSelect("ìˆ˜í˜¸"),n.renderActiveSpiritSelect("íƒ‘ìŠ¹"),n.renderActiveSpiritSelect("ë³€ì‹ ")),n.updateTotalStats){const v=n.updateTotalStats();v&&typeof v.then=="function"?v.then(()=>{const{allTotalStats:p}=Y(Z),S=m=>{const x=e.userStats[m]||0,T=p[m]||0;return Math.round(x+T)},I=Math.round(S("damageResistancePenetration")+S("damageResistance")+Math.round(Math.round(S("pvpDamagePercent"))*10)+Math.round(Math.round(S("pvpDefensePercent"))*10));e.baselineKeyStats.tachaeTotal=I,e.baselineKeyStats.statusEffectResistance=S("statusEffectResistance"),e.baselineKeyStats.statusEffectAccuracy=S("statusEffectAccuracy"),[...H].forEach(m=>{const x=e.userStats[m.key]||0,T=p[m.key]||0;e.baselineStats[m.key]=Math.round(x+T)}),e.isInitialLoad=!1,a(!0)}).catch(p=>{E.error("Error updating stats after import:",p),e.isInitialLoad=!1,a(!0)}):(e.isInitialLoad=!1,a(!0))}else e.isInitialLoad=!1,a(!0);n.updateSoulExp&&(e.lastSoulExpHash=null,e.lastSoulExpCalculation=null,n.updateSoulExp()),E.log("CSV import completed")}catch(l){alert(`CSV ê°€ì ¸ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${l.message}`),i(l)}},r.onerror=()=>{const o=new Error("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨");alert("íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),i(o)},r.readAsText(t,"UTF-8")})}function et(t,n){const a=document.createElement("input");a.type="file",a.accept=t,a.style.display="none",a.addEventListener("change",i=>{const s=i.target.files[0];s&&n(s),document.body.removeChild(a)}),document.body.appendChild(a),a.click()}export{je as A,ke as B,_e as C,Ue as D,Oe as E,me as F,Pe as M,H as S,Je as a,qe as b,ze as c,Ke as d,_ as e,Xe as f,O as g,We as h,Ye as i,et as j,ve as k,re as l,Fe as m,ye as n,Ze as o,e as p,Qe as q,te as r,q as s,De as t,Ge as u,Re as v,Me as w,He as x,Ve as y,Be as z};
