import{b as u}from"./utils-CHsLvtYz.js";import{s as h}from"./index-DMxw-PSo.js";import{i as L,F as P,S as x,P as _,E as B}from"./constants-r0ry0Tln.js";import{a as Y}from"./supportMessage-DQwvUf77.js";let S=null,t={isPressed:!1,intervalId:null,timeoutId:null,hintElement:null,bridgeElement:null,hintHovered:!1,button:null,container:null,spiritData:null,currentLevel:0,highlightStat:null,action:null,mouseDownTime:null};function y(n){if(n==null)return 0;const i=parseFloat(String(n).replace(/,/g,""));return isNaN(i)?0:i}function $(n){const i=n.target.closest(".minus-btn, .plus-btn");if(!i)return;n.preventDefault();const e=i.closest(".level-control");if(!e)return;const a=document.getElementById("spirit-info-modal");if(!a)return;const s=e.querySelector(".level-input");if(!s)return;const l=parseInt(s.value)||0,o=h.currentModalSpirit||null,r=h.currentModalHighlightStat||null,p=i.classList.contains("plus-btn")?"increment":"decrement";t.isPressed=!0,t.button=i,t.container=a,t.spiritData=o,t.currentLevel=l,t.highlightStat=r,t.action=p,t.mouseDownTime=Date.now(),t.timeoutId=setTimeout(()=>{t.isPressed&&R()},300)}function q(n){n.touches[0],$({target:n.target,preventDefault:()=>n.preventDefault(),stopPropagation:()=>n.stopPropagation()})}function F(n){const i=n.changedTouches[0],e={target:document.elementFromPoint(i.clientX,i.clientY),clientX:i.clientX,clientY:i.clientY,type:"touchend"};M(e)}function R(){L(t.spiritData.name)||(U(),t.intervalId=setInterval(()=>{if(!t.isPressed||!t.spiritData)return;let n=t.currentLevel;if(t.action==="increment"?n=Math.min(25,t.currentLevel+1):n=Math.max(0,t.currentLevel-1),n!==t.currentLevel){t.currentLevel=n;const i=t.container.querySelector(".level-input");i&&(i.value=n),w(t.spiritData,n,t.highlightStat)}(n===25||n===0)&&I()},200))}function U(){if(t.hintElement)return;const i=t.button.getBoundingClientRect(),e=document.createElement("div");e.className="long-press-hint",e.style.position="fixed",e.style.zIndex="2150",e.style.pointerEvents="auto",e.style.padding="4px 10px",e.style.borderRadius="4px",e.style.fontSize="12px",e.style.fontWeight="600",e.style.cursor="pointer",e.style.userSelect="none",e.style.height="24px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.minWidth="38px",e.style.border="none",e.style.boxShadow="0 2px 6px rgba(0,0,0,0.15)",e.style.transition="all 0.2s ease";const a=t.action==="increment";a?(e.style.left=i.right+8+"px",e.style.top=i.top+(i.height-24)/2+"px",e.innerHTML='<span class="hint-btn max-hint" data-value="25" style="color: white; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">MAX</span>',e.style.background="linear-gradient(135deg, #4ecdc4, #44a08d)",e.style.border="1px solid rgba(78, 205, 196, 0.3)",e.style.color="white"):(e.style.left=i.left-46+"px",e.style.top=i.top+(i.height-24)/2+"px",e.innerHTML='<span class="hint-btn min-hint" data-value="0" style="color: white; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">MIN</span>',e.style.background="linear-gradient(135deg, #ff6b6b, #ee5a52)",e.style.border="1px solid rgba(255, 107, 107, 0.3)",e.style.color="white"),e.addEventListener("mouseenter",()=>{a?(e.style.background="linear-gradient(135deg, #26d0ce, #2eb398)",e.style.boxShadow="0 3px 6px rgba(68, 160, 141, 0.3)",e.style.transform="translateY(-1px)"):(e.style.background="linear-gradient(135deg, #ff5252, #e53935)",e.style.boxShadow="0 3px 6px rgba(238, 90, 82, 0.3)",e.style.transform="translateY(-1px)")}),e.addEventListener("mouseleave",()=>{a?(e.style.background="linear-gradient(135deg, #4ecdc4, #44a08d)",e.style.boxShadow="0 2px 4px rgba(68, 160, 141, 0.2)",e.style.transform="translateY(0)"):(e.style.background="linear-gradient(135deg, #ff6b6b, #ee5a52)",e.style.boxShadow="0 2px 4px rgba(238, 90, 82, 0.2)",e.style.transform="translateY(0)")}),e.addEventListener("touchstart",o=>{o.preventDefault(),a?(e.style.background="linear-gradient(135deg, #26d0ce, #2eb398)",e.style.boxShadow="0 3px 6px rgba(68, 160, 141, 0.3)",e.style.transform="translateY(-1px)"):(e.style.background="linear-gradient(135deg, #ff5252, #e53935)",e.style.boxShadow="0 3px 6px rgba(238, 90, 82, 0.3)",e.style.transform="translateY(-1px)")},{passive:!1}),e.addEventListener("touchend",o=>{o.preventDefault(),a?(e.style.background="linear-gradient(135deg, #4ecdc4, #44a08d)",e.style.boxShadow="0 2px 4px rgba(68, 160, 141, 0.2)",e.style.transform="translateY(0)"):(e.style.background="linear-gradient(135deg, #ff6b6b, #ee5a52)",e.style.boxShadow="0 2px 4px rgba(238, 90, 82, 0.2)",e.style.transform="translateY(0)")},{passive:!1});const s=document.createElement("div");s.className="hint-bridge",s.style.position="fixed",s.style.zIndex="2149",s.style.pointerEvents="auto",s.style.backgroundColor="transparent",s.style.top=i.top-5+"px",s.style.height=i.height+10+"px",a?(s.style.left=i.right+"px",s.style.width="54px"):(s.style.left=i.left-46+"px",s.style.width="46px");const l=e.querySelector(".hint-btn");l.addEventListener("mouseenter",()=>{t.hintHovered=!0}),l.addEventListener("mouseleave",()=>{t.hintHovered=!1}),l.addEventListener("touchstart",o=>{o.preventDefault(),t.hintHovered=!0},{passive:!1}),l.addEventListener("touchend",o=>{o.preventDefault()},{passive:!1}),s.addEventListener("mouseenter",()=>{t.hintHovered=!0}),s.addEventListener("mouseleave",()=>{t.hintHovered=!1}),s.addEventListener("touchstart",o=>{o.preventDefault(),t.hintHovered=!0},{passive:!1}),s.addEventListener("touchend",o=>{o.preventDefault()},{passive:!1}),document.body.appendChild(e),document.body.appendChild(s),t.hintElement=e,t.bridgeElement=s}function M(n){if(!t.isPressed&&!t.timeoutId)return;const a=Date.now()-t.mouseDownTime<300;if(!t.isPressed&&t.timeoutId){clearTimeout(t.timeoutId),t.timeoutId=null,t.button=null,t.container=null,t.spiritData=null,t.action=null,t.mouseDownTime=null;return}if(n.type==="touchend"&&t.hintElement){const s=t.hintElement.getBoundingClientRect();n.clientX>=s.left&&n.clientX<=s.right&&n.clientY>=s.top&&n.clientY<=s.bottom&&(t.hintHovered=!0)}if(t.hintElement&&t.hintHovered){const s=t.hintElement.querySelector(".hint-btn");if(s){const l=parseInt(s.dataset.value);if(t.spiritData&&!isNaN(l)){const o=t.container.querySelector(".level-input");o&&(o.value=l),w(t.spiritData,l,t.highlightStat)}}I()}else if(a&&!t.hintElement&&t.spiritData){let s=t.currentLevel;if(t.action==="increment"?s=Math.min(25,t.currentLevel+1):s=Math.max(0,t.currentLevel-1),s!==t.currentLevel){const l=t.container.querySelector(".level-input");l&&(l.value=s),w(t.spiritData,s,t.highlightStat)}}I()}function w(n,i,e){L(n.name)&&(i=25);const a=n.stats.find(c=>c.level===i);if(!a)return;const s=a.registrationStat||{},l=a.bindStat||{},o=document.getElementById("registrationList"),r=document.getElementById("registration-sum");o&&r&&H(o,r,s,e);const p=document.getElementById("bindList"),d=document.getElementById("bind-sum");p&&d&&H(p,d,l,e)}function H(n,i,e,a){const s=Object.entries(e),l=n.parentElement;if(s.length===0){l.innerHTML='<p class="no-effects">효과 없음</p>',i.textContent="합산: 0";return}let o=0,r="";s.sort((d,c)=>{const m=x[d[0]]||d[0],v=x[c[0]]||c[0];return m.localeCompare(v)}).forEach(([d,c])=>{const m=y(c);if(m<=0)return;const v=x[d]||d,C=_.includes(d)?`${m}%`:m.toLocaleString();let g="";a&&d===a&&(g+=" stat-highlight"),B.includes(d)&&(g+=" stat-effective",d==="pvpDamagePercent"||d==="pvpDefensePercent"?o+=m*10:o+=m),d==="damageResistance"?g+=" stat-damage-resistance":d==="damageResistancePenetration"?g+=" stat-damage-resistance-penetration":d==="pvpDamagePercent"?g+=" stat-pvp-damage-percent":d==="pvpDefensePercent"&&(g+=" stat-pvp-defense-percent"),r+=`<li class="${g.trim()}"><span class="stat-name">${v}</span><span class="stat-value">${C}</span></li>`}),l.innerHTML=`<ul class="effects-list">${r}</ul>`;const p=l.querySelector(".effects-list");p&&n.id&&(p.id=n.id),i.textContent=`합산: ${o.toLocaleString()}`}function I(){t.timeoutId&&clearTimeout(t.timeoutId),t.intervalId&&clearInterval(t.intervalId),t.hintElement&&t.hintElement.remove(),t.bridgeElement&&t.bridgeElement.remove(),t.isPressed=!1,t.intervalId=null,t.timeoutId=null,t.hintElement=null,t.bridgeElement=null,t.hintHovered=!1,t.button=null,t.container=null,t.spiritData=null,t.currentLevel=0,t.highlightStat=null,t.action=null,t.mouseDownTime=null}function O(){E();const n=u("div","spirit-modal-overlay",{id:"spirit-info-modal"}),i=u("div","spirit-modal-content");n.appendChild(i),document.body.appendChild(n),n.addEventListener("click",a=>{a.target===n&&E()});const e=a=>{a.key==="Escape"&&E()};return document.addEventListener("keydown",e),n._escListener=e,S=n,{modal:n,content:i}}function J(n,i=null,e=!1){if(!n){console.error("모달을 표시할 환수 데이터가 없습니다.");return}const{modal:a,content:s}=O();document.body.style.overflow="hidden";let l=0;(e||L(n.name))&&(l=25),N(s,n,l,i,e),a.style.display="flex"}function N(n,i,e,a,s){n.innerHTML="",L(i.name)&&(e=25),document._spiritInfoMouseUpAdded||(document.addEventListener("mouseup",M),document._spiritInfoMouseUpAdded=!0),document._spiritInfoTouchEndAdded||(document.addEventListener("touchend",F),document._spiritInfoTouchEndAdded=!0);const l=u("button","modal-close-btn",{text:"✕"});l.addEventListener("click",E),n.appendChild(l);const o=u("div","kakao-ad-modal-container desktop-modal-ad");o.innerHTML=`
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-aOM3JPGvOLhHlyoS"
          data-ad-width="728"
          data-ad-height="90"></ins>
  `,n.appendChild(o);const r=u("div","kakao-ad-modal-container mobile-modal-ad");r.innerHTML=`
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-epbkjAaeHSxv0MYl"
          data-ad-width="320"
          data-ad-height="50"></ins>
  `,n.appendChild(r);const p=u("div","spirit-modal-header"),d=u("img","spirit-modal-image",{src:`${i.image}`,alt:i.name});p.appendChild(d);const c=u("div","spirit-modal-title-section"),m=u("h3","",{text:i.name});if(c.appendChild(m),i.influence&&P[i.influence]){const b=u("img","influence-icon",{src:P[i.influence],alt:i.influence,title:i.influence});m.appendChild(b)}const v=s?V():X(n,i,e,a);c.appendChild(v),p.appendChild(c),n.appendChild(p);const f=u("div","stats-container"),C=D("등록 효과","registrationList","registration-sum"),g=D("결속 효과","bindList","bind-sum");f.appendChild(C),f.appendChild(g),n.appendChild(f),Y(n),j(i,e,a),setTimeout(()=>{try{if(window.adfit&&typeof window.adfit.render=="function"){const b=o.querySelector(".kakao_ad_area"),T=r.querySelector(".kakao_ad_area");b&&window.adfit.render(b),T&&window.adfit.render(T)}else console.warn("Kakao AdFit script not yet loaded or available for re-rendering.")}catch(b){console.error("Kakao AdFit: Error re-rendering ad after level change:",b)}},100)}function V(){const n=u("div","level-control"),i=u("div","fixed-level-display");return i.innerHTML="<strong>레벨: 25</strong> (랭킹 기준)",n.appendChild(i),n}function X(n,i,e,a){const s=u("div","level-control");if(L(i.name)){const d=u("div","fixed-level-control"),c=u("span","fixed-level-label",{text:"25 (고정)"});return d.appendChild(c),s.appendChild(d),s}const l=u("div","level-input-container"),o=u("button",["level-btn","minus-btn"],{text:"-"}),r=u("input","level-input",{type:"number",min:"0",max:"25",value:String(e)}),p=u("button",["level-btn","plus-btn"],{text:"+"});return l.append(o,r,p),s.appendChild(l),h.currentModalSpirit=i,h.currentModalHighlightStat=a,l._mousedownHandlerAdded=!0,l.addEventListener("mousedown",$),l.addEventListener("touchstart",q,{passive:!1}),r.addEventListener("change",d=>{let c=parseInt(d.target.value,10);(isNaN(c)||c<0)&&(c=0),c>25&&(c=25),c!==e&&N(n,i,c,a,!1)}),s}function D(n,i,e){const a=u("div","stats-column");return a.innerHTML=`
        <h4>${n} <span id="${e}" class="section-score">합산: 0</span></h4>
        <div class="effects-content">
            <ul id="${i}" class="effects-list"></ul>
        </div>
    `,a}function j(n,i,e){const a=document.getElementById("registrationList"),s=document.getElementById("bindList");if(!a||!s){console.error("Stat lists not found in DOM.");return}const l=n.stats.find(p=>p.level===i),o=l?.registrationStat||{},r=l?.bindStat||{};A(a,o,e),A(s,r,e),document.getElementById("registration-sum").textContent=`합산: ${k(o)}`,document.getElementById("bind-sum").textContent=`합산: ${k(r)}`}function A(n,i,e){const a=Object.entries(i),s=n.parentElement;if(a.length===0){s.innerHTML='<p class="no-effects">효과 없음</p>';return}let l="";a.sort((r,p)=>{const d=x[r[0]]||r[0],c=x[p[0]]||p[0];return d.localeCompare(c)}).forEach(([r,p])=>{const d=y(p);if(d<=0)return;const c=x[r]||r,v=_.includes(r)?`${d}%`:d.toLocaleString();let f="";e&&r===e&&(f+=" stat-highlight"),B.includes(r)&&(f+=" stat-effective"),r==="damageResistance"?f+=" stat-damage-resistance":r==="damageResistancePenetration"?f+=" stat-damage-resistance-penetration":r==="pvpDamagePercent"?f+=" stat-pvp-damage-percent":r==="pvpDefensePercent"&&(f+=" stat-pvp-defense-percent"),l+=`<li class="${f.trim()}"><span class="stat-name">${c}</span><span class="stat-value">${v}</span></li>`}),s.innerHTML=`<ul class="effects-list">${l}</ul>`;const o=s.querySelector(".effects-list");o&&n.id&&(o.id=n.id)}function k(n){if(!n)return 0;const i=y(n.damageResistance),e=y(n.damageResistancePenetration),a=y(n.pvpDamagePercent),s=y(n.pvpDefensePercent);return Math.round(i+e+a*10+s*10)}function E(){I(),document._spiritInfoMouseUpAdded&&(document.removeEventListener("mouseup",M),document._spiritInfoMouseUpAdded=!1),S&&(document.removeEventListener("keydown",S._escListener),S.remove(),S=null),document.body.style.overflow="auto",h.currentModalSpirit&&delete h.currentModalSpirit,h.currentModalHighlightStat&&delete h.currentModalHighlightStat}export{J as s};
