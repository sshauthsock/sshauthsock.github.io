import{b as i}from"./utils-CHsLvtYz.js";import{F as k,S as h,E as x,P as w}from"./constants-lx1P6xCQ.js";let b=null;function L(e){if(e==null)return 0;const n=parseFloat(String(e).replace(/,/g,""));return isNaN(n)?0:n}function A(){C();const e=i("div","spirit-modal-overlay",{id:"spirit-info-modal"}),n=i("div","spirit-modal-content");e.appendChild(n),document.body.appendChild(e),e.addEventListener("click",a=>{a.target===e&&C()});const t=a=>{a.key==="Escape"&&C()};return document.addEventListener("keydown",t),e._escListener=t,b=e,{modal:e,content:n}}function F(e,n=null,t=!1){if(!e){console.error("모달을 표시할 환수 데이터가 없습니다.");return}const{modal:a,content:o}=A();document.body.style.overflow="hidden",I(o,e,t?25:0,n,t),a.style.display="flex"}function I(e,n,t,a,o){e.innerHTML="";const s=i("button","modal-close-btn",{text:"✕"});s.addEventListener("click",C),e.appendChild(s);const d=i("div","kakao-ad-modal-container desktop-modal-ad");d.innerHTML=`
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-aOM3JPGvOLhHlyoS"
          data-ad-width="728"
          data-ad-height="90"></ins>
  `,e.appendChild(d);const l=i("div","kakao-ad-modal-container mobile-modal-ad");l.innerHTML=`
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-epbkjAaeHSxv0MYl"
          data-ad-width="320"
          data-ad-height="50"></ins>
  `,e.appendChild(l);const c=i("div","spirit-modal-header"),u=i("img","spirit-modal-image",{src:`${n.image}`,alt:n.name});c.appendChild(u);const m=i("div","spirit-modal-title-section"),p=i("h3","",{text:n.name});if(m.appendChild(p),n.influence&&k[n.influence]){const f=i("img","influence-icon",{src:k[n.influence],alt:n.influence,title:n.influence});p.appendChild(f)}const v=o?_():B(e,n,t,a);m.appendChild(v),c.appendChild(m),e.appendChild(c);const r=i("div","stats-container"),M=y("등록 효과","registrationList","registration-sum"),T=y("장착 효과","bindList","bind-sum");r.appendChild(M),r.appendChild(T),e.appendChild(r),N(n,t,a),setTimeout(()=>{try{if(window.adfit&&typeof window.adfit.render=="function"){const f=d.querySelector(".kakao_ad_area"),g=l.querySelector(".kakao_ad_area");f&&window.adfit.render(f),g&&window.adfit.render(g)}else console.warn("Kakao AdFit script not yet loaded or available for re-rendering.")}catch(f){console.error("Kakao AdFit: Error re-rendering ad after level change:",f)}},100)}function _(){const e=i("div","level-control"),n=i("div","fixed-level-display");return n.innerHTML="<strong>레벨: 25</strong> (랭킹 기준)",e.appendChild(n),e}function B(e,n,t,a){const o=i("div","level-control"),s=i("div","level-input-container"),d=i("button",["level-btn","min-btn"],{text:"min"}),l=i("button",["level-btn","minus-btn"],{text:"-"}),c=i("input","level-input",{type:"number",min:"0",max:"25",value:String(t)}),u=i("button",["level-btn","plus-btn"],{text:"+"}),m=i("button",["level-btn","max-btn"],{text:"max"});s.append(d,l,c,u,m),o.appendChild(s);const p=v=>{let r=parseInt(v,10);(isNaN(r)||r<0)&&(r=0),r>25&&(r=25),r!==t&&I(e,n,r,a,!1)};return d.addEventListener("click",()=>p(0)),l.addEventListener("click",()=>p(t-1)),u.addEventListener("click",()=>p(t+1)),m.addEventListener("click",()=>p(25)),c.addEventListener("change",v=>p(v.target.value)),o}function y(e,n,t){const a=i("div","stats-column");return a.innerHTML=`
        <div class="stats-header">
            ${e}
            <span id="${t}" class="stats-sum">합산: 0</span>
        </div>
        <ul id="${n}" class="stats-list"></ul>
    `,a}function N(e,n,t){const a=document.getElementById("registrationList"),o=document.getElementById("bindList");if(!a||!o){console.error("Stat lists not found in DOM.");return}const s=e.stats.find(c=>c.level===n),d=s?.registrationStat||{},l=s?.bindStat||{};S(a,d,t),S(o,l,t),document.getElementById("registration-sum").textContent=`합산: ${E(d)}`,document.getElementById("bind-sum").textContent=`합산: ${E(l)}`}function S(e,n,t){e.innerHTML="";const a=Object.entries(n);if(a.length===0){e.innerHTML="<li>효과 없음</li>";return}a.sort((o,s)=>{const d=h[o[0]]||o[0],l=h[s[0]]||s[0];return d.localeCompare(l)}).forEach(([o,s])=>{const d=h[o]||o,c=w.includes(o)?`${L(s)}%`:L(s),u=i("li");t&&o===t&&u.classList.add("stat-highlight"),x.includes(o)&&u.classList.add("stat-effective"),u.innerHTML=`
        <span class="stat-key">${d}</span>
        <span class="stat-value">${c}</span>
      `,e.appendChild(u)})}function E(e){if(!e)return 0;const n=L(e.damageResistance),t=L(e.damageResistancePenetration);return Math.round(n+t)}function C(){b&&(document.removeEventListener("keydown",b._escListener),b.remove(),b=null),document.body.style.overflow="auto"}export{F as s};
