import{e as n,s as F,l as A,r as E,a as P,p as e,g as W,d as K,S as G,c as N,b as U,f as $,h as w,u as T}from"./myInfo-common-D2CUTr8V.js";import{c as z,g as O,u as g}from"./myInfo-statCalculator-DRlyhEgC.js";import{r as v,u as m}from"./myInfo-statUI-CBQfCxnP.js";import{g as r}from"./myInfo-spiritManager-_dwAcAUk.js";import{L as _}from"./utils-C4S-LQYV.js";let j=null,J=null;function ae(x){const{renderBondSlotsWrapper:p,renderActiveSpiritSelect:S,renderSpiritListWrapper:B,handleStatEditWrapper:f}=x;n.profileSelect&&n.profileSelect.addEventListener("change",t=>{const a=t.target.value||null;F(a),a?A(a,{renderBondSlots:p,renderActiveSpiritSelect:S,renderStats:()=>v(f),updateTotalStats:()=>g(r,m),updateSoulExp:()=>T(r)}):E()}),n.createProfileBtn&&n.createProfileBtn.addEventListener("click",()=>{P("create",null,{renderBondSlots:p,renderActiveSpiritSelect:S,renderStats:()=>v(f),updateTotalStats:()=>g(r,m),updateSoulExp:()=>T(r)})}),n.editProfileBtn&&n.editProfileBtn.addEventListener("click",()=>{e.currentProfileId&&P("edit",e.currentProfileId,{renderBondSlots:p,renderActiveSpiritSelect:S,renderStats:()=>v(f),updateTotalStats:()=>g(r,m),updateSoulExp:()=>{const{updateSoulExp:t}=require("./expCalculator.js");t(r)}})}),n.deleteProfileBtn&&n.deleteProfileBtn.addEventListener("click",()=>{if(e.currentProfileId){const t=W().find(a=>a.id===e.currentProfileId);t&&confirm(`"${t.name}" 프로파일을 삭제하시겠습니까?`)&&(K(e.currentProfileId,{renderBondSlots:p,renderActiveSpiritSelect:S,renderStats:()=>v(f),updateTotalStats:()=>g(r,m),updateSoulExp:()=>{const{updateSoulExp:a}=require("./expCalculator.js");a(r)}}),E(),alert("프로파일이 삭제되었습니다."))}}),n.spiritTabs.forEach(t=>{t.addEventListener("click",a=>{const o=a.target.dataset.category;o&&o!==e.currentCategory&&(n.spiritTabs.forEach(y=>y.classList.remove("active")),a.target.classList.add("active"),e.currentCategory=o,B())})});const d=n.container?.querySelector("#saveBaselineBtn");d&&d.addEventListener("click",async()=>{e.isSavingBaseline=!0;try{const t=[...G],{allTotalStats:a}=z(r);t.forEach(s=>{const l=e.userStats[s.key]||0,c=a[s.key]||0,i=Math.round(l+c),u=e.baselineStats[s.key];e.baselineStats[s.key]=i});const o=s=>{const l=e.userStats[s]||0,c=a[s]||0;return Math.round(l+c)},y=e.baselineStats.damageResistancePenetration!==void 0?e.baselineStats.damageResistancePenetration:o("damageResistancePenetration"),L=e.baselineStats.damageResistance!==void 0?e.baselineStats.damageResistance:o("damageResistance"),D=e.baselineStats.pvpDamagePercent!==void 0?e.baselineStats.pvpDamagePercent:o("pvpDamagePercent"),M=e.baselineStats.pvpDefensePercent!==void 0?e.baselineStats.pvpDefensePercent:o("pvpDefensePercent"),k=Math.round(Math.round(y)+Math.round(L)+Math.round(Math.round(D)*10)+Math.round(Math.round(M)*10));e.baselineKeyStats.tachaeTotal=k,e.baselineKeyStats.statusEffectResistance=o("statusEffectResistance"),e.baselineKeyStats.statusEffectAccuracy=o("statusEffectAccuracy");const h=e.expTable;if(h){let s=0;const l=["수호","탑승","변신"];for(const c of l){const i=e.bondSpirits[c]||[];for(const u of i){if(!u.level||u.level===0)continue;const b=r(c).find(q=>q.name===u.name);if(!b)continue;const V=b.grade==="불멸"?"immortal":"legend",C=N(h,V,0,u.level);s+=C}}e.savedSoulExp=s}U();const I=O(r);e.baselineStatsHash=I;const H=$();e.baselineSoulExpHash=H,w(),t.forEach(s=>{const l=n.container?.querySelector(`[data-stat="${s.key}"]`);if(l){const c=l.querySelector(".my-info-stat-total"),i=l.querySelector(".my-info-stat-change");c&&i&&(i.textContent="(0)",i.className="my-info-stat-change neutral",i.style.display="inline",i.style.visibility="visible")}}),e.recentlyEditedStats&&e.recentlyEditedStats.clear(),e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.isSavingBaseline=!1;const R=d.innerHTML;d.innerHTML='<span style="font-size: 14px; margin-right: 4px;">✓</span><span>저장됨</span>',d.style.background="var(--color-secondary, #4CAF50)",setTimeout(()=>{d.innerHTML=R,d.style.background="var(--color-primary)"},1500)}catch(t){_.error("Error saving baseline:",t),e.isSavingBaseline=!1}})}export{ae as s};
