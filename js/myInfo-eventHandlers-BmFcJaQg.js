import{e as s,s as J,l as W,r as D,a as q,p as e,g as A,d as j,c as K,b as G,f as C,h as U,i as $,j as z,S as _,k as Q,m as X,n as Y,u as g,o as Z,q as ee}from"./myInfo-common-CMzVp-_M.js";import{c as te,g as ae,u as y}from"./myInfo-statCalculator-DF1l3CnK.js";import{r as E,u as b}from"./myInfo-statUI-DLCXhh0-.js";import{g as t}from"./myInfo-spiritManager-DpGBb1wU.js";let se=null,ne=null;function de(w){const{renderBondSlotsWrapper:S,renderActiveSpiritSelect:f,renderSpiritListWrapper:I,handleStatEditWrapper:v}=w;s.profileSelect&&s.profileSelect.addEventListener("change",r=>{const n=r.target.value||null;J(n),n?W(n,{renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)}):D()}),s.createProfileBtn&&s.createProfileBtn.addEventListener("click",()=>{q("create",null,{renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)})}),s.editProfileBtn&&s.editProfileBtn.addEventListener("click",()=>{e.currentProfileId&&q("edit",e.currentProfileId,{renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)})}),s.deleteProfileBtn&&s.deleteProfileBtn.addEventListener("click",()=>{if(e.currentProfileId){const r=A().find(n=>n.id===e.currentProfileId);r&&confirm(`"${r.name}" 프로파일을 삭제하시겠습니까?`)&&(j(e.currentProfileId,{renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)}),D(),alert("프로파일이 삭제되었습니다."))}}),s.spiritTabs.forEach(r=>{r.addEventListener("click",n=>{const o=n.target.dataset.category;o&&o!==e.currentCategory&&(s.spiritTabs.forEach(P=>P.classList.remove("active")),n.target.classList.add("active"),e.currentCategory=o,I())})});const k=s.container?.querySelector("#dataMenuBtn"),h=s.container?.querySelector("#dataMenuDropdown"),l=s.container?.querySelector(".my-info-data-menu");if(k&&h&&l){k.addEventListener("click",a=>{a.stopPropagation(),l.classList.toggle("active")}),document.addEventListener("click",a=>{l.contains(a.target)||l.classList.remove("active")});const r=h.querySelector("#copyClipboardBtn");r&&r.addEventListener("click",async a=>{a.stopPropagation(),l.classList.remove("active"),await K()&&alert("클립보드에 복사되었습니다.")});const n=h.querySelector("#pasteClipboardBtn");n&&n.addEventListener("click",async a=>{a.stopPropagation(),l.classList.remove("active"),confirm("클립보드의 데이터를 가져오시겠습니까? 현재 데이터는 덮어씌워집니다.")&&await G({renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)})&&(C(),alert("클립보드에서 데이터를 성공적으로 가져왔습니다."))});const o=h.querySelector("#exportJSONBtn");o&&o.addEventListener("click",a=>{a.stopPropagation(),l.classList.remove("active"),U()});const P=h.querySelector("#exportCSVBtn");P&&P.addEventListener("click",a=>{a.stopPropagation(),l.classList.remove("active"),$()});const L=h.querySelector("#importBtn");L&&L.addEventListener("click",a=>{a.stopPropagation(),l.classList.remove("active"),z(".json,.csv",async p=>{const x=p.name.toLowerCase().endsWith(".json"),B=p.name.toLowerCase().endsWith(".csv");if(!x&&!B){alert("JSON 또는 CSV 파일만 가져올 수 있습니다.");return}if(confirm("현재 데이터가 가져온 데이터로 대체됩니다. 계속하시겠습니까?"))try{x?(await Z(p,{renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)}),C(),alert("JSON 파일이 성공적으로 가져와졌습니다.")):B&&(await ee(p,{renderBondSlots:S,renderActiveSpiritSelect:f,renderStats:()=>E(v),updateTotalStats:()=>y(t,b),updateSoulExp:()=>g(t)}),C(),alert("CSV 파일이 성공적으로 가져와졌습니다."))}catch{alert("파일 가져오기 중 오류가 발생했습니다.")}})})}const m=s.container?.querySelector("#saveBaselineBtn");m&&m.addEventListener("click",async()=>{e.isSavingBaseline=!0;try{const r=[..._],{allTotalStats:n}=te(t);r.forEach(i=>{const c=e.userStats[i.key]||0,u=n[i.key]||0,d=Math.round(c+u),T=e.baselineStats[i.key];e.baselineStats[i.key]=d});const o=i=>{const c=e.userStats[i]||0,u=n[i]||0;return Math.round(c+u)},P=e.baselineStats.damageResistancePenetration!==void 0?e.baselineStats.damageResistancePenetration:o("damageResistancePenetration"),L=e.baselineStats.damageResistance!==void 0?e.baselineStats.damageResistance:o("damageResistance"),a=e.baselineStats.pvpDamagePercent!==void 0?e.baselineStats.pvpDamagePercent:o("pvpDamagePercent"),p=e.baselineStats.pvpDefensePercent!==void 0?e.baselineStats.pvpDefensePercent:o("pvpDefensePercent"),x=Math.round(Math.round(P)+Math.round(L)+Math.round(Math.round(a)*10)+Math.round(Math.round(p)*10));e.baselineKeyStats.tachaeTotal=x,e.baselineKeyStats.statusEffectResistance=o("statusEffectResistance"),e.baselineKeyStats.statusEffectAccuracy=o("statusEffectAccuracy");const B=e.expTable;if(B){let i=0;const c=["수호","탑승","변신"];for(const u of c){const d=e.bondSpirits[u]||[];for(const T of d){if(!T.level||T.level===0)continue;const V=t(u).find(O=>O.name===T.name);if(!V)continue;const R=V.grade==="불멸"?"immortal":"legend",N=Q(B,R,0,T.level);i+=N}}e.savedSoulExp=i}X();const M=ae(t);e.baselineStatsHash=M;const F=Y();e.baselineSoulExpHash=F,C(),r.forEach(i=>{const c=s.container?.querySelector(`[data-stat="${i.key}"]`);if(c){const u=c.querySelector(".my-info-stat-total"),d=c.querySelector(".my-info-stat-change");u&&d&&(d.textContent="(0)",d.className="my-info-stat-change neutral",d.style.display="inline",d.style.visibility="visible")}}),e.recentlyEditedStats&&e.recentlyEditedStats.clear(),e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,e.isSavingBaseline=!1;const H=m.innerHTML;m.innerHTML='<span style="font-size: 14px; margin-right: 4px;">✓</span><span>저장됨</span>',m.style.background="var(--color-secondary, #4CAF50)",setTimeout(()=>{m.innerHTML=H,m.style.background="var(--color-primary)"},1500)}catch{e.isSavingBaseline=!1}})}export{de as s};
