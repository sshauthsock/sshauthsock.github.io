import{s as M}from"./main-CtgLAOgc.js";import{c as q,r as te,i as _}from"./components-Snd72_gc.js";import{L as ne}from"./utils-Qx1knf6J.js";import{e as V,p as t,t as Z}from"./myInfo-common-CMzVp-_M.js";import{c as O,g as ie}from"./myInfo-engravingManager-NojOnFJj.js";let w=null,L=null;function ve(){if(w){const n=w.querySelector(".my-info-spirit-popup-close");n?n.click():(w.remove(),w=null)}L&&(L.remove(),L=null)}let e={isPressed:!1,intervalId:null,timeoutId:null,hintElement:null,bridgeElement:null,hintHovered:!1,button:null,spirit:null,category:null,index:null,action:null,mouseDownTime:null,touchStartTime:null,touchMoveHandler:null,ignoreMouseUp:!1};function F(n){return(Array.isArray(M.allSpirits)?M.allSpirits:[]).filter(x=>x.type===n)}function fe(n,S,x){const o=V[`bondSlots${n}`];if(!o)return;o.innerHTML="";const i=t.bondSpirits[n]||[];for(let r=0;r<6;r++){const s=q("div","my-info-bond-slot");if(s.dataset.slotIndex=r,s.dataset.category=n,i[r]){const a=i[r];s.classList.add("filled");const v=t.activeSpirits[n];v&&v.name===a.name&&s.classList.add("used-spirit");const y=q("img");if(!a.image){const g=(Array.isArray(M.allSpirits)?M.allSpirits:[]).find(f=>f.name===a.name&&f.type===n);g&&g.image?a.image=g.image:(ne.warn(`이미지 경로를 찾을 수 없습니다: ${a.name}`),a.image=`assets/img/${n}/${a.name}.webp`)}y.src=a.image,y.alt=a.name,y.onerror=()=>{if(y.src.endsWith(".webp")){const E=a.image.replace(/\.webp$/i,".jpg");y.src=E;return}if(!a.image||!a.image.includes("/")){const g=(Array.isArray(M.allSpirits)?M.allSpirits:[]).find(f=>f.name===a.name&&f.type===n);if(g&&g.image){a.image=g.image,y.src=g.image;return}}t.imageLoadErrors.add(a.image||"unknown"),Z()},s.appendChild(y);const l=q("div");l.className="level-badge",l.style.position="absolute",l.style.bottom="1px",l.style.right="1px",l.style.background="rgba(0,0,0,0.7)",l.style.color="white",l.style.padding="1px 3px",l.style.borderRadius="2px",l.style.fontSize="9px",l.style.fontWeight="600",l.textContent=`Lv.${a.level||25}`,l.style.pointerEvents="none",s.appendChild(l);const h=t.engravingData[n]?.[a.name];if(h){const E=Array.isArray(h.registration)&&h.registration.length>0,g=h.bind&&Object.keys(h.bind).length>0;if(E||g){const f=q("div");f.className="engraving-badge",f.style.position="absolute",f.style.top="1px",f.style.right="1px",f.style.background="var(--color-primary)",f.style.color="white",f.style.padding="2px 4px",f.style.borderRadius="2px",f.style.fontSize="8px",f.style.fontWeight="700",f.textContent="각인",f.style.pointerEvents="none",f.style.zIndex="10",s.appendChild(f)}}}else s.textContent="+",s.style.fontSize="16px",s.style.color="var(--text-light)";s.addEventListener("click",a=>{a.target.classList.contains("remove-btn")||a.target.closest(".remove-btn")||(i[r]?x&&x(n,r,s,a):S&&S(n))}),o.appendChild(s)}}function me(n){}function ge(n){const S=F(t.currentCategory);if(S.length===0){V.spiritGrid.innerHTML="<p class='text-center text-sm text-light mt-lg'>환수 데이터를 불러오는 중...</p>";return}const x=t.currentCategory,o=t.bondSpirits[x]||[],i=new Set(o.map(a=>a.name)),r=t.activeSpirits[x],s=r?r.name:null;te({container:V.spiritGrid,spirits:S,onSpiritClick:n,getSpiritState:a=>{const v=i.has(a.name),y=v&&s===a.name;return{selected:v,registrationCompleted:y,bondCompleted:!1,level25BindAvailable:!1}},groupByInfluence:!1})}function Se(n){t.currentCategory=n,V.spiritTabs.forEach(S=>{S.classList.toggle("active",S.dataset.category===n)})}function ye(n,S,x,o,i,r=null,s=null,a=null){if(!n)return;const v=t.currentCategory,y=t.bondSpirits[v]||[],l=y.findIndex(h=>h.name===n.name);if(l!==-1){const h=y[l];y.splice(l,1),t.bondSpirits[v]=y,t.removedSpiritLevels[v]||(t.removedSpiritLevels[v]={}),t.removedSpiritLevels[v][h.name]=h.level||25,t.isInitialLoad=!1,S&&S(v),x&&x(),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,r&&s&&a?r(a,s):o&&o(),i&&i()}else if(y.length<6){const h=_(n.name);let E=25;if(!h){const A=t.removedSpiritLevels[v]?.[n.name];A!==void 0&&(E=A)}const g={...n,level:E};y.push(g),t.removedSpiritLevels[v]?.[n.name]!==void 0&&delete t.removedSpiritLevels[v][n.name],t.bondSpirits[v]=y,t.isInitialLoad=!1;const f=y.length-1;S&&S(v);const U=V[`bondSlots${v}`];if(U){const A=U.children[f];A&&(A.classList.add("highlight"),setTimeout(()=>{A.classList.remove("highlight")},1e3))}x&&x(),t.lastTotalStatsHash=null,t.lastSoulExpHash=null,o&&o(),i&&i()}else{alert("결속 슬롯은 최대 6개까지 선택할 수 있습니다.");return}}function he(n,S,x,o,i,r,s,a=null,v=null,y=null){const l=t.bondSpirits[n]||[],h=l[S],E=t.activeSpirits[n];E&&E.name===h.name&&(t.activeSpirits[n]=null),l.splice(S,1),t.bondSpirits[n]=l,t.removedSpiritLevels[n]||(t.removedSpiritLevels[n]={}),t.removedSpiritLevels[n][h.name]=h.level||25,x&&x(n),i&&i(),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,a&&v&&y?a(y,v):r&&r(),s&&s()}function W(n,S,x){const o=t.activeSpirits[S],i=o&&o.name===x.name,r=n.querySelector("[data-action='set-active']");r&&(i?(r.textContent="사용중",r.classList.add("active")):(r.textContent="사용하기",r.classList.remove("active")))}function oe(n){if(!e.button||!e.spirit||_(e.spirit.name))return;e.isPressed=!0,e.ignoreMouseUp=!0,setTimeout(()=>{e.ignoreMouseUp=!1},100),ae(n);const S=()=>{if(!e.isPressed||e.category===null||e.index===null)return!1;const o=(t.bondSpirits[e.category]||[])[e.index];if(!o)return!1;const i=o.level!==void 0&&o.level!==null?o.level:25;let r=!1;if(e.action==="level-down"&&i>0?(o.level=Math.max(0,i-1),r=!0):e.action==="level-up"&&i<25&&(o.level=Math.min(25,i+1),r=!0),r){const s=t.activeSpirits[e.category];s&&s.name===o.name&&(t.activeSpirits[e.category]={...s,level:o.level});const a=w?.querySelector(".level-input");return a&&(a.value=o.level),n?.renderBondSlots&&n.renderBondSlots(e.category),n?.updatePopupActiveState&&n.updatePopupActiveState(w,e.category,o),t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,n?.updateTotalStats&&n?.updateStatItemsWithValues&&n?.getSpiritsForCategory?n.updateTotalStats(n.getSpiritsForCategory,n.updateStatItemsWithValues):n?.debouncedUpdateTotalStats&&n.debouncedUpdateTotalStats(),n?.debouncedUpdateSoulExp&&n.debouncedUpdateSoulExp(),!0}return!1};S(),e.intervalId=setInterval(()=>{S()||z()},200)}function z(){e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null),e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null),se(),e.touchMoveHandler&&(document.removeEventListener("touchmove",e.touchMoveHandler),e.touchMoveHandler=null),e.isPressed=!1,e.hintHovered=!1,e.bridgeElement=null,e.button=null,e.spirit=null,e.category=null,e.index=null,e.action=null,e.mouseDownTime=null,e.touchStartTime=null,e.ignoreMouseUp=!1}function ae(n){if(!e.button)return;const x=(e.action==="level-down"?0:25).toString(),o=q("div","level-hint");o.textContent=x;const i=e.button.getBoundingClientRect();o.style.position="fixed",o.style.top=i.top+"px",o.style.zIndex="1001",o.style.color="white",o.style.padding="0px 4px",o.style.margin="0",o.style.border="none",o.style.borderRadius="3px",o.style.fontSize="10px",o.style.fontWeight="bold",o.style.pointerEvents="none",o.style.cursor="pointer",o.style.whiteSpace="nowrap",o.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)",o.style.textAlign="center",o.style.height=i.height+"px",o.style.lineHeight=i.height+"px",o.style.width="32px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.transition="all 0.2s ease",e.action==="level-down"?(o.style.left=i.left-36+"px",o.style.backgroundColor="#f44336"):(o.style.left=i.right+4+"px",o.style.backgroundColor="#4CAF50"),document.body.appendChild(o),e.hintElement=o,e.hintHovered=!1;const r=q("div","hint-bridge");r.style.position="fixed",r.style.top=i.top+"px",r.style.height=i.height+"px",r.style.zIndex="1000",r.style.backgroundColor="transparent",r.style.pointerEvents="none",e.action==="level-down"?(r.style.left=i.left-36+"px",r.style.width=36+i.width+4+"px"):(r.style.left=i.left+"px",r.style.width=i.width+4+32+"px"),document.body.appendChild(r),e.bridgeElement=r;const s=()=>{e.isPressed&&(e.hintHovered=!0,o.style.transform="scale(1.2)",o.style.fontSize="12px",o.style.fontWeight="900",o.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)")},a=()=>{e.isPressed&&(e.hintHovered=!1,o.style.transform="scale(1)",o.style.fontSize="10px",o.style.fontWeight="bold",o.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)")},v=()=>{if(e.isPressed){if(e.hintHovered){const l=e.action==="level-down"?0:25;if(e.spirit){t.isInitialLoad=!1,e.spirit.level=l;const h=t.activeSpirits[e.category];h&&h.name===e.spirit.name&&(t.activeSpirits[e.category]={...h,level:l});const E=w?.querySelector(".level-input");E&&(E.value=l),n?.renderBondSlots&&n.renderBondSlots(e.category),n?.updatePopupActiveState&&n.updatePopupActiveState(w,e.category,e.spirit),t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,n?.updateTotalStats&&n?.updateStatItemsWithValues&&n?.getSpiritsForCategory?n.updateTotalStats(n.getSpiritsForCategory,n.updateStatItemsWithValues):n?.debouncedUpdateTotalStats&&n.debouncedUpdateTotalStats(),n?.debouncedUpdateSoulExp&&n.debouncedUpdateSoulExp()}}z()}};o.addEventListener("mouseenter",s),o.addEventListener("mouseup",v),o.addEventListener("mouseleave",l=>{!r.contains(l.relatedTarget)&&l.relatedTarget!==r&&a()}),o.addEventListener("touchstart",l=>{l.preventDefault(),l.stopPropagation(),s()},{passive:!1}),o.addEventListener("touchend",l=>{l.preventDefault(),l.stopPropagation(),v()},{passive:!1}),r.addEventListener("mouseleave",l=>{!o.contains(l.relatedTarget)&&l.relatedTarget!==o&&a()}),r.addEventListener("touchstart",l=>{l.preventDefault(),l.stopPropagation(),s()},{passive:!1}),r.addEventListener("touchend",l=>{l.preventDefault(),l.stopPropagation()},{passive:!1});const y=l=>{if(!e.isPressed)return;const h=l.touches[0],E=document.elementFromPoint(h.clientX,h.clientY),g=e.hintElement,f=e.bridgeElement;if(!g)return;E===g||g.contains(E)||E===f?e.hintHovered||(g.style.pointerEvents="auto",f.style.pointerEvents="auto",e.hintHovered=!0,g.style.transform="scale(1.2)",g.style.fontSize="12px",g.style.fontWeight="900",g.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)"):e.hintHovered&&(g.style.pointerEvents="none",f.style.pointerEvents="none",e.hintHovered=!1,g.style.transform="scale(1)",g.style.fontSize="10px",g.style.fontWeight="bold",g.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)")};e.touchMoveHandler=y,document.addEventListener("touchmove",y,{passive:!1}),setTimeout(()=>{o&&e.isPressed&&(o.style.pointerEvents="auto"),r&&e.isPressed&&(r.style.pointerEvents="auto")},0)}function se(){e.hintElement&&(e.hintElement.remove(),e.hintElement=null),e.bridgeElement&&(e.bridgeElement.remove(),e.bridgeElement=null)}function xe(n,S,x,o,i){const s=(t.bondSpirits[n]||[])[S];if(!s)return;w&&(w.remove(),w=null),L&&(L.remove(),L=null);const a=q("div","my-info-spirit-popup"),v=q("div","my-info-spirit-popup-overlay");v.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 999;
  `,v.addEventListener("click",u=>{u.target===v&&(a.remove(),v.remove(),w=null,L=null)}),document.body.appendChild(v),L=v;const y=t.activeSpirits[n],l=y&&y.name===s.name,h=_(s.name),E=t.engravingData[n]?.[s.name]||{},g=Array.isArray(E.registration)?E.registration.length:0;a.innerHTML=`
    <button class="my-info-spirit-popup-close">×</button>
    <div class="kakao-ad-popup-container desktop-popup-ad">
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-aOM3JPGvOLhHlyoS"
          data-ad-width="728"
          data-ad-height="90"></ins>
    </div>
    <div class="kakao-ad-popup-container mobile-popup-ad">
      <ins class="kakao_ad_area"
          data-ad-unit="DAN-epbkjAaeHSxv0MYl"
          data-ad-width="320"
          data-ad-height="50"></ins>
    </div>
    <div class="my-info-spirit-popup-content">
      <div class="my-info-spirit-popup-header">
        <div style="display: flex; align-items: center; gap: var(--space-sm);">
          <img src="${s.image}" alt="${s.name}" loading="lazy">
          <div class="my-info-spirit-popup-name">${s.name}</div>
        </div>
        <div style="display: flex; align-items: center; justify-content: center; flex: 1;">
          <div class="spirit-level-control">
            ${h?`<div class="fixed-level-control">
                    <span class="fixed-level-label">레벨 25 (고정)</span>
                  </div>`:`<div style="display: flex; align-items: center; gap: 4px;">
                    <button class="level-btn minus-btn" data-action="level-down">-</button>
                    <input type="number" class="level-input" min="0" max="25" value="${s.level||25}">
                    <button class="level-btn plus-btn" data-action="level-up">+</button>
                  </div>`}
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-xs);">
          <div class="my-info-spirit-popup-actions">
            <button class="my-info-spirit-popup-action-btn ${l?"active":""}" data-action="set-active">
              ${l?"사용중":"사용하기"}
            </button>
            <button class="my-info-spirit-popup-action-btn remove" data-action="remove">결속 제거</button>
          </div>
        </div>
      </div>
      <div class="my-info-engraving-tabs">
        <button class="my-info-engraving-tab active" data-tab="registration">등록효과</button>
        <button class="my-info-engraving-tab" data-tab="bind">장착효과</button>
      </div>
      <div class="my-info-engraving-tab-content active" id="registrationTab">
        <div id="registrationItemsContainer"></div>
        <div style="display: flex; gap: var(--space-sm); margin-top: var(--space-sm);">
          <button class="my-info-engraving-add-btn" id="addEngravingBtn" ${g>=4?"disabled":""}>
            + 등록효과 추가 (${g}/4)
          </button>
          <button class="my-info-engraving-save-btn" id="saveEngravingBtn">각인 저장</button>
        </div>
      </div>
      <div class="my-info-engraving-tab-content" id="bindTab">
        <div id="bindItemsContainer"></div>
        <div style="display: flex; gap: var(--space-sm); margin-top: var(--space-sm); justify-content: flex-end;">
          <button class="my-info-engraving-save-btn" id="saveEngravingBtnBind" style="flex: 0 1 50%; max-width: 50%;">각인 저장</button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(a),w=a;const f=a.querySelector("img");f&&(f.onerror=()=>{t.imageLoadErrors.add(f.src),Z()}),setTimeout(()=>{try{const u=a.querySelector(".desktop-popup-ad .kakao_ad_area"),d=a.querySelector(".mobile-popup-ad .kakao_ad_area");window.adfit&&typeof window.adfit.render=="function"&&(u&&window.adfit.render(u),d&&window.adfit.render(d))}catch{}},100);const U=a.querySelector(".my-info-spirit-popup-close"),A={renderBondSlots:i?.renderBondSlots,updatePopupActiveState:W,debouncedUpdateTotalStats:i?.debouncedUpdateTotalStats,debouncedUpdateSoulExp:i?.debouncedUpdateSoulExp};if(!h){const u=a.querySelector(".level-input"),d=a.querySelector(".minus-btn"),m=a.querySelector(".plus-btn");u.focus(),u.select();const b=(c,p)=>{const I=T=>{T.preventDefault(),T.stopPropagation(),e.timeoutId&&clearTimeout(e.timeoutId),e.intervalId&&clearInterval(e.intervalId),e.isPressed=!1,e.button=c,e.spirit=s,e.category=n,e.index=S,e.action=p,e.hintHovered=!1,e.mouseDownTime=Date.now(),e.timeoutId=setTimeout(()=>{e.button===c&&oe(A)},300)},C=T=>{T.preventDefault(),T.stopPropagation(),e.touchStartTime=Date.now(),I(T)};c.addEventListener("mousedown",I),c.addEventListener("touchstart",C,{passive:!1})};b(d,"level-down"),b(m,"level-up"),u.addEventListener("change",()=>{let c=parseInt(u.value,10)||25;c<0&&(c=0),c>25&&(c=25),u.value=c,s.level=c;const p=t.activeSpirits[n];p&&p.name===s.name&&(t.activeSpirits[n]={...p,level:c}),i?.renderBondSlots&&i.renderBondSlots(n),W(a,n,s),t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,i?.updateTotalStats&&i?.updateStatItemsWithValues&&i?.getSpiritsForCategory?i.updateTotalStats(i.getSpiritsForCategory,i.updateStatItemsWithValues):i?.debouncedUpdateTotalStats&&i.debouncedUpdateTotalStats(),i?.debouncedUpdateSoulExp&&i.debouncedUpdateSoulExp()})}const R=u=>{if(!e.ignoreMouseUp){if(e.timeoutId&&!e.isPressed){clearTimeout(e.timeoutId),e.timeoutId=null;const d=e.mouseDownTime?Date.now()-e.mouseDownTime:0;if(d>0&&d<300&&e.category!==null&&e.index!==null){const c=(t.bondSpirits[e.category]||[])[e.index];if(c){let p=c.level!==void 0&&c.level!==null?c.level:25,I=!1;if(e.action==="level-down"&&p>0?(p=Math.max(0,p-1),I=!0):e.action==="level-up"&&p<25&&(p=Math.min(25,p+1),I=!0),I){c.level,c.level=p;const C=t.activeSpirits[e.category];C&&C.name===c.name&&(t.activeSpirits[e.category]={...C,level:p});const T=a.querySelector(".level-input");T&&(T.value=p),t.isInitialLoad=!1,i?.renderBondSlots&&i.renderBondSlots(e.category),W(a,e.category,c),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,i?.debouncedUpdateTotalStats&&i.debouncedUpdateTotalStats(),i?.debouncedUpdateSoulExp&&i.debouncedUpdateSoulExp()}}}e.button=null,e.spirit=null,e.category=null,e.index=null,e.action=null,e.mouseDownTime=null;return}if(e.isPressed){if(u.type==="touchend"&&e.hintElement){const d=u.changedTouches?.[0]||u,m=e.hintElement.getBoundingClientRect();d.clientX>=m.left&&d.clientX<=m.right&&d.clientY>=m.top&&d.clientY<=m.bottom&&(e.hintHovered=!0)}if(e.hintHovered&&e.category!==null&&e.index!==null){const d=e.action==="level-down"?0:25,b=(t.bondSpirits[e.category]||[])[e.index];if(b){b.level=d;const c=t.activeSpirits[e.category];c&&c.name===b.name&&(t.activeSpirits[e.category]={...c,level:d});const p=a.querySelector(".level-input");p&&(p.value=d),i?.renderBondSlots&&i.renderBondSlots(e.category),W(a,e.category,b),t.lastTotalStatsHash=null,t.lastSoulExpHash=null,i?.debouncedUpdateTotalStats&&i.debouncedUpdateTotalStats(),i?.debouncedUpdateSoulExp&&i.debouncedUpdateSoulExp()}}z(),u.preventDefault(),u.stopPropagation();return}(e.button||e.timeoutId)&&(e.button=null,e.spirit=null,e.category=null,e.index=null,e.action=null,e.mouseDownTime=null,e.touchStartTime=null,e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null))}},j=u=>{const d=u.changedTouches[0],m={...u,type:"touchend",clientX:d.clientX,clientY:d.clientY,changedTouches:[d]};R(m)};document.addEventListener("mouseup",R),document.addEventListener("touchend",j,{passive:!1});const G=()=>{z(),document.removeEventListener("mouseup",R),document.removeEventListener("touchend",j),a.remove(),L&&(L.remove(),L=null),w=null};U.addEventListener("click",G);const P=a.querySelector("[data-action='set-active']");P.addEventListener("click",()=>{t.activeSpirits[n];const u=t.activeSpirits[n];if(u&&u.name===s.name)t.activeSpirits[n]=null,P.textContent="사용하기",P.classList.remove("active");else{const d=h?25:parseInt(a.querySelector(".level-input")?.value,10)||s.level||25,m={name:s.name,level:d,...s};m.level=d,t.activeSpirits[n]=m,s.level=d,P.textContent="사용중",P.classList.add("active"),P.textContent="사용중",P.classList.add("active")}t.isInitialLoad=!1,i?.renderBondSlots&&i.renderBondSlots(n),W(a,n,s),t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,t.lastSoulExpHash=null,t.lastSoulExpCalculation=null,i?.updateTotalStats&&i.updateTotalStats(F,i.updateStatItemsWithValues),i?.updateSoulExp&&i.updateSoulExp(F)}),a.querySelector("[data-action='remove']").addEventListener("click",()=>{z(),i?.removeBondSpirit&&i.removeBondSpirit(n,S),G()});const B=a.querySelector("#registrationItemsContainer"),$=a.querySelector("#bindItemsContainer"),H=a.querySelector("#addEngravingBtn"),Y=a.querySelector("#saveEngravingBtn"),X=a.querySelector("#saveEngravingBtnBind"),K=a.querySelectorAll(".my-info-engraving-tab"),J=a.querySelectorAll(".my-info-engraving-tab-content");function Q(){return ie(n,s.name)}function k(){if(!B)return;B.innerHTML="";const{registrationItems:u}=Q();if(u.forEach((d,m)=>{const b=d.statKey||"",c=d.value||"",p=O(b,c,"","registration",m,()=>D(),I=>{if(I.remove(),H){const C=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length;H.disabled=C>=4,H.textContent=`+ 등록효과 추가 (${C}/4)`}D()});B.appendChild(p)}),H){const d=u.length;H.disabled=d>=4,H.textContent=`+ 등록효과 추가 (${d}/4)`}}function D(){if(!$)return;$.innerHTML="";const u=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]'),d=new Set;u.forEach(b=>{const p=b.querySelector(".my-info-engraving-stat-select")?.value||"";p&&d.add(p)});const{bindStats:m}=Q();d.forEach(b=>{const c=m[b]||"",p=O(b,"",c,"bind");$.appendChild(p)})}function ee(){k(),D()}K&&J&&K.forEach(u=>{u.addEventListener("click",()=>{const d=u.dataset.tab;K.forEach(m=>m.classList.remove("active")),u.classList.add("active"),J.forEach(m=>{m.classList.remove("active"),m.id===`${d}Tab`&&m.classList.add("active")})})}),ee(),H&&H.addEventListener("click",()=>{if(B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length>=4)return;const d=O("","","","registration",null,()=>D(),m=>{if(m.remove(),H){const b=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length;H.disabled=b>=4,H.textContent=`+ 등록효과 추가 (${b}/4)`}D()});if(B.appendChild(d),D(),H){const m=B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').length;H.disabled=m>=4,H.textContent=`+ 등록효과 추가 (${m}/4)`}}),Y&&Y.addEventListener("click",()=>{const u=[],d={};B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').forEach(p=>{const I=p.querySelector(".my-info-engraving-stat-select"),C=p.querySelector(".my-info-engraving-value-input"),T=I.value,N=parseFloat(C.value)||0;T&&u.push({statKey:T,value:N})}),$.querySelectorAll('.my-info-engraving-item[data-type="bind"]').forEach(p=>{const I=p.dataset.statKey;if(!I)return;const C=p.querySelector(".my-info-engraving-value-input"),T=parseFloat(C.value)||0;d[I]=T});const c={registration:u,bind:d};t.engravingData[n]||(t.engravingData[n]={}),t.engravingData[n][s.name],t.engravingData[n][s.name]=c,t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,i?.updateTotalStats&&i.updateTotalStats(F,i.updateStatItemsWithValues),i?.renderBondSlots&&i.renderBondSlots(n),a&&a.parentNode&&(a.remove(),L&&(L.remove(),L=null),w=null)}),X&&X.addEventListener("click",()=>{const u=[],d={};B.querySelectorAll('.my-info-engraving-item[data-type="registration"]').forEach(p=>{const I=p.querySelector(".my-info-engraving-stat-select"),C=p.querySelector(".my-info-engraving-value-input"),T=I.value,N=parseFloat(C.value)||0;T&&u.push({statKey:T,value:N})}),$.querySelectorAll('.my-info-engraving-item[data-type="bind"]').forEach(p=>{const I=p.dataset.statKey;if(!I)return;const C=p.querySelector(".my-info-engraving-value-input"),T=parseFloat(C.value)||0;d[I]=T});const c={registration:u,bind:d};t.engravingData[n]||(t.engravingData[n]={}),t.engravingData[n][s.name],t.engravingData[n][s.name]=c,t.isInitialLoad=!1,t.lastTotalStatsHash=null,t.lastTotalStatsCalculation=null,i?.updateTotalStats&&i.updateTotalStats(F,i.updateStatItemsWithValues),i?.renderBondSlots&&i.renderBondSlots(n),a&&a.parentNode&&(a.remove(),L&&(L.remove(),L=null),w=null)})}export{ge as a,Se as b,me as c,z as d,he as e,ve as f,F as g,ye as h,fe as r,xe as s};
