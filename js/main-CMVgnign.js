const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/page-spiritInfo-BcVUc8B-.js","js/components-B1GG1ywu.js","js/utils-DIa4fKeE.js","js/page-bondCalculator-DSOsA5JP.js","js/page-spiritRanking-euJs4enI.js","js/page-soulCalculator-DJIaPXNN.js","js/page-chakCalculator-Dbxm9yHo.js"])))=>i.map(i=>d[i]);
import{S as k,L as i,g as G,c as K,t as f,b as S,E as _,i as Y,d as Z,e as Q,m as L,s as X,f as V,h as T,j as ee,k as te}from"./utils-DIa4fKeE.js";import{s as j}from"./components-B1GG1ywu.js";const ne="modulepreload",ae=function(e){return"/"+e},U={},w=function(t,n,a){let o=Promise.resolve();if(n&&n.length>0){let g=function(p){return Promise.all(p.map(c=>Promise.resolve(c).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");o=g(n.map(p=>{if(p=ae(p),p in U)return;U[p]=!0;const c=p.endsWith(".css"),m=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${m}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":ne,c||(u.as="script"),u.crossOrigin="",u.href=p,r&&u.setAttribute("nonce",r),document.head.appendChild(u),c)return new Promise((C,$)=>{u.addEventListener("load",C),u.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${p}`)))})}))}function d(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&d(r.reason);return t().catch(d)})},v="https://bayeon-hwayeon-backend.onrender.com";async function x(e){if(!e.ok){const t=await e.json().catch(()=>({error:"서버 응답을 읽을 수 없습니다."})),n=new Error(t.error||`서버 오류: ${e.statusText}`);throw _.handle(n,`API ${e.status}`),n}return e.json()}async function R(e,t,n=!1){const a=G(e),o=k.getStorage(),d=o===localStorage;i.debug(`[Cache Debug] Storage type: ${d?"localStorage":"sessionStorage"}, Key: ${a}, Base key: ${e}`);const s=K(e,o);s>0&&i.log(`[Cache] Cleared ${s} old version(s) of ${e}`);const r=k.getItem(a);if(i.debug(`[Cache Debug] Checking cache for key: ${a}, Found: ${r?"YES":"NO"}, Length: ${r?r.length:0}`),r)try{return i.log(`[Cache HIT] Using cached data for key: ${a} (URL: ${t})`),JSON.parse(r)}catch(N){i.error(`[Cache Error] Failed to parse cached data for ${a}, fetching fresh.`,N),k.removeItem(a)}i.log(`[Cache MISS] No cached data for key: ${a} (URL: ${t}), fetching from API...`);const g=performance.now(),p=await fetch(t),c=await x(p),m=performance.now()-g;f(t,m,!0);let u=c;e.startsWith("rankings_")?u=q(c,e):n&&Array.isArray(c)&&(u=S(c));const C=JSON.stringify(u),$=new Blob([C]).size;i.debug(`[Cache Debug] Attempting to save cache for key: ${a}, Data size: ${($/1024).toFixed(2)}KB`);const M=k.setItem(a,C),I=k.getItem(a);return i.debug(`[Cache Debug] Save result: ${M?"SUCCESS":"FAILED"}, Verify: ${I?"FOUND":"NOT FOUND"}, Verify length: ${I?I.length:0}`),M?i.log(`[Cache SAVED] Successfully cached data for key: ${a} (URL: ${t}), Size: ${($/1024).toFixed(2)}KB`):i.error(`[Cache FAILED] Failed to save cached data for ${a} (URL: ${t}). Data will not be cached. Size: ${($/1024).toFixed(2)}KB`),u}function q(e,t){if(!e||!e.rankings)return e;const n=t.includes("_bond")?"bond":t.includes("_stat")?"stat":null;return n==="bond"?e.rankings=e.rankings.map(a=>{let o={...a};return Array.isArray(o.spirits)&&(o.spirits=S(o.spirits)),o.bindStat!==void 0&&o.bindStats===void 0&&(o.bindStats=o.bindStat),o}):n==="stat"&&(e.rankings=S(e.rankings)),e}async function oe(e,t){if(!Y())return i.warn(`[IndexedDB] IndexedDB not available, falling back to memory cache for key: ${e}`),re(t,t);const n=await Z(e);n>0&&i.log(`[IndexedDB] Cleared ${n} old version(s) of ${e}`);const a=await Q(e);if(a)return i.log(`[IndexedDB Cache HIT] Using cached data for key: ${e} (URL: ${t})`),L.set(t,a),a;i.log(`[IndexedDB Cache MISS] No cached data for key: ${e} (URL: ${t}), fetching from API...`);const o=performance.now(),d=await fetch(t),s=await x(d),r=performance.now()-o;f(t,r,!0);let g=q(s,e);return await X(e,g)?(i.log(`[IndexedDB Cache SAVED] Successfully cached data for key: ${e} (URL: ${t})`),L.set(t,g)):i.error(`[IndexedDB Cache FAILED] Failed to save cached data for ${e} (URL: ${t})`),g}async function re(e,t){const n=L.get(e);if(n)return i.log(`[Cache] Using memory cached data for key: ${e}`),n;const a=performance.now(),o=await fetch(t),d=await x(o),s=performance.now()-a;f(t,s,!0);let r=JSON.parse(JSON.stringify(d));if(e.includes("/api/rankings")&&Array.isArray(r.rankings)){const g=e.includes("type=bond")?"bond":e.includes("type=stat")?"stat":null;g==="bond"?r.rankings=r.rankings.map(p=>{let c=p;return Array.isArray(c.spirits)&&(c.spirits=S(c.spirits)),c.bindStat!==void 0&&c.bindStats===void 0&&(c.bindStats=c.bindStat),c}):g==="stat"&&(r.rankings=S(r.rankings))}return L.set(e,r),r}async function ie(){return R("allSpiritsData",`${v}/api/alldata`,!0)}async function ge(e){const t=performance.now();try{const n=await fetch(`${v}/api/calculate/bond`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creatures:e})}),a=await x(n),o=performance.now()-t;return f("/api/calculate/bond",o,!0),a&&Array.isArray(a.spirits)&&(a.spirits=S(a.spirits)),a}catch(n){const a=performance.now()-t;throw f("/api/calculate/bond",a,!1),_.handle(n,"calculateOptimalCombination"),n}}async function fe(e,t,n=""){let a=`${v}/api/rankings?category=${encodeURIComponent(e)}&type=${encodeURIComponent(t)}`;t==="stat"&&n&&(a+=`&statKey=${encodeURIComponent(n)}`);const o=`rankings_${e}_${t}${n?`_${n}`:""}`;return oe(o,a)}async function he(){return R("soulExpTable",`${v}/api/soul/exp-table`)}async function me(e){const t=performance.now();try{const n=await fetch(`${v}/api/calculate/soul`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await x(n),o=performance.now()-t;return f("/api/calculate/soul",o,!0),a}catch(n){const a=performance.now()-t;throw f("/api/calculate/soul",a,!1),_.handle(n,"calculateSoul"),n}}async function ye(){return R("chakData",`${v}/api/chak/data`)}async function be(e){const t=performance.now();try{const n=await fetch(`${v}/api/calculate/chak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await x(n),o=performance.now()-t;return f("/api/calculate/chak",o,!0),a}catch(n){const a=performance.now()-t;throw f("/api/calculate/chak",a,!1),_.handle(n,"calculateChak"),n}}const y={allSpirits:[],currentPageModule:null};function se(e){y.allSpirits=e}const H="loading-indicator-style";let l=null;function J(){if(document.getElementById(H))return;const e=document.createElement("style");e.id=H,e.textContent=`
        .loading-overlay {
            position: absolute; /* Changed from fixed to absolute for #app-container */
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 10000; backdrop-filter: blur(4px);
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .loading-overlay.visible { opacity: 1; visibility: visible; }
        .loading-container {
            background-color: #ffffff; border-radius: 15px; padding: 30px;
            text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 400px; width: 90%;
        }
        .loading-spinner {
            border: 5px solid #e0e0e0; width: 60px; height: 60px;
            border-radius: 50%; border-top-color: #3498db;
            margin: 0 auto 20px; animation: spin 1.2s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .loading-text { margin: 15px 0; color: #333; font-size: 20px; font-weight: bold; }
        .loading-subtext { color: #666; font-size: 14px; margin-bottom: 5px; }
        .loading-progress-container {
            margin-top: 20px;
            display: none;
        }
        .loading-progress-container.visible {
            display: block;
        }
        .loading-progress-bar {
            width: 100%; height: 8px; background-color: #e0e0e0;
            border-radius: 4px; overflow: hidden; margin-bottom: 8px;
        }
        .loading-progress-fill {
            height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 4px; transition: width 0.3s ease;
            width: 0%;
        }
        .loading-progress-text {
            color: #666; font-size: 12px; margin-top: 5px;
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 4px;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .skeleton-text {
            height: 16px; margin-bottom: 8px;
        }
        .skeleton-title {
            height: 24px; width: 60%; margin-bottom: 16px;
        }
        .skeleton-card {
            height: 120px; margin-bottom: 16px;
        }
        .skeleton-image {
            width: 100px; height: 100px; border-radius: 8px;
        }
    `,document.head.appendChild(e)}function B(e,t="처리 중...",n="잠시만 기다려주세요."){if(!e){console.warn("Loading indicator container not provided.");return}l&&(l.remove(),l=null),J(),l=document.createElement("div"),l.className="loading-overlay",l.innerHTML=`
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">${t}</div>
            <div class="loading-subtext">${n}</div>
            <div class="loading-progress-container" id="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="loading-progress-fill"></div>
                </div>
                <div class="loading-progress-text" id="loading-progress-text"></div>
            </div>
        </div>
    `,e.style.position="relative",e.appendChild(l),requestAnimationFrame(()=>{l?.classList.add("visible")})}function ve(e,t="처리 중...",n="잠시만 기다려주세요.",a=0,o=""){if(B(e,t,n),l){const d=l.querySelector("#loading-progress-container"),s=l.querySelector("#loading-progress-fill"),r=l.querySelector("#loading-progress-text");d&&s&&r&&(d.classList.add("visible"),s.style.width=`${Math.min(100,Math.max(0,a))}%`,o?r.textContent=o:r.textContent=`${Math.round(a)}%`)}}function we(e,t=""){if(!l)return;const n=l.querySelector("#loading-progress-fill"),a=l.querySelector("#loading-progress-text");n&&(n.style.width=`${Math.min(100,Math.max(0,e))}%`),a&&(t?a.textContent=t:a.textContent=`${Math.round(e)}%`)}function W(){l&&(l.classList.remove("visible"),setTimeout(()=>{l&&(l.remove(),l=null)},300))}function ce(e="text",t={}){J();const n=document.createElement("div");return n.className=`skeleton skeleton-${e}`,t.width&&(n.style.width=typeof t.width=="number"?`${t.width}px`:t.width),t.height&&(n.style.height=typeof t.height=="number"?`${t.height}px`:t.height),t.className&&(n.className+=` ${t.className}`),n}function Se(e,t="text",n={}){return Array.from({length:e},()=>ce(t,n))}const le={spiritInfo:()=>w(()=>import("./page-spiritInfo-BcVUc8B-.js").then(e=>e.a),__vite__mapDeps([0,1,2])),bondCalculator:()=>w(()=>import("./page-bondCalculator-DSOsA5JP.js").then(e=>e.b),__vite__mapDeps([3,1,2])),spiritRanking:()=>w(()=>import("./page-spiritRanking-euJs4enI.js"),__vite__mapDeps([4,1,2,0,3])),soulCalculator:()=>w(()=>import("./page-soulCalculator-DJIaPXNN.js"),__vite__mapDeps([5,1,2])),chakCalculator:()=>w(()=>import("./page-chakCalculator-Dbxm9yHo.js"),__vite__mapDeps([6,1,2]))},b=document.getElementById("app-container"),A=document.getElementById("mainTabs"),D=document.getElementById("helpBtn"),h=document.getElementById("helpTooltip"),z=document.getElementById("closeHelp"),P=document.getElementById("currentHelpTitle"),E=document.getElementById("pageSpecificHelpContent");D&&h&&z&&P&&E?(D.addEventListener("click",e=>{e.stopPropagation(),h.style.display=h.style.display==="block"?"none":"block",document.body.style.overflow=h.style.display==="block"?"hidden":"auto"}),z.addEventListener("click",e=>{e.stopPropagation(),h.style.display="none",document.body.style.overflow="auto"}),document.addEventListener("click",e=>{!D.contains(e.target)&&!h.contains(e.target)&&h.style.display==="block"&&(h.style.display="none",document.body.style.overflow="auto")})):i.error("Help button or related tooltip elements not found in DOM for initialization.");async function O(){const e=A.querySelector(".tab.active"),t=e?e.dataset.page:"spiritInfo",n=e?e.textContent:"환수 정보";if(y.currentPageModule?.cleanup)try{y.currentPageModule.cleanup(),i.log("[Router] Cleaned up previous page.")}catch(a){i.error("[Router] Error during page cleanup:",a)}b.innerHTML="",B(b,"페이지 로딩 중...","필요한 모듈을 불러오고 있습니다...");try{const a=le[t];if(!a)throw new Error(`'${t}' 페이지를 찾을 수 없습니다.`);const o=await a();if(y.currentPageModule=o,o.init){if((!Array.isArray(y.allSpirits)||y.allSpirits.length===0)&&i.warn("Global spirits data is empty or not an array when routing. This might cause errors on pages depending on it."),await o.init(b),i.log(`[Router] Initialized page: ${t}`),P&&E?(P.textContent=`${n} 도움말`,o.getHelpContentHTML?E.innerHTML=o.getHelpContentHTML():E.innerHTML='<div class="content-block"><p class="text-center text-light mt-md">이 페이지에 대한 특정 도움말은 없습니다.</p></div>'):i.error("Help tooltip specific content elements not found for update within route()."),typeof gtag=="function"){const d=`/bayeon-hwayeon/${t}`;document.title=`바연화연 | ${n}`,gtag("event","page_view",{page_title:n,page_path:d}),i.log(`[GA4] Page view event sent for: ${d}`);const s=performance.now();setTimeout(()=>{const r=performance.now()-s;V(t,r)},100)}}else i.warn(`Page module '${t}' does not have an init() function.`),b.innerHTML='<p class="error-message">페이지를 초기화할 수 없습니다. (init 함수 없음)</p>'}catch(a){i.error(`[Router] Failed to load or initialize page '${t}':`,a),T.handleError(a,{type:"page_routing",pageName:t}),j(b,a,{title:"페이지 로드 실패",onRetry:()=>{O()}})}finally{W()}}const F=document.querySelector(".footer-report-btn");F&&typeof gtag=="function"&&F.addEventListener("click",()=>{gtag("event","interaction",{event_category:"footer_action",event_label:"Report Button Click",event_action:"Click",link_url:"https://open.kakao.com/o/gZdiGDsh",page_location:window.location.href,page_title:document.title}),i.log("GA4: Report button click event sent.")});A.addEventListener("click",e=>{e.target.matches(".tab")&&!e.target.classList.contains("active")&&(A.querySelector(".tab.active")?.classList.remove("active"),e.target.classList.add("active"),O())});async function de(){T.init(),ee(),te();const e=performance.now();B(b,"초기 데이터 로딩 중","서버에서 환수 정보를 불러오고 있습니다...");try{const t=await ie(),{transformSpiritsArrayPaths:n}=await w(async()=>{const{transformSpiritsArrayPaths:d}=await import("./utils-DIa4fKeE.js").then(s=>s.o);return{transformSpiritsArrayPaths:d}},[]),a=n(t);se(a),i.log("Global state (allSpirits) updated:",y.allSpirits),await O();const o=performance.now()-e;V("app_initialization",o)}catch(t){i.error("애플리케이션 초기화 실패:",t),T.handleError(t,{type:"app_initialization"}),j(b,t,{title:"애플리케이션 초기화 실패",onRetry:()=>{window.location.reload()}})}finally{W()}}de();export{ve as a,B as b,ge as c,be as d,he as e,ye as f,me as g,W as h,fe as i,Se as j,y as s,we as u};
