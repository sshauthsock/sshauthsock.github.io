import{e as L,C as A,k as _,m as O,n as $,o as I,j as q,M as x,p as a,S as k}from"./myInfo-common-DzbZ1pwm.js";import{c as V}from"./components-KK9vAy1z.js";function D(i){const s=L.statsColumn1,r=L.statsColumn2,y=L.statsColumn3;!s||!r||!y||(s.innerHTML="",r.innerHTML="",y.innerHTML="",A.forEach(d=>{const l=M(d,i);s.appendChild(l)}),_.forEach(d=>{const l=M(d,i);r.appendChild(l)}),O.forEach(d=>{const l=M(d,i);y.appendChild(l)}))}function M(i,s){const r=V("div","my-info-stat-item");r.dataset.stat=i.key;const y=$[i.key];y&&r.classList.add(y);const d=I[i.key];d&&r.classList.add(d);const l=V("span","my-info-stat-name"),n=q()&&x[i.name]?x[i.name]:i.name;l.textContent=n;const h=V("span","my-info-stat-value"),e=V("span","my-info-stat-base"),E=a.userStats&&a.userStats[i.key]!==void 0?a.userStats[i.key]:0;e.textContent=E.toString(),e.style.display="none";const t=V("span","my-info-stat-total");t.textContent="0";const v=V("span","my-info-stat-change");return v.style.display="none",h.appendChild(t),h.appendChild(v),r.appendChild(l),r.appendChild(h),s&&r.addEventListener("click",g=>{g.target.classList.contains("my-info-stat-change")||r.classList.contains("editing")||g.target.classList.contains("my-info-stat-input")||s(r,i.key,e)}),r}function F(i,s,r,y,d,l){const n=i.querySelector(".my-info-stat-total");let h=0;if(n&&n.textContent){const u=n.textContent.replace(/,/g,"");h=parseFloat(u)||0}else{const u=a.userStats[s]||0;let o=0;a.lastTotalStatsCalculation&&(o=a.lastTotalStatsCalculation.allTotalStats?.[s]||0),h=u+o}i.classList.add("editing");const e=V("input","my-info-stat-input");e.type="number",e.value=h,e.step="1",e.min="0";const E=i.querySelector(".my-info-stat-value"),t=i.querySelector(".my-info-stat-change");n&&n.parentNode?n.parentNode.insertBefore(e,n):E.appendChild(e),e.style.display="inline-block",e.style.width="80px",e.style.marginRight="4px",n&&(n.style.display="inline"),t&&(t.style.display="inline"),e.focus(),e.select();let v=!1;const g=()=>{const u=parseFloat(e.value)||0;if(a.lastTotalStatsCalculation)a.lastTotalStatsCalculation.allBondStats[s],a.lastTotalStatsCalculation.allActiveStats[s];else{const b=["수호","탑승","변신"];for(const p of b){const f=a.activeSpirits[p];if(f&&y){const S=y(p).find(T=>T.name===f.name);if(S){const T=S.stats?.find(N=>N.level===f.level);T?.registrationStat&&T.registrationStat[s]&&(typeof T.registrationStat[s]=="number"?T.registrationStat[s]:parseFloat(T.registrationStat[s]))}}}}const o=u,c=a.baselineStats.hasOwnProperty(s)?a.baselineStats[s]:o,m=o-c;if(n){const b=Math.round(o).toLocaleString();n.textContent=b,n.style.display="inline",n.style.visibility="visible"}if(t)if(Math.abs(m)>.01){const p=Math.round(m);t.textContent=`(${p>0?"+":""}${p.toLocaleString()})`,t.className=`my-info-stat-change ${m>0?"positive":"negative"}`,t.style.display="inline",t.style.visibility="visible",t.style.color="",t.style.background=""}else t.textContent="(0)",t.className="my-info-stat-change neutral",t.style.display="inline",t.style.visibility="visible",t.style.color="",t.style.background=""};e.addEventListener("input",g),g();const C=()=>{if(v)return;v=!0;const u=parseFloat(e.value)||0;e.parentNode&&e.remove();let o=0;a.lastTotalStatsCalculation&&(o=a.lastTotalStatsCalculation.allTotalStats?.[s]||0);const c=u-o;a.userStats[s]=Math.max(0,c),r.textContent=Math.max(0,c).toString();const m=u,b=a.baselineStats.hasOwnProperty(s)?a.baselineStats[s]:m,p=m-b;if(n){const f=Math.round(m).toLocaleString();n.textContent=f,n.innerText=f,n.style.display="inline",n.style.visibility="visible";const S=Date.now();n.dataset.lastEditedValue=f,n.dataset.lastEditedTime=S.toString(),n.dataset.isManuallyEdited="true"}if(d&&d(),t)if(Math.abs(p)>.01){const S=Math.round(p);t.textContent=`(${S>0?"+":""}${S.toLocaleString()})`,t.className=`my-info-stat-change ${p>0?"positive":"negative"}`,t.style.display="inline",t.style.visibility="visible",t.style.color="",t.style.background=""}else t.textContent="(0)",t.className="my-info-stat-change neutral",t.style.display="inline",t.style.visibility="visible";if(i.classList.remove("editing"),a.recentlyEditedStats.add(s),setTimeout(()=>{a.recentlyEditedStats.delete(s)},500),l&&a.lastTotalStatsCalculation){const f=a.lastTotalStatsCalculation;l(k,f.allTotalStats||f.allBondStats,{})}else l&&l(k,{},{})};e.addEventListener("blur",C),e.addEventListener("keypress",u=>{u.key==="Enter"&&(u.preventDefault(),C()),u.key==="Escape"&&(u.preventDefault(),e.parentNode&&e.remove(),n&&(n.style.display="inline"),t&&(t.style.display="inline"),i.classList.remove("editing"))})}function w(i,s,r,y=!1,d=null){L.container&&(i.forEach(l=>{const n=a.userStats[l.key]||0,h=s[l.key]||0,e=Math.round(n+h),E=a.baselineStats.hasOwnProperty(l.key)?a.baselineStats[l.key]:e,t=a.baselineStats.hasOwnProperty(l.key),v=a.isInitialLoad&&t?E:e;let g=y?0:Math.round(e-E);const C=L.container.querySelector(`[data-stat="${l.key}"]`);if(!C)return;const u=C.querySelector(".my-info-stat-value");C.querySelector(".my-info-stat-base");const o=C.querySelector(".my-info-stat-total"),c=C.querySelector(".my-info-stat-change");if(!u||!o||!c||C.classList.contains("editing")||a.recentlyEditedStats&&a.recentlyEditedStats.has(l.key))return;o.dataset.lastEditedValue;const m=o.dataset.lastEditedTime?parseInt(o.dataset.lastEditedTime,10):0;if(o.dataset.isManuallyEdited==="true"&&m){if(Date.now()-m<1e3)return;delete o.dataset.isManuallyEdited,delete o.dataset.lastEditedValue,delete o.dataset.lastEditedTime}const p=Math.round(v).toLocaleString();if(o.textContent=p,o.style.display="inline",o.style.visibility="visible",Math.abs(g)>.01){const S=Math.round(g);c.textContent=`(${S>0?"+":""}${S.toLocaleString()})`,c.className=`my-info-stat-change ${g>0?"positive":"negative"}`,c.style.display="inline",c.style.visibility="visible",c.style.color="",c.style.background=""}else c.textContent="(0)",c.className="my-info-stat-change neutral",c.style.display="inline",c.style.visibility="visible",c.style.color="",c.style.background=""}),d&&d(i,s,{},y,w))}export{F as h,D as r,w as u};
