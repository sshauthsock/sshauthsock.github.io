const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/page-spiritInfo-D44TnKxK.js","js/components-KK9vAy1z.js","js/utils-C4S-LQYV.js","js/page-bondCalculator-Da93mZMi.js","js/page-spiritRanking-CtlNtbAi.js","js/page-soulCalculator-DIGozjfP.js","js/page-chakCalculator-DkGA2-nT.js","js/page-myInfo-BSKe_DfH.js","js/myInfo-common-DzbZ1pwm.js","js/myInfo-statCalculator-CYoXn7dZ.js","js/myInfo-statUI-DLe336Cr.js","js/myInfo-spiritManager-dGU7mvrk.js","js/myInfo-engravingManager-CYbjL9ct.js","js/myInfo-eventHandlers-BFvMQliS.js"])))=>i.map(i=>d[i]);
import{S as $,L as i,g as J,c as K,t as v,b as w,E as P,i as Y,d as Z,e as Q,m as L,s as X,f as V,h as I,j as ee,k as te}from"./utils-C4S-LQYV.js";import{s as q}from"./components-KK9vAy1z.js";const ae="modulepreload",ne=function(e){return"/"+e},H={},m=function(t,n,a){let o=Promise.resolve();if(n&&n.length>0){let g=function(p){return Promise.all(p.map(l=>Promise.resolve(l).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");o=g(n.map(p=>{if(p=ne(p),p in H)return;H[p]=!0;const l=p.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${h}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":ae,l||(u.as="script"),u.crossOrigin="",u.href=p,r&&u.setAttribute("nonce",r),document.head.appendChild(u),l)return new Promise((E,x)=>{u.addEventListener("load",E),u.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&c(r.reason);return t().catch(c)})},S="https://bayeon-hwayeon-backend.onrender.com";async function k(e){if(!e.ok){const t=await e.json().catch(()=>({error:"서버 응답을 읽을 수 없습니다."})),n=e.status===404?`404: ${t.error||e.statusText||"리소스를 찾을 수 없습니다"}`:t.error||`서버 오류: ${e.statusText}`,a=new Error(n);throw P.handle(a,`API ${e.status}`),a}return e.json()}async function R(e,t,n=!1){const a=J(e),o=$.getStorage(),c=o===localStorage;i.debug(`[Cache Debug] Storage type: ${c?"localStorage":"sessionStorage"}, Key: ${a}, Base key: ${e}`);const s=K(e,o);s>0&&i.log(`[Cache] Cleared ${s} old version(s) of ${e}`);const r=$.getItem(a);if(i.debug(`[Cache Debug] Checking cache for key: ${a}, Found: ${r?"YES":"NO"}, Length: ${r?r.length:0}`),r)try{return i.log(`[Cache HIT] Using cached data for key: ${a} (URL: ${t})`),JSON.parse(r)}catch(N){i.error(`[Cache Error] Failed to parse cached data for ${a}, fetching fresh.`,N),$.removeItem(a)}i.log(`[Cache MISS] No cached data for key: ${a} (URL: ${t}), fetching from API...`);const g=performance.now(),p=await fetch(t),l=await k(p),h=performance.now()-g;v(t,h,!0);let u=l;e.startsWith("rankings_")?u=j(l,e):n&&Array.isArray(l)&&(u=w(l));const E=JSON.stringify(u),x=new Blob([E]).size;i.debug(`[Cache Debug] Attempting to save cache for key: ${a}, Data size: ${(x/1024).toFixed(2)}KB`);const O=$.setItem(a,E),_=$.getItem(a);return i.debug(`[Cache Debug] Save result: ${O?"SUCCESS":"FAILED"}, Verify: ${_?"FOUND":"NOT FOUND"}, Verify length: ${_?_.length:0}`),O?i.log(`[Cache SAVED] Successfully cached data for key: ${a} (URL: ${t}), Size: ${(x/1024).toFixed(2)}KB`):i.error(`[Cache FAILED] Failed to save cached data for ${a} (URL: ${t}). Data will not be cached. Size: ${(x/1024).toFixed(2)}KB`),u}function j(e,t){if(!e||!e.rankings)return e;const n=t.includes("_bond")?"bond":t.includes("_stat")?"stat":null;return n==="bond"?e.rankings=e.rankings.map(a=>{let o={...a};return Array.isArray(o.spirits)&&(o.spirits=w(o.spirits)),o.bindStat!==void 0&&o.bindStats===void 0&&(o.bindStats=o.bindStat),o}):n==="stat"&&(e.rankings=w(e.rankings)),e}async function oe(e,t){if(!Y())return i.warn(`[IndexedDB] IndexedDB not available, falling back to memory cache for key: ${e}`),re(t,t);const n=await Z(e);n>0&&i.log(`[IndexedDB] Cleared ${n} old version(s) of ${e}`);const a=await Q(e);if(a)return i.log(`[IndexedDB Cache HIT] Using cached data for key: ${e} (URL: ${t})`),L.set(t,a),a;i.log(`[IndexedDB Cache MISS] No cached data for key: ${e} (URL: ${t}), fetching from API...`);const o=performance.now(),c=await fetch(t),s=await k(c),r=performance.now()-o;v(t,r,!0);let g=j(s,e);return await X(e,g)?(i.log(`[IndexedDB Cache SAVED] Successfully cached data for key: ${e} (URL: ${t})`),L.set(t,g)):i.error(`[IndexedDB Cache FAILED] Failed to save cached data for ${e} (URL: ${t})`),g}async function re(e,t){const n=L.get(e);if(n)return i.log(`[Cache] Using memory cached data for key: ${e}`),n;const a=performance.now(),o=await fetch(t),c=await k(o),s=performance.now()-a;v(t,s,!0);let r=JSON.parse(JSON.stringify(c));if(e.includes("/api/rankings")&&Array.isArray(r.rankings)){const g=e.includes("type=bond")?"bond":e.includes("type=stat")?"stat":null;g==="bond"?r.rankings=r.rankings.map(p=>{let l=p;return Array.isArray(l.spirits)&&(l.spirits=w(l.spirits)),l.bindStat!==void 0&&l.bindStats===void 0&&(l.bindStats=l.bindStat),l}):g==="stat"&&(r.rankings=w(r.rankings))}return L.set(e,r),r}async function ie(){return R("allSpiritsData",`${S}/api/alldata`,!0)}async function fe(e){const t=performance.now();try{const n=await fetch(`${S}/api/calculate/bond`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creatures:e})}),a=await k(n),o=performance.now()-t;return v("/api/calculate/bond",o,!0),a&&Array.isArray(a.spirits)&&(a.spirits=w(a.spirits)),a}catch(n){const a=performance.now()-t;throw v("/api/calculate/bond",a,!1),P.handle(n,"calculateOptimalCombination"),n}}async function he(e,t,n=""){let a=`${S}/api/rankings?category=${encodeURIComponent(e)}&type=${encodeURIComponent(t)}`;t==="stat"&&n&&(a+=`&statKey=${encodeURIComponent(n)}`);const o=`rankings_${e}_${t}${n?`_${n}`:""}`;return oe(o,a)}async function me(){return R("soulExpTable",`${S}/api/soul/exp-table`)}async function ye(e){const t=performance.now();try{const n=await fetch(`${S}/api/calculate/soul`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await k(n),o=performance.now()-t;return v("/api/calculate/soul",o,!0),a}catch(n){const a=performance.now()-t;throw v("/api/calculate/soul",a,!1),P.handle(n,"calculateSoul"),n}}async function be(){return R("chakData",`${S}/api/chak/data`)}const y={allSpirits:[],currentPageModule:null};function se(e){y.allSpirits=e}const U="loading-indicator-style";let d=null;function W(){if(document.getElementById(U))return;const e=document.createElement("style");e.id=U,e.textContent=`
        .loading-overlay {
            position: absolute; /* Changed from fixed to absolute for #app-container */
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 10000; backdrop-filter: blur(4px);
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .loading-overlay.visible { opacity: 1; visibility: visible; }
        .loading-container {
            background-color: #ffffff; border-radius: 15px; padding: 30px;
            text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 400px; width: 90%;
        }
        .loading-spinner {
            border: 5px solid #e0e0e0; width: 60px; height: 60px;
            border-radius: 50%; border-top-color: #3498db;
            margin: 0 auto 20px; animation: spin 1.2s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .loading-text { margin: 15px 0; color: #333; font-size: 20px; font-weight: bold; }
        .loading-subtext { color: #666; font-size: 14px; margin-bottom: 5px; }
        .loading-progress-container {
            margin-top: 20px;
            display: none;
        }
        .loading-progress-container.visible {
            display: block;
        }
        .loading-progress-bar {
            width: 100%; height: 8px; background-color: #e0e0e0;
            border-radius: 4px; overflow: hidden; margin-bottom: 8px;
        }
        .loading-progress-fill {
            height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 4px; transition: width 0.3s ease;
            width: 0%;
        }
        .loading-progress-text {
            color: #666; font-size: 12px; margin-top: 5px;
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 4px;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .skeleton-text {
            height: 16px; margin-bottom: 8px;
        }
        .skeleton-title {
            height: 24px; width: 60%; margin-bottom: 16px;
        }
        .skeleton-card {
            height: 120px; margin-bottom: 16px;
        }
        .skeleton-image {
            width: 100px; height: 100px; border-radius: 8px;
        }
    `,document.head.appendChild(e)}function M(e,t="처리 중...",n="잠시만 기다려주세요."){if(!e){console.warn("Loading indicator container not provided.");return}d&&(d.remove(),d=null),W(),d=document.createElement("div"),d.className="loading-overlay",d.innerHTML=`
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">${t}</div>
            <div class="loading-subtext">${n}</div>
            <div class="loading-progress-container" id="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="loading-progress-fill"></div>
                </div>
                <div class="loading-progress-text" id="loading-progress-text"></div>
            </div>
        </div>
    `,e.style.position="relative",e.appendChild(d),requestAnimationFrame(()=>{d?.classList.add("visible")})}function ve(e,t="처리 중...",n="잠시만 기다려주세요.",a=0,o=""){if(M(e,t,n),d){const c=d.querySelector("#loading-progress-container"),s=d.querySelector("#loading-progress-fill"),r=d.querySelector("#loading-progress-text");c&&s&&r&&(c.classList.add("visible"),s.style.width=`${Math.min(100,Math.max(0,a))}%`,o?r.textContent=o:r.textContent=`${Math.round(a)}%`)}}function we(e,t=""){if(!d)return;const n=d.querySelector("#loading-progress-fill"),a=d.querySelector("#loading-progress-text");n&&(n.style.width=`${Math.min(100,Math.max(0,e))}%`),a&&(t?a.textContent=t:a.textContent=`${Math.round(e)}%`)}function G(){d&&(d.classList.remove("visible"),setTimeout(()=>{d&&(d.remove(),d=null)},300))}function ce(e="text",t={}){W();const n=document.createElement("div");return n.className=`skeleton skeleton-${e}`,t.width&&(n.style.width=typeof t.width=="number"?`${t.width}px`:t.width),t.height&&(n.style.height=typeof t.height=="number"?`${t.height}px`:t.height),t.className&&(n.className+=` ${t.className}`),n}function Se(e,t="text",n={}){return Array.from({length:e},()=>ce(t,n))}const le={spiritInfo:()=>m(()=>import("./page-spiritInfo-D44TnKxK.js").then(e=>e.a),__vite__mapDeps([0,1,2])),bondCalculator:()=>m(()=>import("./page-bondCalculator-Da93mZMi.js").then(e=>e.b),__vite__mapDeps([3,1,2])),spiritRanking:()=>m(()=>import("./page-spiritRanking-CtlNtbAi.js"),__vite__mapDeps([4,1,2,0,3])),soulCalculator:()=>m(()=>import("./page-soulCalculator-DIGozjfP.js"),__vite__mapDeps([5,1,2])),chakCalculator:()=>m(()=>import("./page-chakCalculator-DkGA2-nT.js"),__vite__mapDeps([6,1,2])),myInfo:()=>m(()=>import("./page-myInfo-BSKe_DfH.js"),__vite__mapDeps([7,1,2,8,9,10,11,12,13]))},b=document.getElementById("app-container"),D=document.getElementById("mainTabs"),A=document.getElementById("helpBtn"),f=document.getElementById("helpTooltip"),F=document.getElementById("closeHelp"),T=document.getElementById("currentHelpTitle"),C=document.getElementById("pageSpecificHelpContent");A&&f&&F&&T&&C?(A.addEventListener("click",e=>{e.stopPropagation(),f.style.display=f.style.display==="block"?"none":"block",document.body.style.overflow=f.style.display==="block"?"hidden":"auto"}),F.addEventListener("click",e=>{e.stopPropagation(),f.style.display="none",document.body.style.overflow="auto"}),document.addEventListener("click",e=>{!A.contains(e.target)&&!f.contains(e.target)&&f.style.display==="block"&&(f.style.display="none",document.body.style.overflow="auto")})):i.error("Help button or related tooltip elements not found in DOM for initialization.");async function B(){const e=D.querySelector(".tab.active"),t=e?e.dataset.page:"spiritInfo",n=e?e.textContent:"환수 정보";if(y.currentPageModule?.cleanup)try{y.currentPageModule.cleanup(),i.log("[Router] Cleaned up previous page.")}catch(a){i.error("[Router] Error during page cleanup:",a)}b.innerHTML="",M(b,"페이지 로딩 중...","필요한 모듈을 불러오고 있습니다...");try{const a=le[t];if(!a)throw new Error(`'${t}' 페이지를 찾을 수 없습니다.`);const o=await a();if(y.currentPageModule=o,o.init){if((!Array.isArray(y.allSpirits)||y.allSpirits.length===0)&&i.warn("Global spirits data is empty or not an array when routing. This might cause errors on pages depending on it."),await o.init(b),i.log(`[Router] Initialized page: ${t}`),T&&C?(T.textContent=`${n} 도움말`,o.getHelpContentHTML?C.innerHTML=o.getHelpContentHTML():C.innerHTML='<div class="content-block"><p class="text-center text-light mt-md">이 페이지에 대한 특정 도움말은 없습니다.</p></div>'):i.error("Help tooltip specific content elements not found for update within route()."),typeof gtag=="function"){const c=`/bayeon-hwayeon/${t}`;document.title=`바연화연 | ${n}`,gtag("event","page_view",{page_title:n,page_path:c}),i.log(`[GA4] Page view event sent for: ${c}`);const s=performance.now();setTimeout(()=>{const r=performance.now()-s;V(t,r)},100)}}else i.warn(`Page module '${t}' does not have an init() function.`),b.innerHTML='<p class="error-message">페이지를 초기화할 수 없습니다. (init 함수 없음)</p>'}catch(a){i.error(`[Router] Failed to load or initialize page '${t}':`,a),I.handleError(a,{type:"page_routing",pageName:t}),q(b,a,{title:"페이지 로드 실패",onRetry:()=>{B()}})}finally{G()}}const z=document.querySelector(".footer-report-btn");z&&typeof gtag=="function"&&z.addEventListener("click",()=>{gtag("event","interaction",{event_category:"footer_action",event_label:"Report Button Click",event_action:"Click",link_url:"https://open.kakao.com/o/gZdiGDsh",page_location:window.location.href,page_title:document.title}),i.log("GA4: Report button click event sent.")});D.addEventListener("click",e=>{e.target.matches(".tab")&&!e.target.classList.contains("active")&&(D.querySelector(".tab.active")?.classList.remove("active"),e.target.classList.add("active"),B())});function de(){document.addEventListener("error",function(e){if(e.target.tagName==="IMG"&&e.target.src){const t=e.target;if(t.dataset.fallbackAttempted==="true"||!t.src.endsWith(".webp"))return;const n=t.src.replace(/\.webp$/i,".jpg");t.dataset.fallbackAttempted="true",t.src=n}},!0),document.body&&new MutationObserver(function(t){t.forEach(function(n){n.addedNodes.forEach(function(a){if(a.nodeType===1){a.tagName==="IMG"&&a.src&&a.src.endsWith(".webp")&&a.addEventListener("error",function(){if(this.dataset.fallbackAttempted!=="true"){const c=this.src.replace(/\.webp$/i,".jpg");this.dataset.fallbackAttempted="true",this.src=c}},{once:!0});const o=a.querySelectorAll&&a.querySelectorAll('img[src$=".webp"]');o&&o.forEach(function(c){c.dataset.fallbackHandlerAdded!=="true"&&(c.addEventListener("error",function(){if(this.dataset.fallbackAttempted!=="true"){const s=this.src.replace(/\.webp$/i,".jpg");this.dataset.fallbackAttempted="true",this.src=s}},{once:!0}),c.dataset.fallbackHandlerAdded="true")})}})})}).observe(document.body,{childList:!0,subtree:!0})}async function pe(){I.init(),ee(),te(),de();const e=performance.now();M(b,"초기 데이터 로딩 중","서버에서 환수 정보를 불러오고 있습니다...");try{const t=await ie(),{transformSpiritsArrayPaths:n}=await m(async()=>{const{transformSpiritsArrayPaths:c}=await import("./utils-C4S-LQYV.js").then(s=>s.o);return{transformSpiritsArrayPaths:c}},__vite__mapDeps([2,1])),a=n(t);se(a),i.log("Global state (allSpirits) updated:",y.allSpirits),await B();const o=performance.now()-e;V("app_initialization",o)}catch(t){i.error("애플리케이션 초기화 실패:",t),I.handleError(t,{type:"app_initialization"}),q(b,t,{title:"애플리케이션 초기화 실패",onRetry:()=>{window.location.reload()}})}finally{G()}}pe();export{ve as a,M as b,fe as c,be as d,ye as e,me as f,he as g,G as h,Se as i,y as s,we as u};
