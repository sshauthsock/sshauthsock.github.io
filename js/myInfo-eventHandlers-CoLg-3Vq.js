import{e as d,s as N,l as U,r as F,a as C,p as e,g as $,d as w,S as z,c as K,b as J,f as Q,u as M}from"./myInfo-common-DGiNC5LG.js";import{g as X,u as Y,a as T}from"./myInfo-statCalculator-B6U9dMgm.js";import{u as b,r as x}from"./myInfo-statUI-D9BNfbGD.js";import{g}from"./myInfo-spiritManager-BqPas-0x.js";import{L as Z}from"./utils-x5ORUUhl.js";function re(j){const{renderBondSlotsWrapper:E,renderActiveSpiritSelect:h,renderSpiritListWrapper:O,handleStatEditWrapper:y,debouncedUpdateTotalStats:I}=j;d.profileSelect&&d.profileSelect.addEventListener("change",l=>{const r=l.target.value||null;N(r),r?U(r,{renderBondSlots:E,renderActiveSpiritSelect:h,renderStats:()=>x(y),updateTotalStats:()=>T(g,b),updateSoulExp:()=>M(g)}):F()}),d.createProfileBtn&&d.createProfileBtn.addEventListener("click",()=>{C("create",null,{renderBondSlots:E,renderActiveSpiritSelect:h,renderStats:()=>x(y),updateTotalStats:()=>T(g,b),updateSoulExp:()=>M(g)})}),d.editProfileBtn&&d.editProfileBtn.addEventListener("click",()=>{e.currentProfileId&&C("edit",e.currentProfileId,{renderBondSlots:E,renderActiveSpiritSelect:h,renderStats:()=>x(y),updateTotalStats:()=>T(g,b),updateSoulExp:()=>{const{updateSoulExp:l}=require("./expCalculator.js");l(g)}})}),d.deleteProfileBtn&&d.deleteProfileBtn.addEventListener("click",()=>{if(e.currentProfileId){const l=$().find(r=>r.id===e.currentProfileId);l&&confirm(`"${l.name}" 프로파일을 삭제하시겠습니까?`)&&(w(e.currentProfileId,{renderBondSlots:E,renderActiveSpiritSelect:h,renderStats:()=>x(y),updateTotalStats:()=>T(g,b),updateSoulExp:()=>{const{updateSoulExp:r}=require("./expCalculator.js");r(g)}}),F(),alert("프로파일이 삭제되었습니다."))}}),d.spiritTabs.forEach(l=>{l.addEventListener("click",r=>{const R=r.target.dataset.category;R&&R!==e.currentCategory&&(d.spiritTabs.forEach(B=>B.classList.remove("active")),r.target.classList.add("active"),e.currentCategory=R,O())})});const u=d.container?.querySelector("#saveBaselineBtn");u&&u.addEventListener("click",async()=>{e.isSavingBaseline=!0;try{const l=[...z],r={},R={수호:{전설:{2:{damageResistance:100,pvpDefensePercent:1},3:{damageResistance:200,pvpDefensePercent:2},4:{damageResistance:350,pvpDefensePercent:3.5},5:{damageResistance:550,pvpDefensePercent:5.5}},불멸:{2:{damageResistance:150,pvpDefensePercent:1.5},3:{damageResistance:300,pvpDefensePercent:3},4:{damageResistance:525,pvpDefensePercent:5.25},5:{damageResistance:825,pvpDefensePercent:8.25}}},탑승:{전설:{2:{damageResistancePenetration:100,pvpDamagePercent:1},3:{damageResistancePenetration:200,pvpDamagePercent:2},4:{damageResistancePenetration:350,pvpDamagePercent:3.5},5:{damageResistancePenetration:550,pvpDamagePercent:5.5}},불멸:{2:{damageResistancePenetration:150,pvpDamagePercent:1.5},3:{damageResistancePenetration:300,pvpDamagePercent:3},4:{damageResistancePenetration:525,pvpDamagePercent:5.25},5:{damageResistancePenetration:825,pvpDamagePercent:8.25}}},변신:{전설:{2:{damageResistance:50,damageResistancePenetration:50,pvpDefensePercent:.5,pvpDamagePercent:.5},3:{damageResistance:100,damageResistancePenetration:100,pvpDefensePercent:1,pvpDamagePercent:1},4:{damageResistance:175,damageResistancePenetration:175,pvpDefensePercent:1.75,pvpDamagePercent:1.75},5:{damageResistance:275,damageResistancePenetration:275,pvpDefensePercent:2.75,pvpDamagePercent:2.75}},불멸:{2:{damageResistance:75,damageResistancePenetration:75,pvpDefensePercent:.75,pvpDamagePercent:.75},3:{damageResistance:150,damageResistancePenetration:150,pvpDefensePercent:1.5,pvpDamagePercent:1.5},4:{damageResistance:262,damageResistancePenetration:262,pvpDefensePercent:2.62,pvpDamagePercent:2.62},5:{damageResistance:412,damageResistancePenetration:412,pvpDefensePercent:4.12,pvpDamagePercent:4.12}}}},B={결의:{2:{damageResistance:200},3:{damageResistance:400},4:{damageResistance:600},5:{damageResistance:800}},고요:{2:{damageResistancePenetration:200},3:{damageResistancePenetration:400},4:{damageResistancePenetration:600},5:{damageResistancePenetration:800}},의지:{2:{pvpDamagePercent:2},3:{pvpDamagePercent:4},4:{pvpDamagePercent:6},5:{pvpDamagePercent:8}},침착:{2:{pvpDefensePercent:2},3:{pvpDefensePercent:4},4:{pvpDefensePercent:6},5:{pvpDefensePercent:8}},냉정:{2:{damageResistance:100,damageResistancePenetration:100},3:{damageResistance:200,damageResistancePenetration:200},4:{damageResistance:300,damageResistancePenetration:300},5:{damageResistance:400,damageResistancePenetration:400}},활력:{2:{pvpDamagePercent:1,pvpDefensePercent:1},3:{pvpDamagePercent:2,pvpDefensePercent:2},4:{pvpDamagePercent:3,pvpDefensePercent:3},5:{pvpDamagePercent:4,pvpDefensePercent:4}}},L=["수호","탑승","변신"];for(const c of L){const p=e.bondSpirits[c]||[];if(p.length===0)continue;const f={},o={};for(const i of p){const n=g(c).find(t=>t.name===i.name);if(n){n.grade&&(f[n.grade]=(f[n.grade]||0)+1),n.influence&&(o[n.influence]=(o[n.influence]||0)+1);const t=i.level!==void 0&&i.level!==null?i.level:25,a=n.stats?.find(s=>s.level===t);a?.bindStat&&Object.entries(a.bindStat).forEach(([s,m])=>{const D=typeof m=="number"?m:parseFloat(m)||0;r[s]=(r[s]||0)+D})}}const S=R[c];S&&Object.entries(f).forEach(([i,n])=>{const t=S[i];if(!t)return;let a=0;for(let s=2;s<=n;s++)t[s.toString()]&&(a=s);if(a>0){const s=t[a.toString()];Object.entries(s).forEach(([m,D])=>{r[m]=(r[m]||0)+D})}}),Object.entries(o).forEach(([i,n])=>{const t=B[i];if(!t)return;let a=0;for(let s=2;s<=n;s++)t[s.toString()]&&(a=s);if(a>0){const s=t[a.toString()];Object.entries(s).forEach(([m,D])=>{r[m]=(r[m]||0)+D})}});const v=e.activeSpirits[c];if(v){const i=g(c).find(n=>n.name===v.name);if(i){const n=i.stats?.find(t=>t.level===v.level);n?.registrationStat&&Object.entries(n.registrationStat).forEach(([t,a])=>{const s=typeof a=="number"?a:parseFloat(a)||0;r[t]=(r[t]||0)+s})}}for(const i of p){const n=e.engravingData[c]?.[i.name]||{};n.bind&&Object.entries(n.bind).forEach(([t,a])=>{const s=typeof a=="number"?a:parseFloat(a)||0;s>0&&(r[t]=(r[t]||0)+s)}),!n.registration&&!n.bind&&Object.entries(n).forEach(([t,a])=>{let s=0;typeof a=="object"&&a!==null?s=a.bind||0:s=a||0,s>0&&(r[t]=(r[t]||0)+s)})}if(v){const i=e.engravingData[c]?.[v.name]||{};Array.isArray(i.registration)&&i.registration.forEach(n=>{const t=n.statKey,a=n.value||0,s=typeof a=="number"?a:parseFloat(a)||0;s>0&&t&&(r[t]=(r[t]||0)+s)}),!i.registration&&!i.bind&&Object.entries(i).forEach(([n,t])=>{let a=0;typeof t=="object"&&t!==null?a=t.registration||0:a=t||0,a>0&&(r[n]=(r[n]||0)+a)})}}l.forEach(c=>{const p=e.userStats[c.key]||0,f=r[c.key]||0,o=Math.round(p+f),S=e.baselineStats[c.key];e.baselineStats[c.key]=o});const P=c=>{const p=e.userStats[c]||0,f=r[c]||0;return Math.round(p+f)},k=e.baselineStats.damageResistancePenetration!==void 0?e.baselineStats.damageResistancePenetration:P("damageResistancePenetration"),A=e.baselineStats.damageResistance!==void 0?e.baselineStats.damageResistance:P("damageResistance"),H=e.baselineStats.pvpDamagePercent!==void 0?e.baselineStats.pvpDamagePercent:P("pvpDamagePercent"),q=e.baselineStats.pvpDefensePercent!==void 0?e.baselineStats.pvpDefensePercent:P("pvpDefensePercent"),_=Math.round(Math.round(k)+Math.round(A)+Math.round(Math.round(H)*10)+Math.round(Math.round(q)*10));e.baselineKeyStats.tachaeTotal=_,e.baselineKeyStats.statusEffectResistance=P("statusEffectResistance"),e.baselineKeyStats.statusEffectAccuracy=P("statusEffectAccuracy");const V=e.expTable;if(V){let c=0;for(const p of L){const f=e.bondSpirits[p]||[];for(const o of f){if(!o.level||o.level===0)continue;const S=g(p).find(t=>t.name===o.name);if(!S)continue;const i=S.grade==="불멸"?"immortal":"legend",n=K(V,i,0,o.level);c+=n}}e.savedSoulExp=c}J();const W=X();e.baselineStatsHash=W,Q(),l.forEach(c=>{const p=d.container?.querySelector(`[data-stat="${c.key}"]`);if(p){const f=p.querySelector(".my-info-stat-total"),o=p.querySelector(".my-info-stat-change");f&&o&&(o.textContent="(0)",o.className="my-info-stat-change neutral",o.style.display="inline",o.style.visibility="visible")}}),e.recentlyEditedStats&&e.recentlyEditedStats.clear(),e.lastTotalStatsHash=null,e.lastTotalStatsCalculation=null,Y(l,r,{},!0,b),I();const G=u.innerHTML;u.innerHTML='<span style="font-size: 14px; margin-right: 4px;">✓</span><span>저장됨</span>',u.style.background="var(--color-secondary, #4CAF50)",setTimeout(()=>{u.innerHTML=G,u.style.background="var(--color-primary)"},1500)}catch(l){Z.error("Error saving baseline:",l)}finally{setTimeout(()=>{e.isSavingBaseline=!1},500)}})}export{re as s};
